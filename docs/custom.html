<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 8 Customising Visualisations | Applied Data Skills</title>
<meta name="author" content="Emily Nordmann and Lisa DeBruine">
<meta name="description" content="8.1 Intended Learning Outcomes Customise plots with a consistent style Create high quality plots like BBC, NYT, 538 library(tidyverse)  # data wrangling functions library(ggwordcloud) # for word...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 8 Customising Visualisations | Applied Data Skills">
<meta property="og:type" content="book">
<meta property="og:url" content="https://psyteachr.github.io/ads-v1/custom.html">
<meta property="og:image" content="https://psyteachr.github.io/ads-v1/images/logos/logo">
<meta property="og:description" content="8.1 Intended Learning Outcomes Customise plots with a consistent style Create high quality plots like BBC, NYT, 538 library(tidyverse)  # data wrangling functions library(ggwordcloud) # for word...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 8 Customising Visualisations | Applied Data Skills">
<meta name="twitter:description" content="8.1 Intended Learning Outcomes Customise plots with a consistent style Create high quality plots like BBC, NYT, 538 library(tidyverse)  # data wrangling functions library(ggwordcloud) # for word...">
<meta name="twitter:image" content="https://psyteachr.github.io/ads-v1/images/logos/logo">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.0/transition.js"></script><script src="libs/bs3compat-0.3.0/tabs.js"></script><script src="libs/bs3compat-0.3.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-6NP3MF25W3"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-6NP3MF25W3');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="include/psyteachr.css">
<link rel="stylesheet" href="include/webex.css">
<link rel="stylesheet" href="include/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="Processing &amp; Presenting Data">Applied Data Skills</a>:
        <small class="text-muted">Processing &amp; Presenting Data</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Overview</a></li>
<li><a class="" href="intro.html"><span class="header-section-number">1</span> Intro to R and RStudio</a></li>
<li><a class="" href="reports.html"><span class="header-section-number">2</span> Reports with R Markdown</a></li>
<li><a class="" href="viz.html"><span class="header-section-number">3</span> Basic Data Visualisation</a></li>
<li><a class="" href="data.html"><span class="header-section-number">4</span> Data Import and Relations</a></li>
<li><a class="" href="tidy.html"><span class="header-section-number">5</span> Data Tidying</a></li>
<li><a class="" href="wrangle.html"><span class="header-section-number">6</span> Data Wrangling</a></li>
<li><a class="" href="summary.html"><span class="header-section-number">7</span> Data Summaries</a></li>
<li><a class="active" href="custom.html"><span class="header-section-number">8</span> Customising Visualisations</a></li>
<li><a class="" href="present.html"><span class="header-section-number">9</span> Dashboards, Reports, and Presentations</a></li>
<li><a class="" href="next.html"><span class="header-section-number">10</span> What's Next</a></li>
<li class="book-part">Appendices</li>
<li><a class="" href="installing-r.html"><span class="header-section-number">A</span> Installing R</a></li>
<li><a class="" href="symbols.html"><span class="header-section-number">B</span> Symbols</a></li>
<li><a class="" href="conventions.html"><span class="header-section-number">C</span> Conventions</a></li>
<li><a class="" href="data-types.html"><span class="header-section-number">D</span> Data Types</a></li>
<li><a class="" href="plotstyle.html"><span class="header-section-number">E</span> Styling Plots</a></li>
<li><a class="" href="license.html">License</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/psyteachr/ads-v1">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="custom" class="section level1" number="8">
<h1>
<span class="header-section-number">8</span> Customising Visualisations<a class="anchor" aria-label="anchor" href="#custom"><i class="fas fa-link"></i></a>
</h1>
<div id="ilo-custom" class="section level2" number="8.1">
<h2>
<span class="header-section-number">8.1</span> Intended Learning Outcomes<a class="anchor" aria-label="anchor" href="#ilo-custom"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>Customise plots with a consistent style</li>
<li>Create high quality plots like BBC, NYT, 538</li>
</ul>
<div class="sourceCode" id="cb222"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>   <span class="co"># data wrangling functions</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lepennec/ggwordcloud">ggwordcloud</a></span><span class="op">)</span> <span class="co"># for word clouds</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/juliasilge/tidytext">tidytext</a></span><span class="op">)</span>    <span class="co"># for manipulating text for word clouds</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span>   <span class="co"># for combining plots</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">treemap</span><span class="op">)</span>     <span class="co"># for treemap plots</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jrnold/ggthemes">ggthemes</a></span><span class="op">)</span>    <span class="co"># for themes</span>

<span class="fu">theme_set</span><span class="op">(</span><span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="defaults" class="section level2" number="8.2">
<h2>
<span class="header-section-number">8.2</span> Defaults<a class="anchor" aria-label="anchor" href="#defaults"><i class="fas fa-link"></i></a>
</h2>
<p>The code below creates two familiar plots from ChapterÂ <a href="viz.html#viz">3</a>, using the default (light) theme and palettes</p>
<div class="sourceCode" id="cb223"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span>file <span class="op">=</span> <span class="st">"data/survey_data.csv"</span><span class="op">)</span>

<span class="va">bar</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">survey_data</span>, 
              mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">issue_category</span>,
                            fill <span class="op">=</span> <span class="va">issue_category</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Calls by Issue Category"</span><span class="op">)</span>

<span class="va">point</span> <span class="op">&lt;-</span> <span class="va">lm_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">survey_data</span>, 
                           mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">wait_time</span>, 
                                         y <span class="op">=</span> <span class="va">call_time</span>,
                                         color <span class="op">=</span> <span class="va">issue_category</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_smooth</span><span class="op">(</span>method <span class="op">=</span> <span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span><span class="op">~</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Wait Time by Call Time"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb224"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bar</span> <span class="op">+</span> <span class="va">point</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-2"></span>
<img src="08-custom_files/figure-html/unnamed-chunk-2-1.png" alt="Default plot styles." width="100%"><p class="caption">
Figure 8.1: Default plot styles.
</p>
</div>
</div>
<div id="r-markdown-options" class="section level2" number="8.3">
<h2>
<span class="header-section-number">8.3</span> R Markdown Options<a class="anchor" aria-label="anchor" href="#r-markdown-options"><i class="fas fa-link"></i></a>
</h2>
<div id="image-size" class="section level3" number="8.3.1">
<h3>
<span class="header-section-number">8.3.1</span> Image Size<a class="anchor" aria-label="anchor" href="#image-size"><i class="fas fa-link"></i></a>
</h3>
<p>You can set the image size in the <a class="glossary" target="_blank" title="A section of code in an R Markdown file" href="https://psyteachr.github.io/glossary/c#chunk">chunk</a> headers.</p>
<div class="verbatim">
<pre class="sourceCode r"><code class="sourceCode R">```{r, fig.width = 10, fig.height = 5}</code></pre>
<div class="sourceCode" id="cb225"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bar</span> <span class="op">+</span> <span class="va">point</span></code></pre></div>
<pre class="sourceCode r"><code class="sourceCode R">```</code></pre>
</div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-4"></span>
<img src="08-custom_files/figure-html/unnamed-chunk-4-1.png" alt="Image size altered to fig.width = 10, fig.height = 5" width="100%"><p class="caption">
Figure 8.2: Image size altered to fig.width = 10, fig.height = 5
</p>
</div>
</div>
<div id="output" class="section level3" number="8.3.2">
<h3>
<span class="header-section-number">8.3.2</span> Output<a class="anchor" aria-label="anchor" href="#output"><i class="fas fa-link"></i></a>
</h3>
<p>The option <code>out.width</code> controls how much space the figure takes up relative to the width of the output. The default value is "100%". You can also set alignment with <code>fig.alig</code>.</p>
<div class="verbatim">
<pre class="sourceCode r"><code class="sourceCode R">```{r, out.width = "75%", fig.align = "center"}</code></pre>
<div class="sourceCode" id="cb226"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bar</span></code></pre></div>
<pre class="sourceCode r"><code class="sourceCode R">```</code></pre>
</div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-6"></span>
<img src="08-custom_files/figure-html/unnamed-chunk-6-1.png" alt='Output display altered with out.width = "75%", fig.align = "center"' width="75%"><p class="caption">
Figure 8.3: Output display altered with out.width = "75%", fig.align = "center"
</p>
</div>
</div>
<div id="captions" class="section level3" number="8.3.3">
<h3>
<span class="header-section-number">8.3.3</span> Captions<a class="anchor" aria-label="anchor" href="#captions"><i class="fas fa-link"></i></a>
</h3>
<p>Figures should usually get a caption with <code>fig.cap</code> and alt text to describe the figure to people with impaired vision using <code>fig.alt</code>.</p>
<div class="verbatim">
<pre class="sourceCode r"><code class="sourceCode R">```{r, fig.cap = "As wait time increases, so does call time.", fig.alt = "Wait time on the x-axis and Call time on the y-axis. Shows scatterplots and regression lines for each of 4 issue categories: other, returns, sales, and tech. All 4 wait times increase with call time. At 50 seconds wait time, call time is about 25 seconds. At 250 seconds wait time, call time is about 60 seconds."}</code></pre>
<div class="sourceCode" id="cb227"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">point</span></code></pre></div>
<pre class="sourceCode r"><code class="sourceCode R">```</code></pre>
</div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-8"></span>
<img src="08-custom_files/figure-html/unnamed-chunk-8-1.png" alt="Wait time on the x-axis and Call time on the y-axis. Shows scatterplots and regression lines for each of 4 issue categories: other, returns, sales, and tech. All 4 wait times increase with call time. At 50 seconds wait time, call time is about 25 seconds. At 250 seconds wait time, call time is about 60 seconds." width="100%"><p class="caption">
Figure 8.4: As wait time increases, so does call time.
</p>
</div>
</div>
<div id="setup-chunk" class="section level3" number="8.3.4">
<h3>
<span class="header-section-number">8.3.4</span> Setup Chunk<a class="anchor" aria-label="anchor" href="#setup-chunk"><i class="fas fa-link"></i></a>
</h3>
<p>You can also set default values in the setup chunk like this.</p>
<div class="sourceCode" id="cb228"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>
  fig.width <span class="op">=</span> <span class="fl">10</span>,
  fig.height <span class="op">=</span> <span class="fl">5</span>,
  out.width <span class="op">=</span> <span class="st">"75%"</span>,
  fig.align <span class="op">=</span> <span class="st">"center"</span>
<span class="op">)</span></code></pre></div>
<div class="warning">
<p>When you set the default figure width and height in the setup chunk, images you make interactively while setting up your script will have the right aspect ratio, but you will only be able to see the <code>out.width</code>, <code>fig.align</code>, and <code>fig.cap</code> when you <a class="glossary" target="_blank" title="To create an HTML, PDF, or Word document from an R Markdown (Rmd) document" href="https://psyteachr.github.io/glossary/k#knit">knit</a> the file.</p>
</div>
</div>
</div>
<div id="themes-and-colours" class="section level2" number="8.4">
<h2>
<span class="header-section-number">8.4</span> Themes and Colours<a class="anchor" aria-label="anchor" href="#themes-and-colours"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb229"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bar2</span> <span class="op">&lt;-</span> <span class="va">bar</span> <span class="op">+</span> 
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">scale_fill_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span>

<span class="va">point2</span> <span class="op">&lt;-</span> <span class="va">point</span> <span class="op">+</span> 
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">scale_color_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span>

<span class="va">bar2</span> <span class="op">+</span> <span class="va">point2</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-10"></span>
<img src="08-custom_files/figure-html/unnamed-chunk-10-1.png" alt="Plots with the classic theme and Dark2 palette." width="100%"><p class="caption">
Figure 8.5: Plots with the classic theme and Dark2 palette.
</p>
</div>
<p>You can download extra themes with packages like <code class="package">ggthemes</code>.</p>
<div class="sourceCode" id="cb230"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bar_econ</span> <span class="op">&lt;-</span> <span class="va">bar</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggthemes/man/theme_economist.html">theme_economist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggthemes/man/scale_economist.html">scale_fill_economist</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">point_econ</span> <span class="op">&lt;-</span> <span class="va">point</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggthemes/man/theme_economist.html">theme_economist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggthemes/man/scale_economist.html">scale_color_economist</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">bar_econ</span> <span class="op">+</span> <span class="va">point_econ</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-11"></span>
<img src="08-custom_files/figure-html/unnamed-chunk-11-1.png" alt="Plots with the economist styles from ggthemes." width="100%"><p class="caption">
Figure 8.6: Plots with the economist styles from ggthemes.
</p>
</div>
</div>
<div id="other-plots" class="section level2" number="8.5">
<h2>
<span class="header-section-number">8.5</span> Other Plots<a class="anchor" aria-label="anchor" href="#other-plots"><i class="fas fa-link"></i></a>
</h2>
<div id="treemap" class="section level3" number="8.5.1">
<h3>
<span class="header-section-number">8.5.1</span> Treemap<a class="anchor" aria-label="anchor" href="#treemap"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb231"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pop_data</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/readxl/man/read_excel.html">read_excel</a></span><span class="op">(</span><span class="st">"data/WPP2019_POP_F01_1_TOTAL_POPULATION_BOTH_SEXES.xlsx"</span>,
                               skip <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Type</span> <span class="op">==</span> <span class="st">"Country/Area"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span>country <span class="op">=</span> <span class="fl">3</span>, population <span class="op">=</span> <span class="va">`2020`</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>population <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">population</span> <span class="op">&gt;</span> <span class="fl">10000000</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/treemap/man/treemap.html">treemap</a></span><span class="op">(</span><span class="va">pop_data</span>,
  index<span class="op">=</span><span class="st">"country"</span>,
  vSize<span class="op">=</span><span class="st">"population"</span>,
  title <span class="op">=</span> <span class="st">""</span>,
  palette <span class="op">=</span> <span class="st">"BuPu"</span>,
  inflate.labels <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-12"></span>
<img src="08-custom_files/figure-html/unnamed-chunk-12-1.png" alt="Treemap plot of 2020 population by country, for countries with more than 10M." width="100%"><p class="caption">
Figure 8.7: Treemap plot of 2020 population by country, for countries with more than 10M.
</p>
</div>
</div>
<div id="word-clouds" class="section level3" number="8.5.2">
<h3>
<span class="header-section-number">8.5.2</span> Word Clouds<a class="anchor" aria-label="anchor" href="#word-clouds"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb232"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># https://www.kaggle.com/sid321axn/amazon-alexa-reviews</span>
<span class="co"># extracted from Amazon by Manu Siddhartha &amp; Anurag Bhatt</span>
<span class="va">alexa</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"data/amazon_alexa.csv"</span><span class="op">)</span></code></pre></div>
<p>Next, we need to make a table of the number of times each individual word appears per rating The function <code><a href="https://rdrr.io/pkg/tidytext/man/unnest_tokens.html">tidytext::unnest_tokens()</a></code> does this for you by splitting the words in the <code>input</code> column into individual words in a new <code>output</code> column.</p>
<p>Then we can get rid of common "stop words" and integers by filtering only words that are not in our <code>omitted</code> list.</p>
<p>Then we group by rating and use <code><a href="https://rdrr.io/pkg/dplyr/man/slice.html">dplyr::slice_max()</a></code> to get the top 25 words, ordered by the column <code>n</code>.</p>
<div class="sourceCode" id="cb233"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">omitted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">stop_words</span><span class="op">$</span><span class="va">word</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span>

<span class="va">words</span> <span class="op">&lt;-</span> <span class="va">alexa</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/unnest_tokens.html">unnest_tokens</a></span><span class="op">(</span>output <span class="op">=</span> <span class="st">"word"</span>, input <span class="op">=</span> <span class="st">"verified_reviews"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">count</span><span class="op">(</span><span class="va">word</span>, <span class="va">rating</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">word</span> <span class="op">%in%</span> <span class="va">omitted</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">rating</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">slice_max</span><span class="op">(</span>order_by <span class="op">=</span> <span class="va">n</span>, n <span class="op">=</span> <span class="fl">25</span>, with_ties <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Now we can make two word clouds and paste them together (word clouds don't play well with facets). So we filter the <code>words</code> table to get one rating, then set up a ggplot with the aesthetics <code>label</code>, <code>colour</code>, and <code>size</code>. The <code>label</code> will come from the <code>word</code> column, while the <code>colour</code> will be different for each <code>word</code> and the <code>size</code> of the word will be proportional to <code>n</code>, the number of times the word appeared.</p>
<p>The visualisation we'll use is <code><span class="fu">ggwordcloud</span><span class="fu">::</span><span class="fu"><a target="_blank" href="https://lepennec.github.io/ggwordcloud/reference/geom_text_wordcloud.html">geom_text_wordcloud_area</a></span><span class="op">(</span><span class="op">)</span></code>. We can control how big the cloud is with <code><span class="fu">ggwordcloud</span><span class="fu">::</span><span class="fu">scale_size_area</span><span class="op">(</span><span class="op">)</span></code> (this usually takes some trial-and-error). Then add a title and a minimal theme to get rid of the axes and grid lines.</p>
<div class="sourceCode" id="cb234"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rating1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">words</span>, <span class="va">rating</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">word</span>, colour <span class="op">=</span> <span class="va">word</span>, size <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://lepennec.github.io/ggwordcloud/reference/geom_text_wordcloud.html">geom_text_wordcloud_area</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_size_area</span><span class="op">(</span>max_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Rating = 1"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_minimal</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></code></pre></div>
<p>Make another plot for a different rating and paste them together with <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>.</p>
<div class="sourceCode" id="cb235"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rating5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">words</span>, <span class="va">rating</span> <span class="op">==</span> <span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">word</span>, colour <span class="op">=</span> <span class="va">word</span>, size <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://lepennec.github.io/ggwordcloud/reference/geom_text_wordcloud.html">geom_text_wordcloud_area</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_size_area</span><span class="op">(</span>max_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Rating = 5"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_minimal</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>

<span class="va">rating1</span> <span class="op">+</span> <span class="va">rating5</span></code></pre></div>
<div class="inline-figure"><img src="08-custom_files/figure-html/unnamed-chunk-16-1.png" width="100%" style="display: block; margin: auto;"></div>

</div>
</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;
    
    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");
  
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");
  
  var cl = this.classList
  
  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;
  
  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }
  
  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

window.onload = function() {
  console.log("onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }
  
  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }
  
  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
  }

  update_total_correct();
}

</script><script>
$( document ).ready(function() {
  var cite = ' ';
  var psyteachr = ' <a href="https://psyteachr.github.io/"><img src="images/logos/psyteachr_logo.png" style="height: 31px; color: white;" alt="psyTeachR: Reproducible Research" /></a>';
  var license = ' <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>';

  $("footer div.row div:eq(1) p").html(
    psyteachr + license + cite
  );

  function move_sidebar() {
    var w = window.innerWidth;
    if (w < 992) {
      $("#toc").appendTo($("#main-nav"));
    } else {
      $("#toc").appendTo($("div.sidebar-chapter"));
    }
  }
  move_sidebar();
  window.onresize = move_sidebar;
});
</script><div class="chapter-nav">
<div class="prev"><a href="summary.html"><span class="header-section-number">7</span> Data Summaries</a></div>
<div class="next"><a href="present.html"><span class="header-section-number">9</span> Dashboards, Reports, and Presentations</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#custom"><span class="header-section-number">8</span> Customising Visualisations</a></li>
<li><a class="nav-link" href="#ilo-custom"><span class="header-section-number">8.1</span> Intended Learning Outcomes</a></li>
<li><a class="nav-link" href="#defaults"><span class="header-section-number">8.2</span> Defaults</a></li>
<li>
<a class="nav-link" href="#r-markdown-options"><span class="header-section-number">8.3</span> R Markdown Options</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#image-size"><span class="header-section-number">8.3.1</span> Image Size</a></li>
<li><a class="nav-link" href="#output"><span class="header-section-number">8.3.2</span> Output</a></li>
<li><a class="nav-link" href="#captions"><span class="header-section-number">8.3.3</span> Captions</a></li>
<li><a class="nav-link" href="#setup-chunk"><span class="header-section-number">8.3.4</span> Setup Chunk</a></li>
</ul>
</li>
<li><a class="nav-link" href="#themes-and-colours"><span class="header-section-number">8.4</span> Themes and Colours</a></li>
<li>
<a class="nav-link" href="#other-plots"><span class="header-section-number">8.5</span> Other Plots</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#treemap"><span class="header-section-number">8.5.1</span> Treemap</a></li>
<li><a class="nav-link" href="#word-clouds"><span class="header-section-number">8.5.2</span> Word Clouds</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/psyteachr/ads-v1/blob/master/book/08-custom.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/psyteachr/ads-v1/edit/master/book/08-custom.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Applied Data Skills</strong>: Processing &amp; Presenting Data" was written by Emily Nordmann and Lisa DeBruine. It was last built on 2021-10-04.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
