<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 4 Data Import and Relations | Applied Data Skills</title>
<meta name="author" content="Emily Nordmann and Lisa DeBruine">
<meta name="description" content="4.1 Intended Learning Outcomes Be able to import data from a range of sources Be able to identify and handle common problems with data import Be able to match related data from multiple tables...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 4 Data Import and Relations | Applied Data Skills">
<meta property="og:type" content="book">
<meta property="og:url" content="https://psyteachr.github.io/ads-v1/data.html">
<meta property="og:image" content="https://psyteachr.github.io/ads-v1/images/logos/logo">
<meta property="og:description" content="4.1 Intended Learning Outcomes Be able to import data from a range of sources Be able to identify and handle common problems with data import Be able to match related data from multiple tables...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 4 Data Import and Relations | Applied Data Skills">
<meta name="twitter:description" content="4.1 Intended Learning Outcomes Be able to import data from a range of sources Be able to identify and handle common problems with data import Be able to match related data from multiple tables...">
<meta name="twitter:image" content="https://psyteachr.github.io/ads-v1/images/logos/logo">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.0/transition.js"></script><script src="libs/bs3compat-0.3.0/tabs.js"></script><script src="libs/bs3compat-0.3.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="libs/plotly-binding-4.9.4.1/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-6NP3MF25W3"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-6NP3MF25W3');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="include/psyteachr.css">
<link rel="stylesheet" href="include/webex.css">
<link rel="stylesheet" href="include/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="Processing &amp; Presenting Data">Applied Data Skills</a>:
        <small class="text-muted">Processing &amp; Presenting Data</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Overview</a></li>
<li><a class="" href="intro.html"><span class="header-section-number">1</span> Intro to R and RStudio</a></li>
<li><a class="" href="reports.html"><span class="header-section-number">2</span> Reports with R Markdown</a></li>
<li><a class="" href="viz.html"><span class="header-section-number">3</span> Basic Data Visualisation</a></li>
<li><a class="active" href="data.html"><span class="header-section-number">4</span> Data Import and Relations</a></li>
<li><a class="" href="tidy.html"><span class="header-section-number">5</span> Data Tidying</a></li>
<li><a class="" href="wrangle.html"><span class="header-section-number">6</span> Data Wrangling</a></li>
<li><a class="" href="summary.html"><span class="header-section-number">7</span> Data Summaries</a></li>
<li><a class="" href="custom.html"><span class="header-section-number">8</span> Customising Visualisations</a></li>
<li><a class="" href="present.html"><span class="header-section-number">9</span> Dashboards, Reports, and Presentations</a></li>
<li><a class="" href="next.html"><span class="header-section-number">10</span> What's Next</a></li>
<li class="book-part">Appendices</li>
<li><a class="" href="installing-r.html"><span class="header-section-number">A</span> Installing R</a></li>
<li><a class="" href="appendix-updating-r.html"><span class="header-section-number">B</span> Updating R, RStudio, and packages</a></li>
<li><a class="" href="symbols.html"><span class="header-section-number">C</span> Symbols</a></li>
<li><a class="" href="conventions.html"><span class="header-section-number">D</span> Conventions</a></li>
<li><a class="" href="data-types.html"><span class="header-section-number">E</span> Data Types</a></li>
<li><a class="" href="plotstyle.html"><span class="header-section-number">F</span> Styling Plots</a></li>
<li><a class="" href="license.html">License</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/psyteachr/ads-v1">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="data" class="section level1" number="4">
<h1>
<span class="header-section-number">4</span> Data Import and Relations<a class="anchor" aria-label="anchor" href="#data"><i class="fas fa-link"></i></a>
</h1>
<div id="ilo-data" class="section level2" number="4.1">
<h2>
<span class="header-section-number">4.1</span> Intended Learning Outcomes<a class="anchor" aria-label="anchor" href="#ilo-data"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>Be able to import data from a range of sources</li>
<li>Be able to identify and handle common problems with data import</li>
<li>Be able to match related data from multiple tables</li>
</ul>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>     <span class="co"># includes readr &amp; tibble</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/leeper/rio">rio</a></span><span class="op">)</span>           <span class="co"># for almost any data import/export</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://haven.tidyverse.org">haven</a></span><span class="op">)</span>         <span class="co"># for SPSS, Stata,and SAS files</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org">readxl</a></span><span class="op">)</span>        <span class="co"># for Excel files</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://googlesheets4.tidyverse.org">googlesheets4</a></span><span class="op">)</span> <span class="co"># for Google Sheets</span></code></pre></div>
</div>
<div id="data-import" class="section level2" number="4.2">
<h2>
<span class="header-section-number">4.2</span> Data Import<a class="anchor" aria-label="anchor" href="#data-import"><i class="fas fa-link"></i></a>
</h2>
<p>For this lesson, please download a <a href="data/data.zip">directory of data files used in this class</a>.</p>
<div id="builtin" class="section level3" number="4.2.1">
<h3>
<span class="header-section-number">4.2.1</span> Built-in data<a class="anchor" aria-label="anchor" href="#builtin"><i class="fas fa-link"></i></a>
</h3>
<p>R comes with built-in datasets. Some packages, like <code class="package">tidyr</code>, also contain data. The <code><span class="fu"><a target="_blank" href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="op">)</span></code> function lists the datasets available in a <a class="glossary" target="_blank" title="A group of R functions." href="https://psyteachr.github.io/glossary/p#package">package</a>.</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># lists datasets in tidyr</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"tidyr"</span><span class="op">)</span></code></pre></div>
<p>Type the name of a dataset into the <a class="glossary" target="_blank" title="The pane in RStudio where you can type in commands and view output messages." href="https://psyteachr.github.io/glossary/c#console">console</a> to see the data. Type <code>?table1</code> into the console to see the dataset description.</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">?</span><span class="va">table1</span></code></pre></div>
<pre><code>## starting httpd help server ... done</code></pre>
<p>You can also use the <code><span class="fu"><a target="_blank" href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="op">)</span></code> function to load a dataset into your <a class="glossary" target="_blank" title="The interactive workspace where your script runs" href="https://psyteachr.github.io/glossary/g#global-environment">global environment</a>.</p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># loads table1 into the environment</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"table1"</span><span class="op">)</span></code></pre></div>
</div>
<div id="looking-at-data" class="section level3" number="4.2.2">
<h3>
<span class="header-section-number">4.2.2</span> Looking at data<a class="anchor" aria-label="anchor" href="#looking-at-data"><i class="fas fa-link"></i></a>
</h3>
<p>Now that you've loaded some data, look the upper right hand window of RStudio, under the Environment tab. You will see the objects listed, along with their number of observations (rows) and variables (columns). This is your first check that everything went OK.</p>
<p>Always, always, always, look at your data once you've created or loaded a table. Also look at it after each step that transforms your table. There are three main ways to look at your table: <code><span class="fu"><a target="_blank" href="https://rdrr.io/r/utils/View.html">View</a></span><span class="op">(</span><span class="op">)</span></code>, <code><span class="fu"><a target="_blank" href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></code>, <code><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a target="_blank" href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></code>.</p>
<div id="view" class="section level4" number="4.2.2.1">
<h4>
<span class="header-section-number">4.2.2.1</span> View()<a class="anchor" aria-label="anchor" href="#view"><i class="fas fa-link"></i></a>
</h4>
<p>A familiar way to look at the table is given by <code><span class="fu"><a target="_blank" href="https://rdrr.io/r/utils/View.html">View</a></span><span class="op">(</span><span class="op">)</span></code> (uppercase 'V'), which opens a data table up in a viewer that looks a bit like Excel. This command can be useful in the console, but don't ever put this one in a script because it will create an annoying pop-up window when the user runs it. Or you can click on an object in the <a class="glossary" target="_blank" title='RStudio is arranged with four window "panes".' href="https://psyteachr.github.io/glossary/p#panes">environment pane</a>. You can close the tab when you're done looking at it; it won't remove the object.</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/View.html">View</a></span><span class="op">(</span><span class="va">table1</span><span class="op">)</span></code></pre></div>
</div>
<div id="print" class="section level4" number="4.2.2.2">
<h4>
<span class="header-section-number">4.2.2.2</span> print()<a class="anchor" aria-label="anchor" href="#print"><i class="fas fa-link"></i></a>
</h4>
<p>The <code><span class="fu"><a target="_blank" href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></code> method can be run explicitly, but is more commonly called by just typing the variable name on a blank line. The default is not to print the entire table, but just the first 10 rows.</p>
<p>Let's look at the <code>table1</code> table that we loaded above. Depending on how wide your screen is, you might need to click on an arrow at the right of the table to see the last column.</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table1</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
country
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
cases
</th>
<th style="text-align:right;">
population
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1999
</td>
<td style="text-align:right;">
745
</td>
<td style="text-align:right;">
19987071
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
2000
</td>
<td style="text-align:right;">
2666
</td>
<td style="text-align:right;">
20595360
</td>
</tr>
<tr>
<td style="text-align:left;">
Brazil
</td>
<td style="text-align:right;">
1999
</td>
<td style="text-align:right;">
37737
</td>
<td style="text-align:right;">
172006362
</td>
</tr>
<tr>
<td style="text-align:left;">
Brazil
</td>
<td style="text-align:right;">
2000
</td>
<td style="text-align:right;">
80488
</td>
<td style="text-align:right;">
174504898
</td>
</tr>
<tr>
<td style="text-align:left;">
China
</td>
<td style="text-align:right;">
1999
</td>
<td style="text-align:right;">
212258
</td>
<td style="text-align:right;">
1272915272
</td>
</tr>
<tr>
<td style="text-align:left;">
China
</td>
<td style="text-align:right;">
2000
</td>
<td style="text-align:right;">
213766
</td>
<td style="text-align:right;">
1280428583
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="glimpse" class="section level4" number="4.2.2.3">
<h4>
<span class="header-section-number">4.2.2.3</span> glimpse()<a class="anchor" aria-label="anchor" href="#glimpse"><i class="fas fa-link"></i></a>
</h4>
<p>The function <code><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a target="_blank" href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></code> gives a sideways version of the table. This is useful if the table is very wide and you can't see all of the columns. It also tells you the <a class="glossary" target="_blank" title="The kind of data represented by an object." href="https://psyteachr.github.io/glossary/d#data-type">data type</a> of each column in angled brackets after each column name.</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">glimpse</span><span class="op">(</span><span class="va">table1</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 6
## Columns: 4
## $ country    &lt;chr&gt; "Afghanistan", "Afghanistan", "Brazil", "Brazil", "China", ~
## $ year       &lt;int&gt; 1999, 2000, 1999, 2000, 1999, 2000
## $ cases      &lt;int&gt; 745, 2666, 37737, 80488, 212258, 213766
## $ population &lt;int&gt; 19987071, 20595360, 172006362, 174504898, 1272915272, 12804~</code></pre>
</div>
<div id="summary-function" class="section level4" number="4.2.2.4">
<h4>
<span class="header-section-number">4.2.2.4</span> summary()<a class="anchor" aria-label="anchor" href="#summary-function"><i class="fas fa-link"></i></a>
</h4>
<p>You can get a quick summary of a dataset with the <code><span class="fu"><a target="_blank" href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></code> function.</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">table1</span><span class="op">)</span></code></pre></div>
<pre><code>##    country               year          cases          population       
##  Length:6           Min.   :1999   Min.   :   745   Min.   :1.999e+07  
##  Class :character   1st Qu.:1999   1st Qu.: 11434   1st Qu.:5.845e+07  
##  Mode  :character   Median :2000   Median : 59113   Median :1.733e+08  
##                     Mean   :2000   Mean   : 91277   Mean   :4.901e+08  
##                     3rd Qu.:2000   3rd Qu.:179316   3rd Qu.:9.983e+08  
##                     Max.   :2000   Max.   :213766   Max.   :1.280e+09</code></pre>
</div>
</div>
<div id="import_data" class="section level3" number="4.2.3">
<h3>
<span class="header-section-number">4.2.3</span> Importing data<a class="anchor" aria-label="anchor" href="#import_data"><i class="fas fa-link"></i></a>
</h3>
<p>Built-in data are nice for examples, but you're probably more interested in your own data. There are many different types of files that you might work with when doing data analysis. These different file types are usually distinguished by the three letter <a class="glossary" target="_blank" title="The end part of a file name that tells you what type of file it is (e.g., .R or .Rmd)." href="https://psyteachr.github.io/glossary/e#extension">extension</a> following a period at the end of the file name.</p>
<div id="rioimport" class="section level4" number="4.2.3.1">
<h4>
<span class="header-section-number">4.2.3.1</span> rio::import()<a class="anchor" aria-label="anchor" href="#rioimport"><i class="fas fa-link"></i></a>
</h4>
<p>The <code class="package">rio</code> package has very straightforward functions for reading and saving data: <code><span class="fu">rio</span><span class="fu">::</span><span class="fu"><a target="_blank" href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="op">)</span></code> and <code><span class="fu">rio</span><span class="fu">::</span><span class="fu"><a target="_blank" href="https://rdrr.io/pkg/rio/man/export.html">export</a></span><span class="op">(</span><span class="op">)</span></code>.</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">demo_tsv</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"data/demo.tsv"</span><span class="op">)</span>  <span class="co"># tab-separated values</span>
<span class="va">demo_csv</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"data/demo.csv"</span><span class="op">)</span>  <span class="co"># comma-separated values</span>
<span class="va">demo_xls</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"data/demo.xlsx"</span><span class="op">)</span> <span class="co"># Excel format</span>
<span class="va">demo_sav</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"data/demo.sav"</span><span class="op">)</span>  <span class="co"># SPSS format</span></code></pre></div>
</div>
<div id="file-type-specific-import" class="section level4" number="4.2.3.2">
<h4>
<span class="header-section-number">4.2.3.2</span> File type specific import<a class="anchor" aria-label="anchor" href="#file-type-specific-import"><i class="fas fa-link"></i></a>
</h4>
<p>However, it is also useful to know the specific functions that are used to import different file types because they tend to have more features to deal with complicated cases, such as when you need to skip rows, rename columns, or choose which Excel sheet to use.</p>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">demo_tsv</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_tsv</a></span><span class="op">(</span><span class="st">"data/demo.tsv"</span><span class="op">)</span>
<span class="va">demo_csv</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/demo.csv"</span><span class="op">)</span>
<span class="va">demo_xls</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="st">"data/demo.xlsx"</span><span class="op">)</span>
<span class="va">demo_sav</span> <span class="op">&lt;-</span> <span class="fu">haven</span><span class="fu">::</span><span class="fu"><a href="https://haven.tidyverse.org/reference/read_spss.html">read_sav</a></span><span class="op">(</span><span class="st">"data/demo.sav"</span><span class="op">)</span></code></pre></div>
<p>If you keep data in Google Sheets, you can access it directly from R using <code class="package"><a href="https://googlesheets4.tidyverse.org/" target="_blank">googlesheets4</a></code>. The code below imports data from a <a href="https://docs.google.com/spreadsheets/d/1yhAPP0hk6fNssL9UdpJ7m_vx00VY5PQKHspx6DNQNSY/" target="_blank">public sheet</a>.</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/gs4_deauth.html">gs4_deauth</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># skip authorisation for public data</span>

<span class="va">demo_gs4</span>  <span class="op">&lt;-</span> <span class="fu">googlesheets4</span><span class="fu">::</span><span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/range_read.html">read_sheet</a></span><span class="op">(</span>
  ss <span class="op">=</span> <span class="st">"1yhAPP0hk6fNssL9UdpJ7m_vx00VY5PQKHspx6DNQNSY"</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="col_types" class="section level4" number="4.2.3.3">
<h4>
<span class="header-section-number">4.2.3.3</span> Column data types<a class="anchor" aria-label="anchor" href="#col_types"><i class="fas fa-link"></i></a>
</h4>
<p>Use <code>glimpse()</code> to see how these different functions imported the data with slightly different data types. This is because the different file types store data slightly differently.</p>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">glimpse</span><span class="op">(</span><span class="va">demo_csv</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 6
## Columns: 6
## $ character &lt;chr&gt; "A", "B", "C", "D", "E", "F"
## $ factor    &lt;chr&gt; "high", "low", "med", "high", "low", "med"
## $ integer   &lt;dbl&gt; 1, 2, 3, 4, 5, 6
## $ double    &lt;dbl&gt; 1.5, 2.5, 3.5, 4.5, 5.5, 6.5
## $ logical   &lt;lgl&gt; TRUE, TRUE, FALSE, FALSE, NA, TRUE
## $ date      &lt;date&gt; 2021-10-14, 2021-10-13, 2021-10-12, 2021-10-11, 2021-10-10, ~</code></pre>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">glimpse</span><span class="op">(</span><span class="va">demo_xls</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 6
## Columns: 6
## $ character &lt;chr&gt; "A", "B", "C", "D", "E", "F"
## $ factor    &lt;chr&gt; "high", "low", "med", "high", "low", "med"
## $ integer   &lt;dbl&gt; 1, 2, 3, 4, 5, 6
## $ double    &lt;dbl&gt; 1.5, 2.5, 3.5, 4.5, 5.5, 6.5
## $ logical   &lt;lgl&gt; TRUE, TRUE, FALSE, FALSE, NA, TRUE
## $ date      &lt;dttm&gt; 2021-10-14, 2021-10-13, 2021-10-12, 2021-10-11, 2021-10-10, ~</code></pre>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">glimpse</span><span class="op">(</span><span class="va">demo_sav</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 6
## Columns: 6
## $ character &lt;chr&gt; "A", "B", "C", "D", "E", "F"
## $ factor    &lt;dbl+lbl&gt; 3, 1, 2, 3, 1, 2
## $ integer   &lt;dbl&gt; 1, 2, 3, 4, 5, 6
## $ double    &lt;dbl&gt; 1.5, 2.5, 3.5, 4.5, 5.5, 6.5
## $ logical   &lt;dbl&gt; 1, 1, 0, 0, NA, 1
## $ date      &lt;date&gt; 2021-10-14, 2021-10-13, 2021-10-12, 2021-10-11, 2021-10-10, ~</code></pre>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">glimpse</span><span class="op">(</span><span class="va">demo_gs4</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 6
## Columns: 6
## $ character &lt;chr&gt; "A", "B", "C", "D", "E", "F"
## $ factor    &lt;chr&gt; "high", "low", "med", "high", "low", "med"
## $ integer   &lt;dbl&gt; 1, 2, 3, 4, 5, 6
## $ number    &lt;dbl&gt; 1.5, 2.5, 3.5, 4.5, 5.5, 6.5
## $ logical   &lt;lgl&gt; TRUE, TRUE, FALSE, FALSE, NA, TRUE
## $ date      &lt;dttm&gt; 2021-09-01, 2021-08-31, 2021-08-30, 2021-08-29, 2021-08-28, ~</code></pre>
<p>The <code class="package">readr</code> functions display a message when you import data explaining what <a class="glossary" target="_blank" title="The kind of data represented by an object." href="https://psyteachr.github.io/glossary/d#data-type">data type</a> each column is.</p>
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">demo</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/demo.csv"</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 6 Columns: 6</code></pre>
<pre><code>## -- Column specification --------------------------------------------------------
## Delimiter: ","
## chr  (2): character, factor
## dbl  (2): integer, double
## lgl  (1): logical
## date (1): date</code></pre>
<pre><code>## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p>The "Column specification" tells you which <a class="glossary" target="_blank" title="The kind of data represented by an object." href="https://psyteachr.github.io/glossary/d#data-type">data type</a> each column is. You can review data types in Appendix <a href="data-types.html#data-types">E</a>. Options are:</p>
<ul>
<li>
<code>chr</code>: <a class="glossary" target="_blank" title="A data type representing strings of text." href="https://psyteachr.github.io/glossary/c#character">character</a>
</li>
<li>
<code>dbl</code>: <a class="glossary" target="_blank" title="A data type representing a real decimal number" href="https://psyteachr.github.io/glossary/d#double">double</a>
</li>
<li>
<code>lgl</code>: <a class="glossary" target="_blank" title="A data type representing TRUE or FALSE values." href="https://psyteachr.github.io/glossary/l#logical">logical</a>
</li>
<li>
<code>int</code>: <a class="glossary" target="_blank" title="A data type representing whole numbers." href="https://psyteachr.github.io/glossary/i#integer">integer</a>
</li>
<li>
<code>date</code>: date</li>
<li>
<code>dttm</code>: date/time</li>
</ul>
<p>If it makes a mistake, such as reading the "date" column as a <a class="glossary" target="_blank" title="A data type representing strings of text." href="https://psyteachr.github.io/glossary/c#character">character</a>, you can manually set the column data types. Copy the code that is printed when you run <code><a href="https://rdrr.io/r/stats/spectrum.html">spec(demo)</a></code>, and make any changes you need.</p>
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/spectrum.html">spec</a></span><span class="op">(</span><span class="va">demo</span><span class="op">)</span></code></pre></div>
<pre><code>## cols(
##   character = col_character(),
##   factor = col_character(),
##   integer = col_double(),
##   double = col_double(),
##   logical = col_logical(),
##   date = col_date(format = "")
## )</code></pre>
<p>Factor columns will always import as character data types, so you have to set their data type manually with <code>col_factor()</code> and set the order of levels with the <code>levels</code> argument. Otherwise, the order defaults to the order they appear in the dataset.</p>
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ct</span> <span class="op">&lt;-</span> <span class="fu">cols</span><span class="op">(</span>
  character <span class="op">=</span> <span class="fu">col_character</span><span class="op">(</span><span class="op">)</span>,
  factor <span class="op">=</span> <span class="fu">col_factor</span><span class="op">(</span>levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">"med"</span>, <span class="st">"high"</span><span class="op">)</span><span class="op">)</span>,
  integer <span class="op">=</span> <span class="fu">col_integer</span><span class="op">(</span><span class="op">)</span>,
  double <span class="op">=</span> <span class="fu">col_double</span><span class="op">(</span><span class="op">)</span>,
  logical <span class="op">=</span> <span class="fu">col_logical</span><span class="op">(</span><span class="op">)</span>,
  date <span class="op">=</span> <span class="fu">col_date</span><span class="op">(</span>format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">demo</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/demo.csv"</span>, col_types <span class="op">=</span> <span class="va">ct</span><span class="op">)</span></code></pre></div>
<div class="info">
<p>For dates, you might need to set the format your dates are in. See <code><a href="https://rdrr.io/r/base/strptime.html">?strptime</a></code> for a list of the codes used to represent different date formats. For example, <code><span class="st">"%d-%b-%y"</span></code> means that the dates are formatted like <code>31-Jan-21</code>.</p>
</div>
<p>The functions from <code class="package">readxl</code> have a different, more limited way to specify the column types. You will have to convert factor columns and dates using <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, which you'll learn about in Chapter <a href="wrangle.html#wrangle">6</a>, so most people let <code><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel()</a></code> guess data types and don't set the <code>col_types</code> argument.</p>
<p>The function <code><a href="https://haven.tidyverse.org/reference/read_spss.html">read_sav()</a></code> from <code class="package">haven</code> has an advantage over <code><a href="https://rdrr.io/pkg/rio/man/import.html">rio::import()</a></code> for factor data, which will just read the numeric values of factors and not their labels. However, you then have to convert factors from a haven-specific "labelled double" to a factor (I have no idea why haven doesn't do this for you).</p>
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">demo_sav</span><span class="op">$</span><span class="va">factor</span> <span class="op">&lt;-</span> <span class="fu">haven</span><span class="fu">::</span><span class="fu"><a href="https://haven.tidyverse.org/reference/as_factor.html">as_factor</a></span><span class="op">(</span><span class="va">demo_sav</span><span class="op">$</span><span class="va">factor</span><span class="op">)</span>

<span class="fu">glimpse</span><span class="op">(</span><span class="va">demo_sav</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 6
## Columns: 6
## $ character &lt;chr&gt; "A", "B", "C", "D", "E", "F"
## $ factor    &lt;fct&gt; high, low, med, high, low, med
## $ integer   &lt;dbl&gt; 1, 2, 3, 4, 5, 6
## $ double    &lt;dbl&gt; 1.5, 2.5, 3.5, 4.5, 5.5, 6.5
## $ logical   &lt;dbl&gt; 1, 1, 0, 0, NA, 1
## $ date      &lt;date&gt; 2021-10-14, 2021-10-13, 2021-10-12, 2021-10-11, 2021-10-10, ~</code></pre>
<div class="info">
<p>The way you specify column types for <code class="package">googlesheets4</code> is a little different from <code class="package">readr</code>, although you can also use the shortcodes described in the help for <code><a href="https://googlesheets4.tidyverse.org/reference/range_read.html">read_sheet()</a></code> with <code class="package">readr</code> functions. There is currently no column specification for factors.</p>
</div>
</div>
</div>
<div id="creating-data" class="section level3" number="4.2.4">
<h3>
<span class="header-section-number">4.2.4</span> Creating data<a class="anchor" aria-label="anchor" href="#creating-data"><i class="fas fa-link"></i></a>
</h3>
<p>If you need to create a small data table from scratch, use the <code><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a target="_blank" href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="op">)</span></code> function, and type the data right in. The <code>tibble</code> package is part of the <a class="glossary" target="_blank" title="A set of R packages that help you create and work with tidy data" href="https://psyteachr.github.io/glossary/t#tidyverse">tidyverse</a> package that we loaded at the start of this chapter.</p>
<p>Let's create a small table with the names of three Avatar characters and their bending type. The <code><span class="fu">tibble</span><span class="op">(</span><span class="op">)</span></code> function takes <a class="glossary" target="_blank" title="A variable that provides input to a function." href="https://psyteachr.github.io/glossary/a#argument">arguments</a> with the names that you want your columns to have. The values are <a class="glossary" target="_blank" title="A type of data structure that collects values with the same data type, like T/F values, numbers, or strings." href="https://psyteachr.github.io/glossary/v#vector">vectors</a> that list the column values in order.</p>
<p>If you don't know the value for one of the cells, you can enter <a class="glossary" target="_blank" title='A missing value that is "Not Available"' href="https://psyteachr.github.io/glossary/n#na">NA</a>, which we have to do for Sokka because he doesn't have any bending ability. If all the values in the column are the same, you can just enter one value and it will be copied for each row.</p>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">avatar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tibble.html">tibble</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Katara"</span>, <span class="st">"Toph"</span>, <span class="st">"Sokka"</span><span class="op">)</span>,
  bends <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"water"</span>, <span class="st">"earth"</span>, <span class="cn">NA</span><span class="op">)</span>,
  friendly <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="co"># print it</span>
<span class="va">avatar</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
name
</th>
<th style="text-align:left;">
bends
</th>
<th style="text-align:left;">
friendly
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Katara
</td>
<td style="text-align:left;">
water
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
Toph
</td>
<td style="text-align:left;">
earth
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
Sokka
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
</tbody>
</table></div>
</div>
<p>You can also use the <code><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a target="_blank" href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span><span class="op">)</span></code> function to create a table by row, rather than by column. You start by listing the column names, each preceded by a tilde (<code><a href="https://rdrr.io/r/base/tilde.html">~</a></code>), then you list the values for each column, row by row, separated by commas (don't forget a comma at the end of each row).</p>
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">avatar_by_row</span> <span class="op">&lt;-</span> <span class="fu">tribble</span><span class="op">(</span>
  <span class="op">~</span><span class="va">name</span>,    <span class="op">~</span><span class="va">bends</span>,  <span class="op">~</span><span class="va">friendly</span>,
  <span class="st">"Katara"</span>, <span class="st">"water"</span>, <span class="cn">TRUE</span>,
  <span class="st">"Toph"</span>,   <span class="st">"earth"</span>, <span class="cn">TRUE</span>,
  <span class="st">"Sokka"</span>,  <span class="cn">NA</span>,      <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<div class="info">
<p>You don't have to line up the columns in a tribble, but it can make it easier to spot errors.</p>
</div>
</div>
<div id="writing-data" class="section level3" number="4.2.5">
<h3>
<span class="header-section-number">4.2.5</span> Writing data<a class="anchor" aria-label="anchor" href="#writing-data"><i class="fas fa-link"></i></a>
</h3>
<p>If you have data that you want to save to a CSV file, use <code><span class="fu">rio</span><span class="fu">::</span><span class="fu"><a target="_blank" href="https://rdrr.io/pkg/rio/man/export.html">export</a></span><span class="op">(</span><span class="op">)</span></code>, as follows.</p>
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/rio/man/export.html">export</a></span><span class="op">(</span><span class="va">avatar</span>, <span class="st">"data/avatar.csv"</span><span class="op">)</span></code></pre></div>
<p>This will save the data in CSV format to your working directory.</p>
<p>Writing to Google Sheets is a little trickier. Even if a Google Sheet is publicly editable, you can't add data to it without authorising your account.</p>
<p>You can authorise interactively using the following code (and your own email), which will prompt you to authorise "Tidyverse API Packages" the first time you do this.</p>
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/gs4_auth.html">gs4_auth</a></span><span class="op">(</span>email <span class="op">=</span> <span class="st">"debruine@gmail.com"</span><span class="op">)</span>
<span class="va">sheet_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/gs4_create.html">gs4_create</a></span><span class="op">(</span><span class="st">"demo-file"</span>, sheets <span class="op">=</span> <span class="va">demo</span><span class="op">)</span>

<span class="va">new_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tibble.html">tibble</a></span><span class="op">(</span>
  character <span class="op">=</span> <span class="st">"Z"</span>,
  integer <span class="op">=</span> <span class="fl">0L</span>,
  double <span class="op">=</span> <span class="fl">0.5</span>,
  logical <span class="op">=</span> <span class="cn">FALSE</span>,
  date <span class="op">=</span> <span class="st">"01-Jan-00"</span>
<span class="op">)</span>

<span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/sheet_append.html">sheet_append</a></span><span class="op">(</span><span class="va">sheet_id</span>, <span class="va">new_data</span><span class="op">)</span>
<span class="va">demo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/range_read.html">read_sheet</a></span><span class="op">(</span><span class="va">sheet_id</span><span class="op">)</span></code></pre></div>
<div class="try">
<ul>
<li>Create a new table called <code>family</code> with the first name, last name, and age of your family members.</li>
<li>Save it to a CSV file called "family.csv".</li>
<li>Clear the object from your environment by restarting R or with the code <code><a href="https://rdrr.io/r/base/rm.html">remove(family)</a></code>.</li>
<li>Load the data back in and view it.</li>
</ul>
<div class="webex-solution">
<button>
Solution
</button>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create the table</span>
<span class="va">family</span> <span class="op">&lt;-</span> <span class="fu">tribble</span><span class="op">(</span>
  <span class="op">~</span><span class="va">first_name</span>, <span class="op">~</span><span class="va">last_name</span>, <span class="op">~</span><span class="va">age</span>,
  <span class="st">"Lisa"</span>, <span class="st">"DeBruine"</span>, <span class="fl">45</span>,
  <span class="st">"Robbie"</span>, <span class="st">"Jones"</span>, <span class="fl">14</span>
<span class="op">)</span>

<span class="co"># save the data to CSV</span>
<span class="fu"><a href="https://rdrr.io/pkg/rio/man/export.html">export</a></span><span class="op">(</span><span class="va">family</span>, <span class="st">"data/family.csv"</span><span class="op">)</span>

<span class="co"># remove the object from the environment</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">remove</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>

<span class="co"># load the data</span>
<span class="va">family</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"data/family.csv"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<p>We'll be working with <a class="glossary" target="_blank" title="Data in a rectangular table format, where each row has an entry for each column." href="https://psyteachr.github.io/glossary/t#tabular-data">tabular data</a> a lot in this class, but tabular data is made up of <a class="glossary" target="_blank" title="A type of data structure that collects values with the same data type, like T/F values, numbers, or strings." href="https://psyteachr.github.io/glossary/v#vector">vectors</a>, which groups together data with the same basic <a class="glossary" target="_blank" title="The kind of data represented by an object." href="https://psyteachr.github.io/glossary/d#data-type">data type</a>. Appendix <a href="data-types.html#data-types">E</a> explains some of this terminology to help you understand the functions we'll be learning to process and analyse data.</p>
</div>
<div id="troubleshooting" class="section level3" number="4.2.6">
<h3>
<span class="header-section-number">4.2.6</span> Troubleshooting<a class="anchor" aria-label="anchor" href="#troubleshooting"><i class="fas fa-link"></i></a>
</h3>
<p>What if you import some data and it guesses the wrong column type? The most common reason is that a numeric column has some non-numbers in it somewhere. Maybe someone wrote a note in an otherwise numeric column. Columns have to be all one data type, so if there are any characters, the whole column is converted to character strings, and numbers like <code><span class="fl">1.2</span></code> get represented as <code><span class="st">"1.2"</span></code>, which will cause very weird errors like <code>"100" &lt; "9" == TRUE</code>. You can catch this by using <code><span class="fu">glimpse</span><span class="op">(</span><span class="op">)</span></code> to check your data.</p>
<p>The data directory you downloaded contains a file called "mess.csv". Let's try loading this dataset.</p>
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mess</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"data/mess.csv"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in (function (input = "", file = NULL, text = NULL, cmd = NULL, :
## Stopped early on line 5. Expected 7 fields but found 0. Consider fill=TRUE
## and comment.char=. First discarded non-empty line: &lt;&lt;junk,missing,0.72,b,1,2 -
## 3,2020-01-2&gt;&gt;</code></pre>
<p>When importing goes wrong, it's often easier to fix it using the specific importing function for that file type. This is because the problems tend to be specific to the file format and you can look up the help for these functions more easily. For CSV files, the import function is <code><span class="fu">readr</span><span class="fu">::</span><span class="va"><a target="_blank" href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span></code>.</p>
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mess</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/mess.csv"</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 27 Columns: 1</code></pre>
<pre><code>## -- Column specification --------------------------------------------------------
## Delimiter: ","
## chr (1): This is my messy dataset</code></pre>
<pre><code>## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p>You'll get a warning with many parsing errors and <code>mess</code> is just a single row. View the file <code>data/mess.csv</code> by clicking on it in the File pane, and choosing "View File". Here are the first 10 lines. What went wrong?</p>
<pre><code>This is my messy dataset

junk,order,score,letter,good,min_max,date
junk,1,-1,a,1,1 - 2,2020-01-1

junk,missing,0.72,b,1,2 - 3,2020-01-2

junk,3,-0.62,c,FALSE,3 - 4,2020-01-3

junk,4,2.03,d,T,4 - 5,2020-01-4</code></pre>
<p>First, the file starts with a note: "This is my messy dataset". We want to skip the first two lines. You can do this with the argument <code>skip</code> in <code>read_csv()</code>.</p>
<div class="sourceCode" id="cb145"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mess</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/mess.csv"</span>, skip <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 26 Columns: 7</code></pre>
<pre><code>## -- Column specification --------------------------------------------------------
## Delimiter: ","
## chr (6): junk, order, letter, good, min_max, date
## dbl (1): score</code></pre>
<pre><code>## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb149"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mess</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
junk
</th>
<th style="text-align:left;">
order
</th>
<th style="text-align:right;">
score
</th>
<th style="text-align:left;">
letter
</th>
<th style="text-align:left;">
good
</th>
<th style="text-align:left;">
min_max
</th>
<th style="text-align:left;">
date
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
junk
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
-1.00
</td>
<td style="text-align:left;">
a
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1 - 2
</td>
<td style="text-align:left;">
2020-01-1
</td>
</tr>
<tr>
<td style="text-align:left;">
junk
</td>
<td style="text-align:left;">
missing
</td>
<td style="text-align:right;">
0.72
</td>
<td style="text-align:left;">
b
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
2 - 3
</td>
<td style="text-align:left;">
2020-01-2
</td>
</tr>
<tr>
<td style="text-align:left;">
junk
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
-0.62
</td>
<td style="text-align:left;">
c
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
3 - 4
</td>
<td style="text-align:left;">
2020-01-3
</td>
</tr>
<tr>
<td style="text-align:left;">
junk
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
2.03
</td>
<td style="text-align:left;">
d
</td>
<td style="text-align:left;">
T
</td>
<td style="text-align:left;">
4 - 5
</td>
<td style="text-align:left;">
2020-01-4
</td>
</tr>
<tr>
<td style="text-align:left;">
junk
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
e
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
5 - 6
</td>
<td style="text-align:left;">
2020-01-5
</td>
</tr>
<tr>
<td style="text-align:left;">
junk
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:right;">
0.99
</td>
<td style="text-align:left;">
f
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
6 - 7
</td>
<td style="text-align:left;">
2020-01-6
</td>
</tr>
<tr>
<td style="text-align:left;">
junk
</td>
<td style="text-align:left;">
7
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:left;">
g
</td>
<td style="text-align:left;">
T
</td>
<td style="text-align:left;">
7 - 8
</td>
<td style="text-align:left;">
2020-01-7
</td>
</tr>
<tr>
<td style="text-align:left;">
junk
</td>
<td style="text-align:left;">
8
</td>
<td style="text-align:right;">
0.67
</td>
<td style="text-align:left;">
h
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
8 - 9
</td>
<td style="text-align:left;">
2020-01-8
</td>
</tr>
<tr>
<td style="text-align:left;">
junk
</td>
<td style="text-align:left;">
9
</td>
<td style="text-align:right;">
0.57
</td>
<td style="text-align:left;">
i
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
9 - 10
</td>
<td style="text-align:left;">
2020-01-9
</td>
</tr>
<tr>
<td style="text-align:left;">
junk
</td>
<td style="text-align:left;">
10
</td>
<td style="text-align:right;">
0.90
</td>
<td style="text-align:left;">
j
</td>
<td style="text-align:left;">
T
</td>
<td style="text-align:left;">
10 - 11
</td>
<td style="text-align:left;">
2020-01-10
</td>
</tr>
<tr>
<td style="text-align:left;">
junk
</td>
<td style="text-align:left;">
11
</td>
<td style="text-align:right;">
-1.55
</td>
<td style="text-align:left;">
k
</td>
<td style="text-align:left;">
F
</td>
<td style="text-align:left;">
11 - 12
</td>
<td style="text-align:left;">
2020-01-11
</td>
</tr>
<tr>
<td style="text-align:left;">
junk
</td>
<td style="text-align:left;">
12
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
l
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
12 - 13
</td>
<td style="text-align:left;">
2020-01-12
</td>
</tr>
<tr>
<td style="text-align:left;">
junk
</td>
<td style="text-align:left;">
13
</td>
<td style="text-align:right;">
0.15
</td>
<td style="text-align:left;">
m
</td>
<td style="text-align:left;">
T
</td>
<td style="text-align:left;">
13 - 14
</td>
<td style="text-align:left;">
2020-01-13
</td>
</tr>
<tr>
<td style="text-align:left;">
junk
</td>
<td style="text-align:left;">
14
</td>
<td style="text-align:right;">
-0.66
</td>
<td style="text-align:left;">
n
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
14 - 15
</td>
<td style="text-align:left;">
2020-01-14
</td>
</tr>
<tr>
<td style="text-align:left;">
junk
</td>
<td style="text-align:left;">
15
</td>
<td style="text-align:right;">
-0.99
</td>
<td style="text-align:left;">
o
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
15 - 16
</td>
<td style="text-align:left;">
2020-01-15
</td>
</tr>
<tr>
<td style="text-align:left;">
junk
</td>
<td style="text-align:left;">
16
</td>
<td style="text-align:right;">
1.97
</td>
<td style="text-align:left;">
p
</td>
<td style="text-align:left;">
T
</td>
<td style="text-align:left;">
16 - 17
</td>
<td style="text-align:left;">
2020-01-16
</td>
</tr>
<tr>
<td style="text-align:left;">
junk
</td>
<td style="text-align:left;">
17
</td>
<td style="text-align:right;">
-0.44
</td>
<td style="text-align:left;">
q
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
17 - 18
</td>
<td style="text-align:left;">
2020-01-17
</td>
</tr>
<tr>
<td style="text-align:left;">
junk
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:right;">
-0.90
</td>
<td style="text-align:left;">
r
</td>
<td style="text-align:left;">
F
</td>
<td style="text-align:left;">
18 - 19
</td>
<td style="text-align:left;">
2020-01-18
</td>
</tr>
<tr>
<td style="text-align:left;">
junk
</td>
<td style="text-align:left;">
19
</td>
<td style="text-align:right;">
-0.15
</td>
<td style="text-align:left;">
s
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
19 - 20
</td>
<td style="text-align:left;">
2020-01-19
</td>
</tr>
<tr>
<td style="text-align:left;">
junk
</td>
<td style="text-align:left;">
20
</td>
<td style="text-align:right;">
-0.83
</td>
<td style="text-align:left;">
t
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
20 - 21
</td>
<td style="text-align:left;">
2020-01-20
</td>
</tr>
<tr>
<td style="text-align:left;">
junk
</td>
<td style="text-align:left;">
21
</td>
<td style="text-align:right;">
1.99
</td>
<td style="text-align:left;">
u
</td>
<td style="text-align:left;">
T
</td>
<td style="text-align:left;">
21 - 22
</td>
<td style="text-align:left;">
2020-01-21
</td>
</tr>
<tr>
<td style="text-align:left;">
junk
</td>
<td style="text-align:left;">
22
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:left;">
v
</td>
<td style="text-align:left;">
F
</td>
<td style="text-align:left;">
22 - 23
</td>
<td style="text-align:left;">
2020-01-22
</td>
</tr>
<tr>
<td style="text-align:left;">
junk
</td>
<td style="text-align:left;">
23
</td>
<td style="text-align:right;">
-0.40
</td>
<td style="text-align:left;">
w
</td>
<td style="text-align:left;">
F
</td>
<td style="text-align:left;">
23 - 24
</td>
<td style="text-align:left;">
2020-01-23
</td>
</tr>
<tr>
<td style="text-align:left;">
junk
</td>
<td style="text-align:left;">
24
</td>
<td style="text-align:right;">
-0.47
</td>
<td style="text-align:left;">
x
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
24 - 25
</td>
<td style="text-align:left;">
2020-01-24
</td>
</tr>
<tr>
<td style="text-align:left;">
junk
</td>
<td style="text-align:left;">
25
</td>
<td style="text-align:right;">
-0.41
</td>
<td style="text-align:left;">
y
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
25 - 26
</td>
<td style="text-align:left;">
2020-01-25
</td>
</tr>
<tr>
<td style="text-align:left;">
junk
</td>
<td style="text-align:left;">
26
</td>
<td style="text-align:right;">
0.68
</td>
<td style="text-align:left;">
z
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
26 - 27
</td>
<td style="text-align:left;">
2020-01-26
</td>
</tr>
</tbody>
</table></div>
</div>
<p>OK, that's a little better, but this table is still a serious mess in several ways:</p>
<ul>
<li>
<code>junk</code> is a column that we don't need</li>
<li>
<code>order</code> should be an integer column</li>
<li>
<code>good</code> should be a logical column</li>
<li>
<code>good</code> uses all kinds of different ways to record TRUE and FALSE values</li>
<li>
<code>min_max</code> contains two pieces of numeric information, but is a character column</li>
<li>
<code>date</code> should be a date column</li>
</ul>
<p>We'll learn how to deal with this mess in Chapters <a href="tidy.html#tidy">5</a> and <a href="wrangle.html#wrangle">6</a>, but we can fix a few things by setting the <code>col_types</code> argument in <code><span class="fu">read_csv</span><span class="op">(</span><span class="op">)</span></code> to specify the column types for our two columns that were guessed wrong and skip the "junk" column. The argument <code>col_types</code> takes a list where the name of each item in the list is a column name and the value is from the table below. You can use the function, like <code><span class="fu">col_double</span><span class="op">(</span><span class="op">)</span></code> or the abbreviation, like <code><span class="st">"l"</span></code>. Omitted column names are guessed.</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">function</th>
<th align="left"></th>
<th align="left">abbreviation</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">col_logical()</td>
<td align="left">l</td>
<td align="left">logical values</td>
</tr>
<tr class="even">
<td align="left">col_integer()</td>
<td align="left">i</td>
<td align="left">integer values</td>
</tr>
<tr class="odd">
<td align="left">col_double()</td>
<td align="left">d</td>
<td align="left">numeric values</td>
</tr>
<tr class="even">
<td align="left">col_character()</td>
<td align="left">c</td>
<td align="left">strings</td>
</tr>
<tr class="odd">
<td align="left">col_factor(levels, ordered)</td>
<td align="left">f</td>
<td align="left">a fixed set of values</td>
</tr>
<tr class="even">
<td align="left">col_date(format = "")</td>
<td align="left">D</td>
<td align="left">with the locale's date_format</td>
</tr>
<tr class="odd">
<td align="left">col_time(format = "")</td>
<td align="left">t</td>
<td align="left">with the locale's time_format</td>
</tr>
<tr class="even">
<td align="left">col_datetime(format = "")</td>
<td align="left">T</td>
<td align="left">ISO8601 date time</td>
</tr>
<tr class="odd">
<td align="left">col_number()</td>
<td align="left">n</td>
<td align="left">numbers containing the grouping_mark</td>
</tr>
<tr class="even">
<td align="left">col_skip()</td>
<td align="left">_, -</td>
<td align="left">don't import this column</td>
</tr>
<tr class="odd">
<td align="left">col_guess()</td>
<td align="left">?</td>
<td align="left">parse using the "best" type based on the input</td>
</tr>
</tbody>
</table></div>
<div class="sourceCode" id="cb150"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># omitted values are guessed</span>
<span class="co"># ?col_date for format options</span>
<span class="va">ct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  junk <span class="op">=</span> <span class="st">"-"</span>, <span class="co"># skip this column</span>
  order <span class="op">=</span> <span class="st">"i"</span>,
  good <span class="op">=</span> <span class="st">"l"</span>,
  date <span class="op">=</span> <span class="fu">col_date</span><span class="op">(</span>format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">tidier</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/mess.csv"</span>, 
                   skip <span class="op">=</span> <span class="fl">2</span>,
                   col_types <span class="op">=</span> <span class="va">ct</span><span class="op">)</span></code></pre></div>
<p>You will get a message about "parsing failures" when you run this. Warnings look scary at first, but always start by reading the message.</p>
<div class="sourceCode" id="cb151"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">problems</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>The table tells you what row (<code>3</code>) and column (<code>2</code>) the error was found in, what kind of data was expected (<code>integer</code>), and what the actual value was (<code><span class="st">"missing"</span></code>). If you specifically tell <code><span class="fu">read_csv</span><span class="op">(</span><span class="op">)</span></code> to import a column as an integer, any characters in the column will produce a warning like this and then be recorded as <code>NA</code>. You can manually set what the missing values were recorded as with the <code>na</code> argument.</p>
<div class="sourceCode" id="cb152"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tidiest</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/mess.csv"</span>, 
                   skip <span class="op">=</span> <span class="fl">2</span>,
                   na <span class="op">=</span> <span class="st">"missing"</span>,
                   col_types <span class="op">=</span> <span class="va">ct</span><span class="op">)</span></code></pre></div>
<p>Now <code>order</code> is an integer where "missing" is now <code>NA</code>, <code>good</code> is a logical value, where <code><span class="fl">0</span></code> and <code><span class="cn">F</span></code> are converted to <code><span class="cn">FALSE</span></code> and <code><span class="fl">1</span></code> and <code><span class="cn">T</span></code> are converted to <code><span class="cn">TRUE</span></code>, and <code>date</code> is a date type (adding leading zeros to the day). We'll learn in later chapters how to fix other problems, such as the <code>min_max</code> column containing two different types of data.</p>
<div class="sourceCode" id="cb153"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">tidiest</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
order
</th>
<th style="text-align:left;">
score
</th>
<th style="text-align:left;">
letter
</th>
<th style="text-align:left;">
good
</th>
<th style="text-align:left;">
min_max
</th>
<th style="text-align:left;">
date
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
-1
</td>
<td style="text-align:left;">
a
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
1 - 2
</td>
<td style="text-align:left;">
2020-01-01
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
0.72
</td>
<td style="text-align:left;">
b
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
2 - 3
</td>
<td style="text-align:left;">
2020-01-02
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
-0.62
</td>
<td style="text-align:left;">
c
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
3 - 4
</td>
<td style="text-align:left;">
2020-01-03
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
2.03
</td>
<td style="text-align:left;">
d
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
4 - 5
</td>
<td style="text-align:left;">
2020-01-04
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
e
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
5 - 6
</td>
<td style="text-align:left;">
2020-01-05
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
0.99
</td>
<td style="text-align:left;">
f
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
6 - 7
</td>
<td style="text-align:left;">
2020-01-06
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
</div>
<div id="data-relations" class="section level2" number="4.3">
<h2>
<span class="header-section-number">4.3</span> Data Relations<a class="anchor" aria-label="anchor" href="#data-relations"><i class="fas fa-link"></i></a>
</h2>
<p>The data you want to report on or visualise are often in more than one file (or more than one tab of an excel file or googlesheet). You might need to join up a table of customer information with a table of orders, or combine the monthly social media reports across several months.</p>
<p>For this demo, first we'll create two small data tables.</p>
<p><code>customer</code> has id, city and postcode for customers 1-5. City and postcode are missing for customer 3.</p>
<div class="sourceCode" id="cb154"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">customers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tibble.html">tibble</a></span><span class="op">(</span>
  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,
  city <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Port Ellen"</span>, <span class="st">"Dufftown"</span>, <span class="cn">NA</span>, <span class="st">"Aberlour"</span>, <span class="st">"Tobermory"</span><span class="op">)</span>,
  postcode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PA42 7DU"</span>, <span class="st">"AB55 4DH"</span>, <span class="cn">NA</span>, <span class="st">"AB38 7RY"</span>, <span class="st">"PA75 6NR"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Port Ellen
</td>
<td style="text-align:left;">
PA42 7DU
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Dufftown
</td>
<td style="text-align:left;">
AB55 4DH
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
</tr>
</tbody>
</table></div>
<p><code>orders</code> has customer id and the number of items ordered. Some customers have no orders, some have more than one order, and some are not in the customer table.</p>
<div class="sourceCode" id="cb155"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">orders</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tibble.html">tibble</a></span><span class="op">(</span>
  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">6</span>, <span class="fl">7</span><span class="op">)</span>,
  items <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">18</span>, <span class="fl">21</span>, <span class="fl">23</span>, <span class="fl">9</span>, <span class="fl">11</span>, <span class="fl">11</span>, <span class="fl">12</span>, <span class="fl">3</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:right;">
items
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
21
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
23
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table></div>
<div id="mutating-joins" class="section level3" number="4.3.1">
<h3>
<span class="header-section-number">4.3.1</span> Mutating Joins<a class="anchor" aria-label="anchor" href="#mutating-joins"><i class="fas fa-link"></i></a>
</h3>
<p><a class="glossary" target="_blank" title="Joins that act like the dplyr::mutate() function in that they add new columns to one table based on values in another table." href="https://psyteachr.github.io/glossary/m#mutating-joins">Mutating joins</a> act like the <code><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a target="_blank" href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="op">)</span></code> function in that they add new columns to one table based on values in another table. (We'll learn more about the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> function in Chapter <a href="tidy.html#tidy">5</a>.)</p>
<p>All the mutating joins have this basic syntax:</p>
<p><code>****_join(x, y, by = NULL, suffix = c(".x", ".y")</code></p>
<ul>
<li>
<code>x</code> = the first (left) table</li>
<li>
<code>y</code> = the second (right) table</li>
<li>
<code>by</code> = what columns to match on. If you leave this blank, it will match on all columns with the same names in the two tables.</li>
<li>
<code>suffix</code> = if columns have the same name in the two tables, but you aren't joining by them, they get a suffix to make them unambiguous. This defaults to ".x" and ".y", but you can change it to something more meaningful.</li>
</ul>
<div class="info">
<p>You can leave out the <code>by</code> argument if you're matching on all of the columns with the same name, but it's good practice to always specify it so your code is robust to changes in the loaded data.</p>
</div>
<div id="left_join" class="section level4" number="4.3.1.1">
<h4>
<span class="header-section-number">4.3.1.1</span> left_join()<a class="anchor" aria-label="anchor" href="#left_join"><i class="fas fa-link"></i></a>
</h4>
<div class="join">
<img src="images/joins/left_join.png">
</div>
<p>A <code>left_join</code> keeps all the data from the first (left) table and joins anything that matches from the second (right) table. If the right table has more than one match for a row in the right table, there will be more than one row in the joined table (see ids 4 and 5).</p>
<div class="sourceCode" id="cb156"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">left_join</span><span class="op">(</span><span class="va">customers</span>, <span class="va">orders</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
<th style="text-align:right;">
items
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Port Ellen
</td>
<td style="text-align:left;">
PA42 7DU
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Dufftown
</td>
<td style="text-align:left;">
AB55 4DH
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
<td style="text-align:right;">
21
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
<td style="text-align:right;">
23
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
<td style="text-align:right;">
11
</td>
</tr>
</tbody>
</table></div>
</div>
<div class="join">
<img src="images/joins/left_join_rev.png">
</div>
<p>The order of tables is swapped here, so the result is all rows from the <code>orders</code> table joined to any matching rows from the <code>customers</code> table.</p>
<div class="sourceCode" id="cb157"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">left_join</span><span class="op">(</span><span class="va">orders</span>, <span class="va">customers</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:right;">
items
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
Dufftown
</td>
<td style="text-align:left;">
AB55 4DH
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="right_join" class="section level4" number="4.3.1.2">
<h4>
<span class="header-section-number">4.3.1.2</span> right_join()<a class="anchor" aria-label="anchor" href="#right_join"><i class="fas fa-link"></i></a>
</h4>
<div class="join">
<img src="images/joins/right_join.png">
</div>
<p>A <code>right_join</code> keeps all the data from the second (right) table and joins anything that matches from the first (left) table.</p>
<div class="sourceCode" id="cb158"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">right_join</span><span class="op">(</span><span class="va">customers</span>, <span class="va">orders</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
<th style="text-align:right;">
items
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Dufftown
</td>
<td style="text-align:left;">
AB55 4DH
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
<td style="text-align:right;">
21
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
<td style="text-align:right;">
23
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table></div>
</div>
<div class="info">
<p>This table has the same information as <code>left_join(orders, customers, by = "id")</code>, but the columns are in a different order (left table, then right table).</p>
</div>
</div>
<div id="inner_join" class="section level4" number="4.3.1.3">
<h4>
<span class="header-section-number">4.3.1.3</span> inner_join()<a class="anchor" aria-label="anchor" href="#inner_join"><i class="fas fa-link"></i></a>
</h4>
<div class="join">
<img src="images/joins/inner_join.png">
</div>
<p>An <code>inner_join</code> returns all the rows that have a match in the other table.</p>
<div class="sourceCode" id="cb159"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">inner_join</span><span class="op">(</span><span class="va">customers</span>, <span class="va">orders</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
<th style="text-align:right;">
items
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Dufftown
</td>
<td style="text-align:left;">
AB55 4DH
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
<td style="text-align:right;">
21
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
<td style="text-align:right;">
23
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
<td style="text-align:right;">
11
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="full_join" class="section level4" number="4.3.1.4">
<h4>
<span class="header-section-number">4.3.1.4</span> full_join()<a class="anchor" aria-label="anchor" href="#full_join"><i class="fas fa-link"></i></a>
</h4>
<div class="join">
<img src="images/joins/full_join.png">
</div>
<p>A <code>full_join</code> lets you join up rows in two tables while keeping all of the information from both tables. If a row doesn't have a match in the other table, the other table's column values are set to <code>NA</code>.</p>
<div class="sourceCode" id="cb160"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">full_join</span><span class="op">(</span><span class="va">customers</span>, <span class="va">orders</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
<th style="text-align:right;">
items
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Port Ellen
</td>
<td style="text-align:left;">
PA42 7DU
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Dufftown
</td>
<td style="text-align:left;">
AB55 4DH
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
<td style="text-align:right;">
21
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
<td style="text-align:right;">
23
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
</div>
<div id="filtering-joins" class="section level3" number="4.3.2">
<h3>
<span class="header-section-number">4.3.2</span> Filtering Joins<a class="anchor" aria-label="anchor" href="#filtering-joins"><i class="fas fa-link"></i></a>
</h3>
<p><a class="glossary" target="_blank" title="Joins that act like the dplyr::filter() function in that they remove rows from the data in one table based on the values in another table." href="https://psyteachr.github.io/glossary/f#filtering-joins">Filtering joins</a> act like the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> function in that they remove rows from the data in one table based on the values in another table. The result of a filtering join will only contain rows from the left table and have the same number or fewer rows than the left table. (We'll learn more about the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> function in Chapter <a href="wrangle.html#wrangle">6</a>.)</p>
<div id="semi_join" class="section level4" number="4.3.2.1">
<h4>
<span class="header-section-number">4.3.2.1</span> semi_join()<a class="anchor" aria-label="anchor" href="#semi_join"><i class="fas fa-link"></i></a>
</h4>
<div class="join">
<img src="images/joins/semi_join.png">
</div>
<p>A <code>semi_join</code> returns all rows from the left table where there are matching values in the right table, keeping just columns from the left table.</p>
<div class="sourceCode" id="cb161"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">semi_join</span><span class="op">(</span><span class="va">customers</span>, <span class="va">orders</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Dufftown
</td>
<td style="text-align:left;">
AB55 4DH
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
</tr>
</tbody>
</table></div>
</div>
<div class="info">
<p>Unlike an inner join, a semi join will never duplicate the rows in the left table if there is more than one matching row in the right table.</p>
</div>
<div class="join">
<img src="images/joins/semi_join_rev.png">
</div>
<p>Order matters in a semi join.</p>
<div class="sourceCode" id="cb162"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">semi_join</span><span class="op">(</span><span class="va">orders</span>, <span class="va">customers</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:right;">
items
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
21
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
23
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
11
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="anti_join" class="section level4" number="4.3.2.2">
<h4>
<span class="header-section-number">4.3.2.2</span> anti_join()<a class="anchor" aria-label="anchor" href="#anti_join"><i class="fas fa-link"></i></a>
</h4>
<div class="join">
<img src="images/joins/anti_join.png">
</div>
<p>An <code>anti_join</code> return all rows from the left table where there are <em>not</em> matching values in the right table, keeping just columns from the left table.</p>
<div class="sourceCode" id="cb163"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">anti_join</span><span class="op">(</span><span class="va">customers</span>, <span class="va">orders</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Port Ellen
</td>
<td style="text-align:left;">
PA42 7DU
</td>
</tr></tbody>
</table></div>
</div>
<div class="join">
<img src="images/joins/anti_join_rev.png">
</div>
<p>Order matters in an anti join.</p>
<div class="sourceCode" id="cb164"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">anti_join</span><span class="op">(</span><span class="va">orders</span>, <span class="va">customers</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:right;">
items
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
</div>
<div id="binding-joins" class="section level3" number="4.3.3">
<h3>
<span class="header-section-number">4.3.3</span> Binding Joins<a class="anchor" aria-label="anchor" href="#binding-joins"><i class="fas fa-link"></i></a>
</h3>
<p><a class="glossary" target="_blank" title="Joins that bind one table to another by adding their rows or columns together." href="https://psyteachr.github.io/glossary/b#binding-joins">Binding joins</a> bind one table to another by adding their rows or columns together.</p>
<div id="bind_rows" class="section level4" number="4.3.3.1">
<h4>
<span class="header-section-number">4.3.3.1</span> bind_rows()<a class="anchor" aria-label="anchor" href="#bind_rows"><i class="fas fa-link"></i></a>
</h4>
<p>You can combine the rows of two tables with <code>bind_rows</code>.</p>
<p>Here we'll add customer data for customers 6-9 and bind that to the original customer table.</p>
<div class="sourceCode" id="cb165"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_customers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tibble.html">tibble</a></span><span class="op">(</span>
  id <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">9</span>,
  city <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Falkirk"</span>, <span class="st">"Ardbeg"</span>, <span class="st">"Doogal"</span>, <span class="st">"Kirkwall"</span><span class="op">)</span>,
  postcode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FK1 4RS"</span>, <span class="st">"PA42 7EA"</span>, <span class="st">"G81 4SJ"</span>, <span class="st">"KW15 1SE"</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu">bind_rows</span><span class="op">(</span><span class="va">customers</span>, <span class="va">new_customers</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Port Ellen
</td>
<td style="text-align:left;">
PA42 7DU
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Dufftown
</td>
<td style="text-align:left;">
AB55 4DH
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Falkirk
</td>
<td style="text-align:left;">
FK1 4RS
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
Ardbeg
</td>
<td style="text-align:left;">
PA42 7EA
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
Doogal
</td>
<td style="text-align:left;">
G81 4SJ
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Kirkwall
</td>
<td style="text-align:left;">
KW15 1SE
</td>
</tr>
</tbody>
</table></div>
</div>
<p>The columns just have to have the same names, they don't have to be in the same order. Any columns that differ between the two tables will just have <code>NA</code> values for entries from the other table.</p>
<p>If a row is duplicated between the two tables (like id 5 below), the row will also be duplicated in the resulting table. If your tables have the exact same columns, you can use <code><a href="https://generics.r-lib.org/reference/setops.html">union()</a></code> (see below) to avoid duplicates.</p>
<div class="sourceCode" id="cb166"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_customers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tibble.html">tibble</a></span><span class="op">(</span>
  id <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">9</span>,
  postcode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PA75 6NR"</span>, <span class="st">"FK1 4RS"</span>, <span class="st">"PA42 7EA"</span>, <span class="st">"G81 4SJ"</span>, <span class="st">"KW15 1SE"</span><span class="op">)</span>,
  city <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tobermory"</span>, <span class="st">"Falkirk"</span>, <span class="st">"Ardbeg"</span>, <span class="st">"Doogal"</span>, <span class="st">"Kirkwall"</span><span class="op">)</span>,
  new <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu">bind_rows</span><span class="op">(</span><span class="va">customers</span>, <span class="va">new_customers</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
<th style="text-align:right;">
new
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Port Ellen
</td>
<td style="text-align:left;">
PA42 7DU
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Dufftown
</td>
<td style="text-align:left;">
AB55 4DH
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Falkirk
</td>
<td style="text-align:left;">
FK1 4RS
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
Ardbeg
</td>
<td style="text-align:left;">
PA42 7EA
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
Doogal
</td>
<td style="text-align:left;">
G81 4SJ
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Kirkwall
</td>
<td style="text-align:left;">
KW15 1SE
</td>
<td style="text-align:right;">
5
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="bind_cols" class="section level4" number="4.3.3.2">
<h4>
<span class="header-section-number">4.3.3.2</span> bind_cols()<a class="anchor" aria-label="anchor" href="#bind_cols"><i class="fas fa-link"></i></a>
</h4>
<p>You can merge two tables with the same number of rows using <code>bind_cols</code>. This is only useful if the two tables have their rows in the exact same order. The only advantage over a left join is when the tables don't have any IDs to join by and you have to rely solely on their order.</p>
<div class="sourceCode" id="cb167"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tibble.html">tibble</a></span><span class="op">(</span>
  colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"orange"</span>, <span class="st">"yellow"</span>, <span class="st">"green"</span>, <span class="st">"blue"</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu">bind_cols</span><span class="op">(</span><span class="va">customers</span>, <span class="va">new_info</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
<th style="text-align:left;">
colour
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Port Ellen
</td>
<td style="text-align:left;">
PA42 7DU
</td>
<td style="text-align:left;">
red
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Dufftown
</td>
<td style="text-align:left;">
AB55 4DH
</td>
<td style="text-align:left;">
orange
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
yellow
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
<td style="text-align:left;">
green
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
<td style="text-align:left;">
blue
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="importing-folders" class="section level4" number="4.3.3.3">
<h4>
<span class="header-section-number">4.3.3.3</span> Importing folders<a class="anchor" aria-label="anchor" href="#importing-folders"><i class="fas fa-link"></i></a>
</h4>
<p>If you need to import and bind a whole folder full of files that have the same structure, get a list of all the files you want to combine. It's easiest if they're all in the same directory, although you can use a pattern to select the files you want if they have a systematic naming structure.</p>
<div class="sourceCode" id="cb168"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># write our data to a new folder for the demo</span>
<span class="fu">write_csv</span><span class="op">(</span>x <span class="op">=</span> <span class="va">customers</span>, file <span class="op">=</span> <span class="st">"data/customers1.csv"</span><span class="op">)</span>
<span class="fu">write_csv</span><span class="op">(</span>x <span class="op">=</span> <span class="va">new_customers</span>, file <span class="op">=</span> <span class="st">"data/customers2.csv"</span><span class="op">)</span>

<span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>
  path <span class="op">=</span> <span class="st">"data"</span>, 
  pattern <span class="op">=</span> <span class="st">"customers"</span>,
  full.names <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="va">files</span></code></pre></div>
<pre><code>## [1] "data/customers1.csv" "data/customers2.csv"</code></pre>
<p>Now we can use <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map_df()</a></code> to map over the list of file paths, open them with <code>read_csv()</code>, and return a table with all the combined data.</p>
<div class="sourceCode" id="cb170"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_df</a></span><span class="op">(</span><span class="va">files</span>, <span class="va">read_csv</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
<th style="text-align:right;">
new
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Port Ellen
</td>
<td style="text-align:left;">
PA42 7DU
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Dufftown
</td>
<td style="text-align:left;">
AB55 4DH
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Falkirk
</td>
<td style="text-align:left;">
FK1 4RS
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
Ardbeg
</td>
<td style="text-align:left;">
PA42 7EA
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
Doogal
</td>
<td style="text-align:left;">
G81 4SJ
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Kirkwall
</td>
<td style="text-align:left;">
KW15 1SE
</td>
<td style="text-align:right;">
5
</td>
</tr>
</tbody>
</table></div>
</div>
<div class="sourceCode" id="cb171"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># clean up temporary files</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.remove</a></span><span class="op">(</span><span class="st">"data/customers1.csv"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.remove</a></span><span class="op">(</span><span class="st">"data/customers2.csv"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE
## [1] TRUE</code></pre>
</div>
</div>
<div id="set-operations" class="section level3" number="4.3.4">
<h3>
<span class="header-section-number">4.3.4</span> Set Operations<a class="anchor" aria-label="anchor" href="#set-operations"><i class="fas fa-link"></i></a>
</h3>
<p><a class="glossary" target="_blank" title="Functions that compare two tables and return rows that match (intersect), are in either table (union), or are in one table but not the other (setdiff)." href="https://psyteachr.github.io/glossary/s#set-operations">Set operations</a> compare two tables and return rows that match (intersect), are in either table (union), or are in one table but not the other (setdiff).</p>
<div id="intersect" class="section level4" number="4.3.4.1">
<h4>
<span class="header-section-number">4.3.4.1</span> intersect()<a class="anchor" aria-label="anchor" href="#intersect"><i class="fas fa-link"></i></a>
</h4>
<p><code><a href="https://generics.r-lib.org/reference/setops.html">intersect()</a></code> returns all rows in two tables that match exactly. The columns don't have to be in the same order.</p>
<div class="sourceCode" id="cb173"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_customers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tibble.html">tibble</a></span><span class="op">(</span>
  id <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">9</span>,
  postcode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PA75 6NR"</span>, <span class="st">"FK1 4RS"</span>, <span class="st">"PA42 7EA"</span>, <span class="st">"G81 4SJ"</span>, <span class="st">"KW15 1SE"</span><span class="op">)</span>,
  city <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tobermory"</span>, <span class="st">"Falkirk"</span>, <span class="st">"Ardbeg"</span>, <span class="st">"Doogal"</span>, <span class="st">"Kirkwall"</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu"><a href="https://generics.r-lib.org/reference/setops.html">intersect</a></span><span class="op">(</span><span class="va">customers</span>, <span class="va">new_customers</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
</tr></tbody>
</table></div>
</div>
<div class="warning">
<p>If you've forgotten to load dplyr or the tidyverse, <a class="glossary" target="_blank" title="The set of R functions that come with a basic installation of R, before you add external packages" href="https://psyteachr.github.io/glossary/b#base-r">base R</a> also has an <code><a href="https://generics.r-lib.org/reference/setops.html">intersect()</a></code> function. The error message can be confusing and looks something like this:</p>
<div class="sourceCode" id="cb174"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">customers</span>, <span class="va">new_customers</span><span class="op">)</span></code></pre></div>
<pre><code>## Error: Must subset rows with a valid subscript vector.
## i Logical subscripts must match the size of the indexed input.
## x Input has size 5 but subscript `!duplicated(x, fromLast = fromLast, ...)` has size 0.</code></pre>
</div>
</div>
<div id="union" class="section level4" number="4.3.4.2">
<h4>
<span class="header-section-number">4.3.4.2</span> union()<a class="anchor" aria-label="anchor" href="#union"><i class="fas fa-link"></i></a>
</h4>
<p><code><a href="https://generics.r-lib.org/reference/setops.html">union()</a></code> returns all the rows from both tables, removing duplicate rows.</p>
<div class="sourceCode" id="cb176"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html">union</a></span><span class="op">(</span><span class="va">customers</span>, <span class="va">new_customers</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Port Ellen
</td>
<td style="text-align:left;">
PA42 7DU
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Dufftown
</td>
<td style="text-align:left;">
AB55 4DH
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Falkirk
</td>
<td style="text-align:left;">
FK1 4RS
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
Ardbeg
</td>
<td style="text-align:left;">
PA42 7EA
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
Doogal
</td>
<td style="text-align:left;">
G81 4SJ
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Kirkwall
</td>
<td style="text-align:left;">
KW15 1SE
</td>
</tr>
</tbody>
</table></div>
</div>
<div class="warning">
<p>If you've forgotten to load dplyr or the tidyverse, <a class="glossary" target="_blank" title="The set of R functions that come with a basic installation of R, before you add external packages" href="https://psyteachr.github.io/glossary/b#base-r">base R</a> also has a <code><a href="https://generics.r-lib.org/reference/setops.html">union()</a></code> function. You usually won't get an error message, but the output won't be what you expect.</p>
<div class="sourceCode" id="cb177"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">union</a></span><span class="op">(</span><span class="va">customers</span>, <span class="va">new_customers</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1 2 3 4 5
## 
## [[2]]
## [1] "Port Ellen" "Dufftown"   NA           "Aberlour"   "Tobermory" 
## 
## [[3]]
## [1] "PA42 7DU" "AB55 4DH" NA         "AB38 7RY" "PA75 6NR"
## 
## [[4]]
## [1] 5 6 7 8 9
## 
## [[5]]
## [1] "PA75 6NR" "FK1 4RS"  "PA42 7EA" "G81 4SJ"  "KW15 1SE"
## 
## [[6]]
## [1] "Tobermory" "Falkirk"   "Ardbeg"    "Doogal"    "Kirkwall"</code></pre>
</div>
</div>
<div id="setdiff" class="section level4" number="4.3.4.3">
<h4>
<span class="header-section-number">4.3.4.3</span> setdiff()<a class="anchor" aria-label="anchor" href="#setdiff"><i class="fas fa-link"></i></a>
</h4>
<p><code>setdiff</code> returns rows that are in the first table, but not in the second table.</p>
<div class="sourceCode" id="cb179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html">setdiff</a></span><span class="op">(</span><span class="va">customers</span>, <span class="va">new_customers</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Port Ellen
</td>
<td style="text-align:left;">
PA42 7DU
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Dufftown
</td>
<td style="text-align:left;">
AB55 4DH
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
</tr>
</tbody>
</table></div>
</div>
<p>Order matters for <code>setdiff</code>.</p>
<div class="sourceCode" id="cb180"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html">setdiff</a></span><span class="op">(</span><span class="va">new_customers</span>, <span class="va">customers</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
postcode
</th>
<th style="text-align:left;">
city
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
FK1 4RS
</td>
<td style="text-align:left;">
Falkirk
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
PA42 7EA
</td>
<td style="text-align:left;">
Ardbeg
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
G81 4SJ
</td>
<td style="text-align:left;">
Doogal
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
KW15 1SE
</td>
<td style="text-align:left;">
Kirkwall
</td>
</tr>
</tbody>
</table></div>
</div>
<div class="warning">
<p>If you've forgotten to load dplyr or the tidyverse, <a class="glossary" target="_blank" title="The set of R functions that come with a basic installation of R, before you add external packages" href="https://psyteachr.github.io/glossary/b#base-r">base R</a> also has a <code><a href="https://generics.r-lib.org/reference/setops.html">setdiff()</a></code> function. You usually won't get an error message, but the output might not be what you expect because the base R <code><a href="https://generics.r-lib.org/reference/setops.html">setdiff()</a></code> expects columns to be in the same order, so id 5 here registers as different between the two tables.</p>
<div class="sourceCode" id="cb181"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="va">customers</span>, <span class="va">new_customers</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Port Ellen
</td>
<td style="text-align:left;">
PA42 7DU
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Dufftown
</td>
<td style="text-align:left;">
AB55 4DH
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
</div>
</div>
</div>
<div id="glossary-data" class="section level2" number="4.4">
<h2>
<span class="header-section-number">4.4</span> Glossary<a class="anchor" aria-label="anchor" href="#glossary-data"><i class="fas fa-link"></i></a>
</h2>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:left;">
definition
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/a.html#argument" class="glossary" target="_blank">argument</a>
</td>
<td style="text-align:left;">
A variable that provides input to a function.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/b.html#base-r" class="glossary" target="_blank">base r</a>
</td>
<td style="text-align:left;">
The set of R functions that come with a basic installation of R, before you add external packages
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/b.html#binding-joins" class="glossary" target="_blank">binding joins</a>
</td>
<td style="text-align:left;">
Joins that bind one table to another by adding their rows or columns together.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/c.html#character" class="glossary" target="_blank">character</a>
</td>
<td style="text-align:left;">
A data type representing strings of text.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/c.html#console" class="glossary" target="_blank">console</a>
</td>
<td style="text-align:left;">
The pane in RStudio where you can type in commands and view output messages.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/d.html#data-type" class="glossary" target="_blank">data type</a>
</td>
<td style="text-align:left;">
The kind of data represented by an object.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/d.html#double" class="glossary" target="_blank">double</a>
</td>
<td style="text-align:left;">
A data type representing a real decimal number
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/e.html#extension" class="glossary" target="_blank">extension</a>
</td>
<td style="text-align:left;">
The end part of a file name that tells you what type of file it is (e.g., .R or .Rmd).
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/f.html#filtering-joins" class="glossary" target="_blank">filtering joins</a>
</td>
<td style="text-align:left;">
Joins that act like the dplyr::filter() function in that they remove rows from the data in one table based on the values in another table.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/g.html#global-environment" class="glossary" target="_blank">global environment</a>
</td>
<td style="text-align:left;">
The interactive workspace where your script runs
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/i.html#integer" class="glossary" target="_blank">integer</a>
</td>
<td style="text-align:left;">
A data type representing whole numbers.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/l.html#logical" class="glossary" target="_blank">logical</a>
</td>
<td style="text-align:left;">
A data type representing TRUE or FALSE values.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/m.html#mutating-joins" class="glossary" target="_blank">mutating joins</a>
</td>
<td style="text-align:left;">
Joins that act like the dplyr::mutate() function in that they add new columns to one table based on values in another table.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/n.html#na" class="glossary" target="_blank">na</a>
</td>
<td style="text-align:left;">
A missing value that is "Not Available"
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/p.html#package" class="glossary" target="_blank">package</a>
</td>
<td style="text-align:left;">
A group of R functions.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/p.html#panes" class="glossary" target="_blank">panes</a>
</td>
<td style="text-align:left;">
RStudio is arranged with four window "panes".
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/s.html#set-operations" class="glossary" target="_blank">set operations</a>
</td>
<td style="text-align:left;">
Functions that compare two tables and return rows that match (intersect), are in either table (union), or are in one table but not the other (setdiff).
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/t.html#tabular-data" class="glossary" target="_blank">tabular data</a>
</td>
<td style="text-align:left;">
Data in a rectangular table format, where each row has an entry for each column.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/t.html#tidyverse" class="glossary" target="_blank">tidyverse</a>
</td>
<td style="text-align:left;">
A set of R packages that help you create and work with tidy data
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/v.html#vector" class="glossary" target="_blank">vector</a>
</td>
<td style="text-align:left;">
A type of data structure that collects values with the same data type, like T/F values, numbers, or strings.
</td>
</tr>
</tbody>
</table></div>
</div>
<div id="resources-data" class="section level2" number="4.5">
<h2>
<span class="header-section-number">4.5</span> Further resources<a class="anchor" aria-label="anchor" href="#resources-data"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><a href="https://github.com/rstudio/cheatsheets/raw/master/data-import.pdf">Data import cheatsheet</a></li>
<li><a href="https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf">Data transformation heatsheet</a></li>
<li>
<a href="http://r4ds.had.co.nz/data-import.html">Chapter 11: Data Import</a> in <em>R for Data Science</em>
</li>
<li>
<a href="http://r4ds.had.co.nz/relational-data.html">Chapter 13: Relational Data</a> in <em>R for Data Science</em>
</li>
</ul>
</div>
<div id="exercises-data" class="section level2" number="4.6">
<h2>
<span class="header-section-number">4.6</span> Exercises<a class="anchor" aria-label="anchor" href="#exercises-data"><i class="fas fa-link"></i></a>
</h2>

</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;

    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    $(solveme[i]).after(" <span class='webex-icon'></span>");
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    $(selects[i]).after(" <span class='webex-icon'></span>");
  }

  update_total_correct();
}

</script><script>
$( document ).ready(function() {
  var cite = ' ';
  var psyteachr = ' <a href="https://psyteachr.github.io/"><img src="images/logos/psyteachr_logo.png" style="height: 31px; color: white;" alt="psyTeachR: Reproducible Research" /></a>';
  var license = ' <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>';

  $("footer div.row div:eq(1) p").html(
    psyteachr + license + cite
  );

  function move_sidebar() {
    var w = window.innerWidth;
    if (w < 992) {
      $("#toc").appendTo($("#main-nav"));
    } else {
      $("#toc").appendTo($("div.sidebar-chapter"));
    }
  }
  move_sidebar();
  window.onresize = move_sidebar;
});
</script><div class="chapter-nav">
<div class="prev"><a href="viz.html"><span class="header-section-number">3</span> Basic Data Visualisation</a></div>
<div class="next"><a href="tidy.html"><span class="header-section-number">5</span> Data Tidying</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#data"><span class="header-section-number">4</span> Data Import and Relations</a></li>
<li><a class="nav-link" href="#ilo-data"><span class="header-section-number">4.1</span> Intended Learning Outcomes</a></li>
<li>
<a class="nav-link" href="#data-import"><span class="header-section-number">4.2</span> Data Import</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#builtin"><span class="header-section-number">4.2.1</span> Built-in data</a></li>
<li><a class="nav-link" href="#looking-at-data"><span class="header-section-number">4.2.2</span> Looking at data</a></li>
<li><a class="nav-link" href="#import_data"><span class="header-section-number">4.2.3</span> Importing data</a></li>
<li><a class="nav-link" href="#creating-data"><span class="header-section-number">4.2.4</span> Creating data</a></li>
<li><a class="nav-link" href="#writing-data"><span class="header-section-number">4.2.5</span> Writing data</a></li>
<li><a class="nav-link" href="#troubleshooting"><span class="header-section-number">4.2.6</span> Troubleshooting</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#data-relations"><span class="header-section-number">4.3</span> Data Relations</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#mutating-joins"><span class="header-section-number">4.3.1</span> Mutating Joins</a></li>
<li><a class="nav-link" href="#filtering-joins"><span class="header-section-number">4.3.2</span> Filtering Joins</a></li>
<li><a class="nav-link" href="#binding-joins"><span class="header-section-number">4.3.3</span> Binding Joins</a></li>
<li><a class="nav-link" href="#set-operations"><span class="header-section-number">4.3.4</span> Set Operations</a></li>
</ul>
</li>
<li><a class="nav-link" href="#glossary-data"><span class="header-section-number">4.4</span> Glossary</a></li>
<li><a class="nav-link" href="#resources-data"><span class="header-section-number">4.5</span> Further resources</a></li>
<li><a class="nav-link" href="#exercises-data"><span class="header-section-number">4.6</span> Exercises</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/psyteachr/ads-v1/blob/master/book/04-data.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/psyteachr/ads-v1/edit/master/book/04-data.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Applied Data Skills</strong>: Processing &amp; Presenting Data" was written by Emily Nordmann and Lisa DeBruine. It was last built on 2021-10-14.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
