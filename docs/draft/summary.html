<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 5 Data Summaries | Applied Data Skills</title>
<meta name="author" content="Emily Nordmann and Lisa DeBruine">
<meta name="description" content="5.1 Intended Learning Outcomes Be able to summarise data by groups Be able to produce well-formatted tables In this chapter we'll use the following packages: library(tidyverse)  # data wrangling...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 5 Data Summaries | Applied Data Skills">
<meta property="og:type" content="book">
<meta property="og:url" content="https://psyteachr.github.io/ads-v1/summary.html">
<meta property="og:image" content="https://psyteachr.github.io/ads-v1/images/logos/logo">
<meta property="og:description" content="5.1 Intended Learning Outcomes Be able to summarise data by groups Be able to produce well-formatted tables In this chapter we'll use the following packages: library(tidyverse)  # data wrangling...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 5 Data Summaries | Applied Data Skills">
<meta name="twitter:description" content="5.1 Intended Learning Outcomes Be able to summarise data by groups Be able to produce well-formatted tables In this chapter we'll use the following packages: library(tidyverse)  # data wrangling...">
<meta name="twitter:image" content="https://psyteachr.github.io/ads-v1/images/logos/logo">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.19/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-6NP3MF25W3"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-6NP3MF25W3');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="include/psyteachr.css">
<link rel="stylesheet" href="include/webex.css">
<link rel="stylesheet" href="include/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="Processing &amp; Presenting Data">Applied Data Skills</a>:
        <small class="text-muted">Processing &amp; Presenting Data</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Overview</a></li>
<li><a class="" href="intro.html"><span class="header-section-number">1</span> Intro to R and RStudio</a></li>
<li><a class="" href="reports.html"><span class="header-section-number">2</span> Reports with R Markdown</a></li>
<li><a class="" href="viz.html"><span class="header-section-number">3</span> Basic Data Visualisation</a></li>
<li><a class="" href="data.html"><span class="header-section-number">4</span> Data Import</a></li>
<li><a class="active" href="summary.html"><span class="header-section-number">5</span> Data Summaries</a></li>
<li><a class="" href="joins.html"><span class="header-section-number">6</span> Data Relations</a></li>
<li><a class="" href="tidy.html"><span class="header-section-number">7</span> Data Tidying</a></li>
<li><a class="" href="wrangle.html"><span class="header-section-number">8</span> Data Wrangling</a></li>
<li><a class="" href="custom.html"><span class="header-section-number">9</span> Customising Visualisations</a></li>
<li><a class="" href="present.html"><span class="header-section-number">10</span> Advanced Reports</a></li>
<li class="book-part">Appendices</li>
<li><a class="" href="installing-r.html"><span class="header-section-number">A</span> Installing R</a></li>
<li><a class="" href="appendix-updating-r.html"><span class="header-section-number">B</span> Updating R, RStudio, and packages</a></li>
<li><a class="" href="symbols.html"><span class="header-section-number">C</span> Symbols</a></li>
<li><a class="" href="conventions.html"><span class="header-section-number">D</span> Conventions</a></li>
<li><a class="" href="data-types.html"><span class="header-section-number">E</span> Data Types</a></li>
<li><a class="" href="plotstyle.html"><span class="header-section-number">F</span> Styling Plots</a></li>
<li><a class="" href="twitter-example.html"><span class="header-section-number">G</span> Twitter Example</a></li>
<li><a class="" href="webpages.html"><span class="header-section-number">H</span> Webpages</a></li>
<li><a class="" href="license.html">License</a></li>
<li><a class="" href="references-1.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/psyteachr/ads-v1">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="summary" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> Data Summaries<a class="anchor" aria-label="anchor" href="#summary"><i class="fas fa-link"></i></a>
</h1>
<div id="ilo-summary" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Intended Learning Outcomes<a class="anchor" aria-label="anchor" href="#ilo-summary"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>Be able to summarise data by groups</li>
<li>Be able to produce well-formatted tables</li>
</ul>
<p>In this chapter we'll use the following packages:</p>
<div class="sourceCode" id="cb176"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>   <span class="co"># data wrangling functions</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://CRAN.R-project.org/package=rtweet">rtweet</a></span><span class="op">)</span> <span class="co"># for searching tweets</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/">kableExtra</a></span><span class="op">)</span>  <span class="co"># for nice tables</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidyverse/glue">glue</a></span><span class="op">)</span> <span class="co"># for pasting strings</span></code></pre></div>
</div>
<div id="set-up-2" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> Set-up<a class="anchor" aria-label="anchor" href="#set-up-2"><i class="fas fa-link"></i></a>
</h2>
<p>First, create a new project for the work we'll do in this chapter named <code class="path">05-summary</code>. Second, download the data for this chapter <a href="data/ncod_tweets.rds" download>ncod_tweets.rds</a> and save it in your project data folder. Finally, open and save and new R Markdown document named <code>summary.Rmd</code>, delete the welcome text and load the required packages for this chapter.</p>
</div>
<div id="social-media-data" class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> Social media data<a class="anchor" aria-label="anchor" href="#social-media-data"><i class="fas fa-link"></i></a>
</h2>
<p>In this chapter we're going to analyse social media data, specifically data from Twitter. There are two broad types of data you can obtain from Twitter; data scraped from Twitter using purpose-built packages such as <code class="package">rtweet</code>, and data provided via <a href="https://analytics.twitter.com/">Twitter Analytics</a> for any accounts for which you have access.</p>
<p>For this chapter, we'll use data scraped from Twitter using <code class="package">rtweet</code>. In order to use these functions, you need to have a Twitter account although don't worry if you don't have one, we'll also provide the data for you.</p>
<p><code class="package">rtweet</code> has a lot of flexibility, for example, you can search for tweets that contain a certain hashtag or word, tweets by a specific user, or tweets that meet certain conditions like location or whether the user is verified.</p>
<p>For the dataset for this chapter, we used the <code><a href="https://rdrr.io/pkg/rtweet/man/search_tweets.html">search_tweets()</a></code> function to find the last 30K tweets with the hashtag <a href="https://en.wikipedia.org/wiki/National_Coming_Out_Day">#NationalComingOutDay</a>.This is mainly interesting around October 11th (the date of National Coming Out Day), so we've provided the relevant data for you that we scraped at that time.</p>
<p>If you have a Twitter account, you can complete this chapter using your own data and any hashtag that interests you. When you run the <code><a href="https://rdrr.io/pkg/rtweet/man/search_tweets.html">search_tweets()</a></code> function you will be asked to sign in to your Twitter account.</p>
<div class="sourceCode" id="cb177"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tweets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rtweet/man/search_tweets.html">search_tweets</a></span><span class="op">(</span>q <span class="op">=</span> <span class="st">"#NationalComingOutDay"</span>, 
                        n <span class="op">=</span> <span class="fl">30000</span>, 
                        include_rts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div id="r-objects" class="section level3" number="5.3.1">
<h3>
<span class="header-section-number">5.3.1</span> R objects<a class="anchor" aria-label="anchor" href="#r-objects"><i class="fas fa-link"></i></a>
</h3>
<p>If you're working with live social media data, every time you run a query it's highly likely you will get a different set of data as new tweets are added. Additionally, the Twitter API places limits on how much data you can download and searches are limited to data from the last 6-9 days. Consequently, it can be useful to save the results of your initial search. <code>saveRDS</code> is a useful function that allows you to save any object in your environment to disk</p>
<div class="sourceCode" id="cb178"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">tweets</span>, file <span class="op">=</span> <span class="st">"data/ncod_tweets.rds"</span><span class="op">)</span></code></pre></div>
<p>To load an <code>.rds</code> file, you can use the <code>readRDS</code> function. If you don't have access to a Twitter account, or to ensure that you get the same output as the rest of this chapter, you can now load in <code>ncod_tweets.rds</code> using this function.</p>
<div class="sourceCode" id="cb179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tweets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"data/ncod_tweets.rds"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="data-summaries" class="section level2" number="5.4">
<h2>
<span class="header-section-number">5.4</span> Data summaries<a class="anchor" aria-label="anchor" href="#data-summaries"><i class="fas fa-link"></i></a>
</h2>
<div id="summarise" class="section level3" number="5.4.1">
<h3>
<span class="header-section-number">5.4.1</span> Summarise<a class="anchor" aria-label="anchor" href="#summarise"><i class="fas fa-link"></i></a>
</h3>
<p>First, run <code>glimpse(tweets)</code> and click on the object in the environment to find out what information is in the downloaded data (it's a lot!). Now let's create a series of summary tables and plots with these data.</p>
<p>The <code>summarise()</code> function from the <code class="package">dplyr</code> package is loaded as part of the tidyverse and creates summary statistics. Check the <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-transformation.pdf">Data Transformation Cheat Sheet</a> for various summary functions. Some common ones are: <code>n()</code>, <code><a href="https://rdrr.io/r/base/Extremes.html">min()</a></code>, <code><a href="https://rdrr.io/r/base/Extremes.html">max()</a></code>, <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code>, <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code>, and <code><a href="https://rdrr.io/r/stats/quantile.html">quantile()</a></code>.</p>
<p>This function can be used to answer questions like: How many tweets were there? What date range is represented in these data? What are the mean and median number of favourites per tweet? Let's start with a very simple example to calculate the mean, median, min, and max number of favourites (Twitter's version of a "like"):</p>
<ul>
<li>The first argument <code>summarise()</code> takes is the data table you wish to summarise, in this case the object <code>tweets</code>.</li>
<li>
<code>summarise()</code> will create a new table. The column names of this new table will be the left hand-side arguments, i.e., <code>mean_favs</code> and <code>median_favs</code>.</li>
<li>The values of these columns are the result of the summary operation on the right hand-side.</li>
</ul>
<div class="sourceCode" id="cb180"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">favourite_summary</span> <span class="op">&lt;-</span> <span class="fu">summarise</span><span class="op">(</span><span class="va">tweets</span>,
                           mean_favs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">favorite_count</span><span class="op">)</span>,
                           median_favs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">favorite_count</span><span class="op">)</span>,
                           min_favs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">favorite_count</span><span class="op">)</span>,
                           max_favs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">favorite_count</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:center;">
mean_favs
</th>
<th style="text-align:center;">
median_favs
</th>
<th style="text-align:center;">
min_favs
</th>
<th style="text-align:center;">
max_favs
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:center;">
29.71732
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
22935
</td>
</tr></tbody>
</table></div>
<p>The mean number of favourites is substantially higher than the median and the range is huge, suggesting there are outliers. A quick histogram confirms this - most tweets have zero favourites but there are a few with a lot of likes (so few you can't really see them on the histogram) that skew the mean.</p>
<div class="sourceCode" id="cb181"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">tweets</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">favorite_count</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-summary_files/figure-html/unnamed-chunk-6-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>You can add multiple operations to a single call to <code>summarise()</code> so let's try a few different operations. The <code>n()</code> function counts the number of rows in the data. The <code>created_at</code> column gives us the date each tweet were created, so we can use the <code><a href="https://rdrr.io/r/base/Extremes.html">min()</a></code> and <code><a href="https://rdrr.io/r/base/Extremes.html">max()</a></code> functions to get the range of dates.</p>
<div class="sourceCode" id="cb182"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tweet_summary</span> <span class="op">&lt;-</span> <span class="va">tweets</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>mean_favs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">favorite_count</span><span class="op">)</span>,
            median_favs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">favorite_count</span>, <span class="fl">.5</span><span class="op">)</span>,
            n <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,
            min_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">created_at</span><span class="op">)</span>,
            max_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">created_at</span><span class="op">)</span><span class="op">)</span>

<span class="fu">glimpse</span><span class="op">(</span><span class="va">tweet_summary</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 1
## Columns: 5
## $ mean_favs   &lt;dbl&gt; 29.71732
## $ median_favs &lt;dbl&gt; 3
## $ n           &lt;int&gt; 28626
## $ min_date    &lt;dttm&gt; 2021-10-10 00:10:02
## $ max_date    &lt;dttm&gt; 2021-10-12 20:12:27</code></pre>
<div class="info">
<p><a class="glossary" target="_blank" title="Cutoffs dividing the range of a distribution into continuous intervals with equal probabilities." href="https://psyteachr.github.io/glossary/q#quantile">Quantiles</a> are like percentiles. Use <code><a href="https://rdrr.io/r/stats/quantile.html">quantile(x, .50)</a></code> to find the median (the number where 50% of values in <code>x</code> are above it and 50% are below it). This can be useful when you need a value like "90% of tweets get <em>X</em> favourites or fewer".</p>
<div class="sourceCode" id="cb184"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">tweets</span><span class="op">$</span><span class="va">favorite_count</span>, <span class="fl">0.90</span><span class="op">)</span></code></pre></div>
<pre><code>## 90% 
##  31</code></pre>
</div>
<div class="try">
<ul>
<li>How would you find the largest number of retweets?
<div id="radio_NEUZVHFIJQ" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_NEUZVHFIJQ" value="x"><span><code>tweets %&gt;% summarise(max_retweets)</code></span></label><label><input type="radio" autocomplete="off" name="radio_NEUZVHFIJQ" value="answer"><span><code>tweets %&gt;% summarise(max_retweets = max(retweets))</code></span></label><label><input type="radio" autocomplete="off" name="radio_NEUZVHFIJQ" value="x"><span><code>tweets %&gt;% summarise(max = retweets)</code></span></label><label><input type="radio" autocomplete="off" name="radio_NEUZVHFIJQ" value="x"><span><code>tweets %&gt;% max(retweets)</code></span></label>
</div>
</li>
<li>How would you calculate the mean <code>display_text_width</code>?
<div id="radio_TJBUTMFGZD" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_TJBUTMFGZD" value="x"><span><code>group_by(display_text_width)</code></span></label><label><input type="radio" autocomplete="off" name="radio_TJBUTMFGZD" value="answer"><span><code>summarise(width = mean(display_text_width))</code></span></label><label><input type="radio" autocomplete="off" name="radio_TJBUTMFGZD" value="x"><span><code>summarise(display_text_width = mean)</code></span></label><label><input type="radio" autocomplete="off" name="radio_TJBUTMFGZD" value="x"><span><code>width(mean(display_text_width))</code></span></label>
</div>
</li>
</ul>
</div>
</div>
<div id="the-operator" class="section level3" number="5.4.2">
<h3>
<span class="header-section-number">5.4.2</span> The $ operator<a class="anchor" aria-label="anchor" href="#the-operator"><i class="fas fa-link"></i></a>
</h3>
<p>We need to take a couple of brief detours to introduce some additional coding conventions. First, let's clear up what that <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code> notation is doing. The dollar sign allows you to select variables from an object. The left-hand side is the object, and the right-hand side is the variable. When you call a variable like this, R will print all the observations in that variable.</p>
<div class="sourceCode" id="cb186"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tweet_summary</span><span class="op">$</span><span class="va">mean_favs</span></code></pre></div>
<pre><code>## [1] 29.71732</code></pre>
<p>If your variable has multiple observations, you can specify which ones to return using square brackets <code>[]</code> and the row number.</p>
<div class="sourceCode" id="cb188"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tweets</span><span class="op">$</span><span class="va">source</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="co"># select one observation</span>
<span class="va">tweets</span><span class="op">$</span><span class="va">display_text_width</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">40</span><span class="op">)</span><span class="op">]</span> <span class="co"># select multiple with c()</span></code></pre></div>
<pre><code>## [1] "Twitter for Android"
## [1]  78 287 107</code></pre>
</div>
<div id="pipes" class="section level3" number="5.4.3">
<h3>
<span class="header-section-number">5.4.3</span> Pipes<a class="anchor" aria-label="anchor" href="#pipes"><i class="fas fa-link"></i></a>
</h3>
<p>For our second detour, let's formally introduce the pipe, that weird <code><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></code> symbol we've used occasionally. Pipes allow you to send the output from one function straight into another function. Specifically, they send the result of the function before <code><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></code> to be the first argument of the function after <code><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></code>. It can be useful to translate the pipe as <strong>and then</strong>. It's easier to show than tell so let's look at an example.</p>
<p>We could write the above code using a pipe as follows:</p>
<div class="sourceCode" id="cb190"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tweet_summary</span> <span class="op">&lt;-</span> <span class="va">tweets</span> <span class="op">%&gt;%</span> <span class="co"># start with the object tweets and then</span>
  <span class="fu">summarise</span><span class="op">(</span>mean_favs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">favorite_count</span><span class="op">)</span>, <span class="co">#summarise it</span>
            median_favs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">favorite_count</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Notice that <code>summarise()</code> no longer needs the first argument to be the data table, it is pulled in from the pipe. The power of the pipe may not be obvious now, but it will soon prove its worth.
### Inline coding</p>
<p>To insert those values into the text of a report you can use inline coding. First. we'll create another set of objects that contain the first and last date of the tweets in our dataset. <code><a href="https://rdrr.io/r/base/format.html">format()</a></code> formats the dates to day/month/year.</p>
<div class="sourceCode" id="cb191"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">date_from</span> <span class="op">&lt;-</span> <span class="va">tweet_summary</span><span class="op">$</span><span class="va">min_date</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="st">"%d %B, %Y"</span><span class="op">)</span>
<span class="va">date_to</span> <span class="op">&lt;-</span> <span class="va">tweet_summary</span><span class="op">$</span><span class="va">max_date</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="st">"%d %B, %Y"</span><span class="op">)</span></code></pre></div>
<p>Then you can insert values from these objects and the tables you created with <code>summarise()</code> using inline R (note the dollar sign notation). Knit your Markdown to see the output.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="summary.html#cb192-1" aria-hidden="true" tabindex="-1"></a>There were <span class="st">`</span><span class="at">r backtick("r tweet_summary$n")</span><span class="st">`</span> tweets between <span class="st">`</span><span class="at">r backtick("r date_from")</span><span class="st">`</span> and <span class="st">`</span><span class="at">r backtick("r date_to")</span><span class="st">`</span>.</span></code></pre></div>
<p>There were 28626 tweets between 10 October, 2021 and 12 October, 2021.</p>
<p>Ok, let's get back on track.</p>
</div>
<div id="counting" class="section level3" number="5.4.4">
<h3>
<span class="header-section-number">5.4.4</span> Counting<a class="anchor" aria-label="anchor" href="#counting"><i class="fas fa-link"></i></a>
</h3>
<p>How many different accounts tweeted using the hashtag? Who tweeted most?</p>
<p>You can count categorical data with the <code>count()</code> function. Since each row is a tweet, you can count the number of rows per each different <code>screen_name</code> to get the number of tweets per user. This will give you a new table with each combination of the counted columns and a column called <code>n</code> containing the number of observations from that group.</p>
<p><code>sort = TRUE</code> will sort the table by <code>n</code> in descending order whilst <code><a href="https://rdrr.io/r/utils/head.html">head()</a></code> returns the first six lines of a data table and is a useful function to call when you have a very large dataset and just want to see the top values.</p>
<div class="sourceCode" id="cb193"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tweets_per_user</span> <span class="op">&lt;-</span> <span class="va">tweets</span> <span class="op">%&gt;%</span>
  <span class="fu">count</span><span class="op">(</span><span class="va">screen_name</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">tweets_per_user</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
screen_name
</th>
<th style="text-align:right;">
n
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
interest_outfit
</td>
<td style="text-align:right;">
35
</td>
</tr>
<tr>
<td style="text-align:left;">
LeoShir2
</td>
<td style="text-align:right;">
33
</td>
</tr>
<tr>
<td style="text-align:left;">
dr_stack
</td>
<td style="text-align:right;">
32
</td>
</tr>
<tr>
<td style="text-align:left;">
NRArchway
</td>
<td style="text-align:right;">
32
</td>
</tr>
<tr>
<td style="text-align:left;">
bhavna_95
</td>
<td style="text-align:right;">
25
</td>
</tr>
<tr>
<td style="text-align:left;">
WipeHomophobia
</td>
<td style="text-align:right;">
23
</td>
</tr>
</tbody>
</table></div>
</div>
<div class="try">
<ul>
<li>How would you count the number of tweets that are quotes or not and are retweets or not?
<div id="radio_KVVBIPYPIF" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_KVVBIPYPIF" value="answer"><span><code>tweets %&gt;% count(is_quote, is_retweet)</code></span></label><label><input type="radio" autocomplete="off" name="radio_KVVBIPYPIF" value="x"><span><code>tweets %&gt;% count(is_quote) %&gt;% count(is_retweet)</code></span></label><label><input type="radio" autocomplete="off" name="radio_KVVBIPYPIF" value="x"><span><code>tweets %&gt;% count(c(is_quote, is_retweet))</code></span></label><label><input type="radio" autocomplete="off" name="radio_KVVBIPYPIF" value="x"><span><code>tweets %&gt;% select(is_quote, is_retweet) %&gt;% count()</code></span></label>
</div>
</li>
</ul>
</div>
</div>
<div id="inline-coding-2" class="section level3" number="5.4.5">
<h3>
<span class="header-section-number">5.4.5</span> Inline coding 2<a class="anchor" aria-label="anchor" href="#inline-coding-2"><i class="fas fa-link"></i></a>
</h3>
<p>Let's do another example of inline coding that writes up a summary of the most prolific tweets to demonstrate a few additional functions. First, we need to create some additional objects to use with inline R:</p>
<ul>
<li>
<code>nrow</code> simply counts the number of rows in a dataset so if you have one user/participant/customer per row, this is an easy way to do a head count.</li>
<li>
<code>slice()</code> selects a particular row of data, in this case the first row. Because we sorted our data, this will therefore be the user with the most tweets.</li>
<li>
<code>pull()</code> pulls out a single variable.</li>
<li>The combination of <code>slice()</code> and <code>pull()</code> allows you to select a single observation from a single variable.</li>
</ul>
<div class="sourceCode" id="cb194"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">unique_users</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">tweets_per_user</span><span class="op">)</span>
<span class="va">most_prolific</span> <span class="op">&lt;-</span> <span class="fu">slice</span><span class="op">(</span><span class="va">tweets_per_user</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pull</span><span class="op">(</span><span class="va">screen_name</span><span class="op">)</span>
<span class="va">most_prolific_n</span> <span class="op">&lt;-</span> <span class="fu">slice</span><span class="op">(</span><span class="va">tweets_per_user</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pull</span><span class="op">(</span><span class="va">n</span><span class="op">)</span></code></pre></div>
<p>Then add the inline code to your report and knit your Markdown to see the output:</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="summary.html#cb195-1" aria-hidden="true" tabindex="-1"></a>There were <span class="st">`</span><span class="at">r unique_users</span><span class="st">`</span> unique accounts tweeting about <span class="co">#NationalComingOutDay. `r `most_prolific` was the most prolific tweeter, with `r most_prolific_n` tweets.</span></span></code></pre></div>
<p>There were 25189 unique accounts tweeting about #NationalComingOutDay. interest_outfit was the most prolific tweeter, with 35 tweets.</p>
</div>
<div id="grouping" class="section level3" number="5.4.6">
<h3>
<span class="header-section-number">5.4.6</span> Grouping<a class="anchor" aria-label="anchor" href="#grouping"><i class="fas fa-link"></i></a>
</h3>
<p>You can also create other summary values by group. The combination of <code>group_by()</code> and <code>summarise()</code> is incredibly powerful, and it is also a good demonstration of why pipes are so useful.</p>
<p><code>group_by()</code> takes an existing data table and converts it into a grouped table where any operations that are performed on it are doing "by group".</p>
<p>The first line of code creates an object named <code>tweets_grouped</code>, that groups the dataset according to whether the user is a verified user. On the surface, <code>tweets_grouped</code> doesn't look any different to the original <code>tweets</code>, however, the underlying structure has changed and so when we run <code>summarise()</code>, we now get our requested summaries for each group (in this case verified or not).</p>
<div class="sourceCode" id="cb196"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tweets_grouped</span> <span class="op">&lt;-</span> <span class="va">tweets</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">verified</span><span class="op">)</span>

<span class="va">verified</span> <span class="op">&lt;-</span> <span class="va">tweets_grouped</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>count <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,
            mean_favs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">favorite_count</span><span class="op">)</span>,
            mean_retweets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">retweet_count</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span>

<span class="va">verified</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
verified
</th>
<th style="text-align:right;">
count
</th>
<th style="text-align:right;">
mean_favs
</th>
<th style="text-align:right;">
mean_retweets
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
26676
</td>
<td style="text-align:right;">
18.40576
</td>
<td style="text-align:right;">
1.825649
</td>
</tr>
<tr>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:right;">
1950
</td>
<td style="text-align:right;">
184.45949
</td>
<td style="text-align:right;">
21.511282
</td>
</tr>
</tbody>
</table></div>
</div>
<div class="warning">
<p>Make sure you call the <code>ungroup()</code> function when you are done with grouped functions. Failing to do this can cause all sorts of mysterious problems if you use that data table later assuming it isn't grouped.</p>
</div>
<p>Whilst the above code is functional, it adds an unnecessary object to the environment - <code>tweets_grouped</code> is taking up space and increases the risk we'll use this grouped object by mistake. Enter the pipe.</p>
<p>Rather than creating an intermediate object, we can use the pipe to string our code together.</p>
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">verified</span> <span class="op">&lt;-</span> <span class="va">tweets_grouped</span> <span class="op">%&gt;%</span> <span class="co"># Start with the original dataset and then;</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">verified</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># group it and then</span>
  <span class="fu">summarise</span><span class="op">(</span>count <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>, <span class="co"># summarise it by those groups</span>
            mean_favs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">favorite_count</span><span class="op">)</span>,
            mean_retweets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">retweet_count</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="try">
<ul>
<li>What would you change to calculate the mean favourites and retweets by <code>screen_name</code> instead of by <code>verified</code>?
<div id="radio_SDNVKNAJNA" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_SDNVKNAJNA" value="x"><span><code>count(screen_name)</code></span></label><label><input type="radio" autocomplete="off" name="radio_SDNVKNAJNA" value="x"><span><code>summarise(screen_name)</code></span></label><label><input type="radio" autocomplete="off" name="radio_SDNVKNAJNA" value="x"><span><code><a href="https://rdrr.io/r/base/mean.html">mean(screen_name)</a></code></span></label><label><input type="radio" autocomplete="off" name="radio_SDNVKNAJNA" value="answer"><span><code>group_by(screen_name)</code></span></label>
</div>
</li>
</ul>
</div>
</div>
<div id="multiple-groupings" class="section level3" number="5.4.7">
<h3>
<span class="header-section-number">5.4.7</span> Multiple groupings<a class="anchor" aria-label="anchor" href="#multiple-groupings"><i class="fas fa-link"></i></a>
</h3>
<p>You can add multiple variables to <code>group_by()</code> to further break down your data. For example, the below gives us the number of likes and retweets broken down by verified status and the device the person was tweeting from.</p>
<ul>
<li>Reverse the order of <code>verified</code> and <code>source</code> in <code>group_by()</code> to see how it changed the output.</li>
</ul>
<div class="sourceCode" id="cb198"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">verified_source</span> <span class="op">&lt;-</span> <span class="va">tweets</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">verified</span>, <span class="va">source</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>count <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,
            mean_favs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">favorite_count</span><span class="op">)</span>,
            mean_retweets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">retweet_count</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'verified'. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb200"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">verified_source</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
verified
</th>
<th style="text-align:left;">
source
</th>
<th style="text-align:right;">
count
</th>
<th style="text-align:right;">
mean_favs
</th>
<th style="text-align:right;">
mean_retweets
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
Twitter for iPhone
</td>
<td style="text-align:right;">
12943
</td>
<td style="text-align:right;">
25.40493
</td>
<td style="text-align:right;">
2.304643
</td>
</tr>
<tr>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
Twitter for Android
</td>
<td style="text-align:right;">
5807
</td>
<td style="text-align:right;">
11.90839
</td>
<td style="text-align:right;">
1.155846
</td>
</tr>
<tr>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
Twitter Web App
</td>
<td style="text-align:right;">
5795
</td>
<td style="text-align:right;">
13.54737
</td>
<td style="text-align:right;">
1.611217
</td>
</tr>
<tr>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
Twitter for iPhone
</td>
<td style="text-align:right;">
691
</td>
<td style="text-align:right;">
323.24457
</td>
<td style="text-align:right;">
29.010130
</td>
</tr>
<tr>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
Twitter Web App
</td>
<td style="text-align:right;">
560
</td>
<td style="text-align:right;">
131.44643
</td>
<td style="text-align:right;">
21.717857
</td>
</tr>
<tr>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
Twitter for iPad
</td>
<td style="text-align:right;">
374
</td>
<td style="text-align:right;">
13.85027
</td>
<td style="text-align:right;">
2.042781
</td>
</tr>
</tbody>
</table></div>
</div>
<div class="warning">
<p>If you get the following message when using <code>group_by()</code>, please update tidyverse.</p>
<blockquote>
<p><code>summarise()</code> ungrouping output (override with <code>.groups</code> argument)</p>
</blockquote>
</div>
</div>
<div id="filter-and-mutate" class="section level3" number="5.4.8">
<h3>
<span class="header-section-number">5.4.8</span> Filter and mutate<a class="anchor" aria-label="anchor" href="#filter-and-mutate"><i class="fas fa-link"></i></a>
</h3>
<p>You can also use additional functions like <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> or <code>mutate()</code> after <code>group_by</code>. You'll learn more about these in Chapter  <a href="wrangle.html#wrangle">8</a> but briefly:</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> selects observations (rows) according to specified criteria, e.g., all values above 5, all verified users.</li>
<li>
<code>mutate()</code> creates new variables (columns), or overwrites existing ones.</li>
</ul>
<p>You can combine functions like this to get detailed insights into your data. For example, what was the most favourited original and quoted tweet?</p>
<ul>
<li>The variable <code>is_quote</code> tells us whether the tweet in question was an original tweet or a quote tweet. Because we want our output to treat these separately, we pass this variable to <code>group_by()</code>.</li>
<li>We want the most favourited tweets, i.e., the maximum value of <code>favourite_count</code>, so we can use <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> to only return rows where <code>favourite_count</code> is equal to the maximum value in the variable <code>favourite_count</code>. Note the use of <code><a href="https://rdrr.io/r/base/Comparison.html">==</a></code> rather than a single <code><a href="https://rdrr.io/r/base/assignOps.html">=</a></code>.</li>
<li>Just in case there was a tie, choose a random one with <code>sample_n(size = 1)</code>.</li>
</ul>
<div class="sourceCode" id="cb201"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">most_fav</span> <span class="op">&lt;-</span> <span class="va">tweets</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">is_quote</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">favorite_count</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">favorite_count</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">sample_n</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="inline-coding-3" class="section level3" number="5.4.9">
<h3>
<span class="header-section-number">5.4.9</span> Inline coding 3<a class="anchor" aria-label="anchor" href="#inline-coding-3"><i class="fas fa-link"></i></a>
</h3>
<p>There's a huge amount of data reported for each tweet, including things like the URLs of the tweets and any media attached to them. This means we can produce output like the below reproducibly and using inline coding.</p>
<blockquote>
<p>The most favourited 22935 original tweet was by <a href="%60r%20%60orig%24status_url%60">jackrooke</a>:</p>
</blockquote>
<div class="inline-table"><table style="width:71%;" class="table table-sm">
<colgroup><col width="70%"></colgroup>
<tbody>
<tr class="odd">
<td>&gt; it’s #nationalcomingoutday 🎉 here’s a pic of how I came out back in 2003 xx <a href="https://t.co/spBmHhF6p4" class="uri">https://t.co/spBmHhF6p4</a>
</td>
</tr>
<tr class="even">
<td><img src="orig%24ext_media_url"></td>
</tr>
</tbody>
</table></div>
<p>To produce this, first we split <code>most_fav</code>, so that we have one object that contains the data from the original tweet and one object that contains the data from the quote tweet.</p>
<p>The inline code is then as follows:</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="summary.html#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> The most favourited <span class="st">`</span><span class="at">r orig$favorite_count</span><span class="st">`</span> original tweet was by [<span class="st">`</span><span class="at">r orig$screen_name</span><span class="st">`</span>](<span class="st">`</span><span class="at">r </span><span class="st">`</span>orig<span class="sc">$</span>status_url<span class="st">`</span><span class="at">):</span></span>
<span id="cb202-2"><a href="summary.html#cb202-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-3"><a href="summary.html#cb202-3" aria-hidden="true" tabindex="-1"></a><span class="at">--------------------------------------------------</span></span>
<span id="cb202-4"><a href="summary.html#cb202-4" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; </span><span class="st">`</span>r orig<span class="sc">$</span>text<span class="st">`</span></span>
<span id="cb202-5"><a href="summary.html#cb202-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-6"><a href="summary.html#cb202-6" aria-hidden="true" tabindex="-1"></a><span class="at">![](orig$ext_media_url)</span></span>
<span id="cb202-7"><a href="summary.html#cb202-7" aria-hidden="true" tabindex="-1"></a><span class="at">--------------------------------------------------</span></span></code></pre></div>
<p>This is quite complicated so let's break it down.</p>
<ul>
<li>The <code><a href="https://rdrr.io/r/base/Comparison.html">&gt;</a></code> symbol changes the format to a block quote.</li>
<li>The first bit of inline coding is fairly standard and is what you have used before.</li>
<li>The second bit of inline coding inserts a URL. The content of the <code>[]</code> is the text that will be displayed. The content of <code>()</code> is the underlying URL. In both cases the content is being pulled from the dataset. In this case, the text is <code>screen_name</code> and <code>status_url</code> links to the tweet.</li>
<li>The line of dashes creates the solid line in the knitted output.</li>
<li>The image is then included using the format <code>![]()</code> which is alternative method of including images in Markdown.</li>
</ul>
<div class="try">
<ul>
<li>How would you limit the results to sources with 10 or more rows?
<div id="radio_EJXJRYGMPL" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_EJXJRYGMPL" value="x"><span><code>tweets %&gt;% group_by(source) %&gt;% filter(count() &gt;= 10)</code></span></label><label><input type="radio" autocomplete="off" name="radio_EJXJRYGMPL" value="x"><span><code>tweets %&gt;% group_by(source) %&gt;% select(n() &gt;= 10)</code></span></label><label><input type="radio" autocomplete="off" name="radio_EJXJRYGMPL" value="x"><span><code>tweets %&gt;% group_by(source) %&gt;% select(count() &gt;= 10)</code></span></label><label><input type="radio" autocomplete="off" name="radio_EJXJRYGMPL" value="answer"><span><code>tweets %&gt;% group_by(source) %&gt;% filter(n() &gt;= 10)</code></span></label>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="together-summary" class="section level2" number="5.5">
<h2>
<span class="header-section-number">5.5</span> Putting it together<a class="anchor" aria-label="anchor" href="#together-summary"><i class="fas fa-link"></i></a>
</h2>
<p>For the final step in this chapter, we will create a table of the top five hashtags used in conjunction with #NationalComingOutDay, the total number of tweets in each hashtag, the total number of likes, and the top tweet for each hashtag.</p>
<p>The function <code>select()</code> is useful for just keeping the variables (columns) you need to work with, which can make working with very large datasets easier. The arguments to <code>select()</code> are simply the names of the variables and the resulting table will present them in the order you specify.</p>
<div class="sourceCode" id="cb203"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tweets_with_hashtags</span> <span class="op">&lt;-</span> <span class="va">tweets</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">hashtags</span>, <span class="va">text</span>, <span class="va">favorite_count</span>, <span class="va">media_url</span><span class="op">)</span></code></pre></div>
<p>Look at the dataset using <code><a href="https://rdrr.io/r/utils/View.html">View(tweets_with_hashtags)</a></code>. You'll notice that the variable <code>hashtags</code> has multiple values in each cell (i.e., when users used more than one hashtag in a single tweet). In order to work with this information, we need to separate each hashtag so that each row of data represents a single hashtag. We can do this using the function <code>unnest()</code> and adding a pipeline of code.</p>
<div class="sourceCode" id="cb204"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tweets_with_hashtags</span> <span class="op">&lt;-</span> <span class="va">tweets</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">hashtags</span>, <span class="va">text</span>, <span class="va">favorite_count</span>, <span class="va">media_url</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu">unnest</span><span class="op">(</span>cols <span class="op">=</span> <span class="va">hashtags</span><span class="op">)</span></code></pre></div>
<p>To get the top 5 hashtags we need to know how tweets used each one This code uses pipes to build up the analysis. When you encounter multi-pipe code, it can be very useful to run each line of the pipeline to see how it builds up and to check the output at each step. This code:</p>
<ul>
<li>Starts with the object tweets and then;</li>
<li>Counts the number of tweets for each hashtag using <code>count()</code> and then;</li>
<li>Filters out any blank cells using <code>!is.na()</code> (you can read this as "keep any value that isn't a missing value) and then;</li>
<li>Returns the top five values using <code>slice_max()</code> and orders them by the <code>n</code> column.</li>
</ul>
<div class="sourceCode" id="cb205"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">top5_hashtags</span> <span class="op">&lt;-</span> <span class="va">tweets_with_hashtags</span> <span class="op">%&gt;%</span>
  <span class="fu">count</span><span class="op">(</span><span class="va">hashtags</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">hashtags</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># get rid of the blank value</span>
  <span class="fu">slice_max</span><span class="op">(</span>order_by <span class="op">=</span> <span class="va">n</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>

<span class="va">top5_hashtags</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
hashtags
</th>
<th style="text-align:right;">
n
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
NationalComingOutDay
</td>
<td style="text-align:right;">
27308
</td>
</tr>
<tr>
<td style="text-align:left;">
nationalcomingoutday
</td>
<td style="text-align:right;">
1343
</td>
</tr>
<tr>
<td style="text-align:left;">
LGBTQ
</td>
<td style="text-align:right;">
829
</td>
</tr>
<tr>
<td style="text-align:left;">
IndigenousPeoplesDay
</td>
<td style="text-align:right;">
811
</td>
</tr>
<tr>
<td style="text-align:left;">
ComingOutDay
</td>
<td style="text-align:right;">
613
</td>
</tr>
</tbody>
</table></div>
</div>
<p>Two of the hashtags are the same, but with different case. We can fix this by adding in an extra line of code that uses <code>mutate()</code> to overwrite the variable <code>hashtag</code> with the same data but transformed to lower case.</p>
<div class="sourceCode" id="cb206"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">top5_hashtags</span> <span class="op">&lt;-</span> <span class="va">tweets_with_hashtags</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>hashtags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">hashtags</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">count</span><span class="op">(</span><span class="va">hashtags</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">hashtags</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># get rid of the blank value</span>
  <span class="fu">slice_max</span><span class="op">(</span>order_by <span class="op">=</span> <span class="va">n</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>

<span class="va">top5_hashtags</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
hashtags
</th>
<th style="text-align:right;">
n
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
nationalcomingoutday
</td>
<td style="text-align:right;">
28698
</td>
</tr>
<tr>
<td style="text-align:left;">
lgbtq
</td>
<td style="text-align:right;">
1036
</td>
</tr>
<tr>
<td style="text-align:left;">
indigenouspeoplesday
</td>
<td style="text-align:right;">
837
</td>
</tr>
<tr>
<td style="text-align:left;">
comingoutday
</td>
<td style="text-align:right;">
676
</td>
</tr>
<tr>
<td style="text-align:left;">
loveislove
</td>
<td style="text-align:right;">
396
</td>
</tr>
</tbody>
</table></div>
</div>
<p>Next, get the top tweet for each hashtag using <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code>. Use <code>group_by()</code> before you filter to select the most-liked tweet in each hashtag, rather than the one with most likes overall. As you're getting used to writing and running this kind of multi-step code, it can be very useful to take out individual lines and see how it changes the output to strengthen your understanding of what each step is doing.</p>
<div class="sourceCode" id="cb207"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">top_tweet_per_hashtag</span> <span class="op">&lt;-</span> <span class="va">tweets_with_hashtags</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>hashtags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">hashtags</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">hashtags</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">favorite_count</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">favorite_count</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">sample_n</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Get the total number of likes per hashtag by grouping and summarising with <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code>.</p>
<div class="sourceCode" id="cb208"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">likes_per_hashtag</span> <span class="op">&lt;-</span> <span class="va">tweets_with_hashtags</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>hashtags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">hashtags</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">hashtags</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>total_likes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">favorite_count</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>We can put everything together using <code>left_join()</code>. This will keep everything from the first table specified and then add on the relevant data from the second table specified. In this case, we add on the data in <code>top_tweet_per_hashtag</code> and <code>like_per_hashtag</code> but only for the tweets included in <code>top5_hashtags</code></p>
<div class="sourceCode" id="cb209"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">top5</span> <span class="op">&lt;-</span> <span class="va">top5_hashtags</span> <span class="op">%&gt;%</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">top_tweet_per_hashtag</span>, by <span class="op">=</span> <span class="st">"hashtags"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">likes_per_hashtag</span>, by <span class="op">=</span> <span class="st">"hashtags"</span><span class="op">)</span> </code></pre></div>
<p>Before we can finish up though, there's a couple of extra steps we need to add in to account for some of the idiosyncrasies of Twitter data.</p>
<p>First, the <code><a href="https://rdrr.io/r/base/slotOp.html">@</a></code> symbol is used by R Markdown for referencing (we'll show you how to do this in Chapter  <a href="present.html#present">10</a>). It's likely that some of the tweets will contain this symbol, so we can use mutate to find any instances of <code><a href="https://rdrr.io/r/base/slotOp.html">@</a></code> and add backslashes. Backslashes create a literal version of characters that have a special meaning in R, so adding them means it will print the <code><a href="https://rdrr.io/r/base/slotOp.html">@</a></code> symbol without any issues. Of course <code>\</code> also has a special meaning in R which means we also need to backslash the backslash. Isn't programming fun? We can use the same code to tidy up any ampersands (&amp;) which sometimes display as "&amp;amp".</p>
<p>Second, if there are multiple images associated with a single tweet, <code>media_url</code> will be a list, so we use <code><a href="https://rdrr.io/r/base/unlist.html">unlist()</a></code>.</p>
<p>Finally, we use <code>select()</code> to tidy up the table and just keep the columns we need.</p>
<div class="sourceCode" id="cb210"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">top5</span> <span class="op">&lt;-</span> <span class="va">top5_hashtags</span> <span class="op">%&gt;%</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">top_tweet_per_hashtag</span>, by <span class="op">=</span> <span class="st">"hashtags"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">likes_per_hashtag</span>, by <span class="op">=</span> <span class="st">"hashtags"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># replace @ with \@ so @ doesn't trigger referencing</span>
  <span class="fu">mutate</span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"@"</span>, <span class="st">"\\\\@"</span>, <span class="va">text</span><span class="op">)</span>,
         text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"&amp;amp;"</span>, <span class="st">"&amp;"</span>, <span class="va">text</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># media_url can be a list if there is more than one image</span>
  <span class="fu">mutate</span><span class="op">(</span>image <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">media_url</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># put the columns you want to display in order</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">hashtags</span>, <span class="va">n</span>, <span class="va">total_likes</span>, <span class="va">text</span>, <span class="va">image</span><span class="op">)</span>

<span class="va">top5</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
hashtags
</th>
<th style="text-align:right;">
n
</th>
<th style="text-align:right;">
total_likes
</th>
<th style="text-align:left;">
text
</th>
<th style="text-align:left;">
image
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
nationalcomingoutday
</td>
<td style="text-align:right;">
28698
</td>
<td style="text-align:right;">
851510
</td>
<td style="text-align:left;">
it’s #nationalcomingoutday &lt;U+0001F389&gt; here’s a pic of how I came out back in 2003 xx <a href="https://t.co/spBmHhF6p4" class="uri">https://t.co/spBmHhF6p4</a>
</td>
<td style="text-align:left;">
<a href="http://pbs.twimg.com/media/FBayvGYXsAY-5hZ.jpg" class="uri">http://pbs.twimg.com/media/FBayvGYXsAY-5hZ.jpg</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
lgbtq
</td>
<td style="text-align:right;">
1036
</td>
<td style="text-align:right;">
13691
</td>
<td style="text-align:left;">
It takes bravery to life an authentic life. While I was not able to come out as a member of the #LGBTQ community on my own terms, if you’re ready &amp; can safely do so, then I support you! And if you’re not quite there yet, I support you exactly where you are. #NationalComingOutDay <a href="https://t.co/dr61oyhR3L" class="uri">https://t.co/dr61oyhR3L</a>
</td>
<td style="text-align:left;">
<a href="http://pbs.twimg.com/media/FBcJiNUXIA4LTmr.jpg" class="uri">http://pbs.twimg.com/media/FBcJiNUXIA4LTmr.jpg</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
indigenouspeoplesday
</td>
<td style="text-align:right;">
837
</td>
<td style="text-align:right;">
14073
</td>
<td style="text-align:left;">
To all my Two Spirit brothers and sisters — I see you — I celebrate you. #NationalComingOutDay #IndigenousPeoplesDay <a href="https://t.co/KsZ5F3gBKO" class="uri">https://t.co/KsZ5F3gBKO</a>
</td>
<td style="text-align:left;">
<a href="http://pbs.twimg.com/media/FBdQIf7UYAQjEAW.jpg" class="uri">http://pbs.twimg.com/media/FBdQIf7UYAQjEAW.jpg</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
comingoutday
</td>
<td style="text-align:right;">
676
</td>
<td style="text-align:right;">
6977
</td>
<td style="text-align:left;">
<p>K—I’m out. Bi &lt;U+0001F44B&gt;&lt;U+0001F3FC&gt;</p>
#ComingOutDay #NationalComingOutDay
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
loveislove
</td>
<td style="text-align:right;">
396
</td>
<td style="text-align:right;">
4033
</td>
<td style="text-align:left;">
<p>HAPPY NATIONAL COMING OUT DAY!!</p>
<p>&lt;U+0001F3F3&gt;&lt;U+FE0F&gt;&lt;U+200D&gt;&lt;U+0001F308&gt;&lt;U+2764&gt;&lt;U+FE0F&gt;&lt;U+0001F9E1&gt;&lt;U+0001F49B&gt;&lt;U+0001F49A&gt;&lt;U+0001F499&gt;&lt;U+0001F49C&gt;&lt;U+0001F3F3&gt;&lt;U+FE0F&gt;&lt;U+200D&gt;&lt;U+0001F308&gt;</p>
@msmadig #OutAndProud #Queer #loveislove #NationalComingOutDay <a href="https://t.co/DVfKJsCqNQ" class="uri">https://t.co/DVfKJsCqNQ</a>
</td>
<td style="text-align:left;">
<a href="http://pbs.twimg.com/ext_tw_video_thumb/1447698152463626242/pu/img/pZor72nSNDPn8KiP.jpg" class="uri">http://pbs.twimg.com/ext_tw_video_thumb/1447698152463626242/pu/img/pZor72nSNDPn8KiP.jpg</a>
</td>
</tr>
</tbody>
</table></div>
</div>
<p>Whilst this table now has all the information we want, it isn't great aesthetically. The <code class="package">kableExtra</code> package has functions that will improve the presentation of tables. We're going to show you two examples of how you could format this table.</p>
<p>The first is (relatively) simple and stays within the R programming language using functionality from <code class="package">kableExtra</code>. The main aesthetic feature of the table is the incorporation of the pride flag colours for each row. Each row is set to a different colour of the pride flag and the text is set to be black and bold to improve the contrast. We've also removed the <code>image</code> column as it just contains a URL.</p>
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># the hex codes of the pride flag colours, obtained from https://www.schemecolor.com/lgbt-flag-colors.php</span>

<span class="va">pride_colours</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#FF0018"</span>, <span class="st">"#FFA52C"</span>, <span class="st">"#FFFF41"</span>, <span class="st">"#008018"</span>, <span class="st">"#0000F9"</span>, <span class="st">"#86007D"</span><span class="op">)</span>

<span class="va">top5</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">image</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Hashtags"</span>, <span class="st">"No. tweets"</span>, <span class="st">"Likes"</span>, <span class="st">"Tweet"</span><span class="op">)</span>,
        caption <span class="op">=</span> <span class="st">"Stats and the top tweet for the top five hashtags."</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/row_spec.html">row_spec</a></span><span class="op">(</span>row <span class="op">=</span> <span class="fl">0</span>, 
           background <span class="op">=</span> <span class="va">pride_colours</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"black"</span>, 
           bold <span class="op">=</span> <span class="cn">T</span>, font_size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/row_spec.html">row_spec</a></span><span class="op">(</span>row <span class="op">=</span> <span class="fl">1</span>, background <span class="op">=</span> <span class="va">pride_colours</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"black"</span>, 
           bold <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/row_spec.html">row_spec</a></span><span class="op">(</span>row <span class="op">=</span> <span class="fl">2</span>, background <span class="op">=</span> <span class="va">pride_colours</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"black"</span>, 
           bold <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/row_spec.html">row_spec</a></span><span class="op">(</span>row <span class="op">=</span> <span class="fl">3</span>, background <span class="op">=</span> <span class="va">pride_colours</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"black"</span>, 
           bold <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/row_spec.html">row_spec</a></span><span class="op">(</span>row <span class="op">=</span> <span class="fl">4</span>, background <span class="op">=</span> <span class="va">pride_colours</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"black"</span>, 
           bold <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/row_spec.html">row_spec</a></span><span class="op">(</span>row <span class="op">=</span> <span class="fl">5</span>, background <span class="op">=</span> <span class="va">pride_colours</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"black"</span>, 
           bold <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:unnamed-chunk-36">Table 5.1: </span>Stats and the top tweet for the top five hashtags.
</caption>
<thead><tr>
<th style="text-align:left;font-weight: bold;color: black !important;background-color: #FF0018 !important;font-size: 18px;">
Hashtags
</th>
<th style="text-align:right;font-weight: bold;color: black !important;background-color: #FF0018 !important;font-size: 18px;">
No. tweets
</th>
<th style="text-align:right;font-weight: bold;color: black !important;background-color: #FF0018 !important;font-size: 18px;">
Likes
</th>
<th style="text-align:left;font-weight: bold;color: black !important;background-color: #FF0018 !important;font-size: 18px;">
Tweet
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;color: black !important;background-color: #FFA52C !important;">
nationalcomingoutday
</td>
<td style="text-align:right;font-weight: bold;color: black !important;background-color: #FFA52C !important;">
28698
</td>
<td style="text-align:right;font-weight: bold;color: black !important;background-color: #FFA52C !important;">
851510
</td>
<td style="text-align:left;font-weight: bold;color: black !important;background-color: #FFA52C !important;">
it’s #nationalcomingoutday &lt;U+0001F389&gt; here’s a pic of how I came out back in 2003 xx <a href="https://t.co/spBmHhF6p4" class="uri">https://t.co/spBmHhF6p4</a>
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: black !important;background-color: #FFFF41 !important;">
lgbtq
</td>
<td style="text-align:right;font-weight: bold;color: black !important;background-color: #FFFF41 !important;">
1036
</td>
<td style="text-align:right;font-weight: bold;color: black !important;background-color: #FFFF41 !important;">
13691
</td>
<td style="text-align:left;font-weight: bold;color: black !important;background-color: #FFFF41 !important;">
It takes bravery to life an authentic life. While I was not able to come out as a member of the #LGBTQ community on my own terms, if you’re ready &amp; can safely do so, then I support you! And if you’re not quite there yet, I support you exactly where you are. #NationalComingOutDay <a href="https://t.co/dr61oyhR3L" class="uri">https://t.co/dr61oyhR3L</a>
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: black !important;background-color: #008018 !important;">
indigenouspeoplesday
</td>
<td style="text-align:right;font-weight: bold;color: black !important;background-color: #008018 !important;">
837
</td>
<td style="text-align:right;font-weight: bold;color: black !important;background-color: #008018 !important;">
14073
</td>
<td style="text-align:left;font-weight: bold;color: black !important;background-color: #008018 !important;">
To all my Two Spirit brothers and sisters — I see you — I celebrate you. #NationalComingOutDay #IndigenousPeoplesDay <a href="https://t.co/KsZ5F3gBKO" class="uri">https://t.co/KsZ5F3gBKO</a>
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: black !important;background-color: #0000F9 !important;">
comingoutday
</td>
<td style="text-align:right;font-weight: bold;color: black !important;background-color: #0000F9 !important;">
676
</td>
<td style="text-align:right;font-weight: bold;color: black !important;background-color: #0000F9 !important;">
6977
</td>
<td style="text-align:left;font-weight: bold;color: black !important;background-color: #0000F9 !important;">
<p>K—I’m out. Bi &lt;U+0001F44B&gt;&lt;U+0001F3FC&gt;</p>
#ComingOutDay #NationalComingOutDay
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: black !important;background-color: #86007D !important;">
loveislove
</td>
<td style="text-align:right;font-weight: bold;color: black !important;background-color: #86007D !important;">
396
</td>
<td style="text-align:right;font-weight: bold;color: black !important;background-color: #86007D !important;">
4033
</td>
<td style="text-align:left;font-weight: bold;color: black !important;background-color: #86007D !important;">
<p>HAPPY NATIONAL COMING OUT DAY!!</p>
<p>&lt;U+0001F3F3&gt;&lt;U+FE0F&gt;&lt;U+200D&gt;&lt;U+0001F308&gt;&lt;U+2764&gt;&lt;U+FE0F&gt;&lt;U+0001F9E1&gt;&lt;U+0001F49B&gt;&lt;U+0001F49A&gt;&lt;U+0001F499&gt;&lt;U+0001F49C&gt;&lt;U+0001F3F3&gt;&lt;U+FE0F&gt;&lt;U+200D&gt;&lt;U+0001F308&gt;</p>
@msmadig #OutAndProud #Queer #loveislove #NationalComingOutDay <a href="https://t.co/DVfKJsCqNQ" class="uri">https://t.co/DVfKJsCqNQ</a>
</td>
</tr>
</tbody>
</table></div>
<p>An alternative approach incorporates <a class="glossary" target="_blank" title="Hyper-Text Markup Language: A system for semantically tagging structure and information on web pages." href="https://psyteachr.github.io/glossary/h#html">HTML</a> and also uses the package <code class="package">glue</code> to combine information from multiple columns.</p>
<p>First, we use <code>mutate()</code> to create a new column <code>col1</code> that combines the first three columns into a single column and adds some formatting to make the hashtag bold (<code>&lt;strong&gt;</code>) and insert line breaks (<code>&lt;br&gt;</code>). We'll also change the image column to display the image using html if there is an image.</p>
<p>If you're not familiar with HTML, don't worry too if you don't understand the below code, the point is to show you the full extent of the flexibility available.</p>
<div class="sourceCode" id="cb212"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">top5</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>col1 <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"&lt;strong&gt;#{hashtags}&lt;/strong&gt;
                     &lt;br&gt;
                     tweets: {n}
                     &lt;br&gt;
                     likes: {total_likes}"</span><span class="op">)</span>,
         img <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">image</span><span class="op">)</span>,
                      <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"&lt;img src='{image}' width='200px' /&gt;"</span><span class="op">)</span>,
                      <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">col1</span>, <span class="va">text</span>, <span class="va">img</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>
    escape <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># allows HTML in the table</span>
    col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Hashtag"</span>, <span class="st">"Top Tweet"</span>, <span class="st">""</span><span class="op">)</span>,
    caption <span class="op">=</span> <span class="st">"Stats and the top tweet for the top five hashtags."</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/column_spec.html">column_spec</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, extra_css <span class="op">=</span> <span class="st">"vertical-align: top;"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/row_spec.html">row_spec</a></span><span class="op">(</span><span class="fl">0</span>, extra_css <span class="op">=</span> <span class="st">"vertical-align: bottom;"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_classic.html">kable_paper</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="exercises-2" class="section level2" number="5.6">
<h2>
<span class="header-section-number">5.6</span> Exercises<a class="anchor" aria-label="anchor" href="#exercises-2"><i class="fas fa-link"></i></a>
</h2>
<p>That was an intensive chapter! Take a break and then try one (or more) of the following and post your knitted HTML files on Teams so that other learners on the course can see what you did.</p>
<ul>
<li>If you have your own Twitter account, conduct a similar analysis of a different hashtag.</li>
<li>Look through the rest of the variables in <code>tweets</code>, what other insights can you generate about this data?</li>
<li>Read through the <a href="https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html">kableExtra</a> vignettes and apply your own preferred table style.</li>
<li>Work through the first few chapters of <a href="https://www.tidytextmining.com/index.html">Tidy Text</a> to see how you can work with and analyse text. In particular, see if you can conduct a sentiment analysis on the tweet data.</li>
</ul>
</div>
<div id="glossary-summary" class="section level2" number="5.7">
<h2>
<span class="header-section-number">5.7</span> Glossary<a class="anchor" aria-label="anchor" href="#glossary-summary"><i class="fas fa-link"></i></a>
</h2>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:left;">
definition
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/h.html#html" class="glossary" target="_blank">html</a>
</td>
<td style="text-align:left;">
Hyper-Text Markup Language: A system for semantically tagging structure and information on web pages.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/q.html#quantile" class="glossary" target="_blank">quantile</a>
</td>
<td style="text-align:left;">
Cutoffs dividing the range of a distribution into continuous intervals with equal probabilities.
</td>
</tr>
</tbody>
</table></div>
</div>
<div id="resources-summary" class="section level2" number="5.8">
<h2>
<span class="header-section-number">5.8</span> Further resources<a class="anchor" aria-label="anchor" href="#resources-summary"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-transformation.pdf">Data transformation cheat sheet</a></li>
<li>
<a href="http://r4ds.had.co.nz/transform.html">Chapter 5: Data Transformation</a> in <em>R for Data Science</em>
</li>
<li><a href="https://docs.ropensci.org/rtweet/articles/rtweet.html">Intro to rtweet</a></li>
<li><a href="https://www.tidytextmining.com/index.html">Tidy Text</a></li>
<li><a href="https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html">kableExtra vignettes</a></li>
</ul>
</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;

    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    $(solveme[i]).after(" <span class='webex-icon'></span>");
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    $(selects[i]).after(" <span class='webex-icon'></span>");
  }

  update_total_correct();
}

</script><script>
$( document ).ready(function() {
  var cite = ' ';
  var psyteachr = ' <a href="https://psyteachr.github.io/"><img src="images/logos/psyteachr_logo.png" style="height: 31px; color: white;" alt="psyTeachR: Reproducible Research" /></a>';
  var license = ' <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>';

  $("footer div.row div:eq(1) p").html(
    psyteachr + license + cite
  );

  function move_sidebar() {
    var w = window.innerWidth;
    if (w < 992) {
      $("#toc").appendTo($("#main-nav"));
    } else {
      $("#toc").appendTo($("div.sidebar-chapter"));
    }
  }
  move_sidebar();
  window.onresize = move_sidebar;
});
</script><div class="chapter-nav">
<div class="prev"><a href="data.html"><span class="header-section-number">4</span> Data Import</a></div>
<div class="next"><a href="joins.html"><span class="header-section-number">6</span> Data Relations</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#summary"><span class="header-section-number">5</span> Data Summaries</a></li>
<li><a class="nav-link" href="#ilo-summary"><span class="header-section-number">5.1</span> Intended Learning Outcomes</a></li>
<li><a class="nav-link" href="#set-up-2"><span class="header-section-number">5.2</span> Set-up</a></li>
<li>
<a class="nav-link" href="#social-media-data"><span class="header-section-number">5.3</span> Social media data</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#r-objects"><span class="header-section-number">5.3.1</span> R objects</a></li></ul>
</li>
<li>
<a class="nav-link" href="#data-summaries"><span class="header-section-number">5.4</span> Data summaries</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#summarise"><span class="header-section-number">5.4.1</span> Summarise</a></li>
<li><a class="nav-link" href="#the-operator"><span class="header-section-number">5.4.2</span> The $ operator</a></li>
<li><a class="nav-link" href="#pipes"><span class="header-section-number">5.4.3</span> Pipes</a></li>
<li><a class="nav-link" href="#counting"><span class="header-section-number">5.4.4</span> Counting</a></li>
<li><a class="nav-link" href="#inline-coding-2"><span class="header-section-number">5.4.5</span> Inline coding 2</a></li>
<li><a class="nav-link" href="#grouping"><span class="header-section-number">5.4.6</span> Grouping</a></li>
<li><a class="nav-link" href="#multiple-groupings"><span class="header-section-number">5.4.7</span> Multiple groupings</a></li>
<li><a class="nav-link" href="#filter-and-mutate"><span class="header-section-number">5.4.8</span> Filter and mutate</a></li>
<li><a class="nav-link" href="#inline-coding-3"><span class="header-section-number">5.4.9</span> Inline coding 3</a></li>
</ul>
</li>
<li><a class="nav-link" href="#together-summary"><span class="header-section-number">5.5</span> Putting it together</a></li>
<li><a class="nav-link" href="#exercises-2"><span class="header-section-number">5.6</span> Exercises</a></li>
<li><a class="nav-link" href="#glossary-summary"><span class="header-section-number">5.7</span> Glossary</a></li>
<li><a class="nav-link" href="#resources-summary"><span class="header-section-number">5.8</span> Further resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/psyteachr/ads-v1/blob/master/book/05-summary.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/psyteachr/ads-v1/edit/master/book/05-summary.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Applied Data Skills</strong>: Processing &amp; Presenting Data" was written by Emily Nordmann and Lisa DeBruine. It was last built on 2022-01-15.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
