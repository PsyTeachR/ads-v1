<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Chapter 7 Data Tidying | Applied Data Skills</title>

    <meta name="author" content="Emily Nordmann and Lisa DeBruine" />
  
   <meta name="description" content="This book provides an overview of the basic skills needed to turn raw data into informative summaries and visualisations presented in professional reports and presentations. The book will introduce learners to R, a programming language that can help automate working with data. The book will cover importing and processing data from spreadsheets, producing data summaries of descriptive statistics in tables, creating beautiful and informative visualisations, and constructing reports and presentations that automatically update when the underlying data changes." />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="Chapter 7 Data Tidying | Applied Data Skills" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://psyteachr.github.io/ads-v1" />
  <meta property="og:image" content="https://psyteachr.github.io/ads-v1/images/logos/logo" />
  <meta property="og:description" content="This book provides an overview of the basic skills needed to turn raw data into informative summaries and visualisations presented in professional reports and presentations. The book will introduce learners to R, a programming language that can help automate working with data. The book will cover importing and processing data from spreadsheets, producing data summaries of descriptive statistics in tables, creating beautiful and informative visualisations, and constructing reports and presentations that automatically update when the underlying data changes." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Data Tidying | Applied Data Skills" />
  
  <meta name="twitter:description" content="This book provides an overview of the basic skills needed to turn raw data into informative summaries and visualisations presented in professional reports and presentations. The book will introduce learners to R, a programming language that can help automate working with data. The book will cover importing and processing data from spreadsheets, producing data summaries of descriptive statistics in tables, creating beautiful and informative visualisations, and constructing reports and presentations that automatically update when the underlying data changes." />
  <meta name="twitter:image" content="https://psyteachr.github.io/ads-v1/images/logos/logo" />
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/header-attrs-2.11/header-attrs.js"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.3.1.9000/transition.js"></script>
    <script src="libs/bs3compat-0.3.1.9000/tabs.js"></script>
    <script src="libs/bs3compat-0.3.1.9000/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
    <script src="libs/plotly-binding-4.10.0/plotly.js"></script>
    <script src="libs/typedarray-0.1/typedarray.min.js"></script>
    <link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.20/datatables.js"></script>
    <link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6NP3MF25W3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-6NP3MF25W3');
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
    <link rel="stylesheet" href="include/psyteachr.css" />
    <link rel="stylesheet" href="include/webex.css" />
    <link rel="stylesheet" href="include/style.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="Processing &amp; Presenting Data">Applied Data Skills</a>:
        <small class="text-muted">Processing &amp; Presenting Data</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="tidy" class="section level1" number="7">
<h1><span class="header-section-number">Chapter 7</span> Data Tidying</h1>
<div class="incomplete-chapter">

</div>
<div id="ilo-tidy" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Intended Learning Outcomes</h2>
<ul>
<li>Be able to reshape data between long and wide formats</li>
<li>Separate, change, reorder, and rename columns</li>
<li>Use pipes to chain together functions</li>
</ul>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="tidy.html#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># for data wrangling</span></span></code></pre></div>
</div>
<div id="data-structure" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Data Structure</h2>
<p>An <a class='glossary' target='_blank' title='All of the data about a single trial or question.' href='https://psyteachr.github.io/glossary/o#observation'>observation</a> is all the information about a single "thing" at a single point in time. These things can be customers, sales, orders, feedback questionnaires, tweets, or really anything. Observations should have a way to identify them, such as a unique ID or combination of variable values.</p>
<p>A <a class='glossary' target='_blank' title='A word that identifies and stores the value of some data for later use.' href='https://psyteachr.github.io/glossary/v#variable'>variable</a> is one type of information about the observation. For example, if the observation is a sale, the variables you might have about the sale are the sale ID, the customer's ID, the date of the sale, the price paid, and method of payment.</p>
<p>A <a class='glossary' target='_blank' title='A single number or piece of data.' href='https://psyteachr.github.io/glossary/v#value'>value</a> is the data for one variable for one observation. For example, the value of the date variable from the observation of a sale might be <code>2021-08-20</code>.</p>
<p>There are three rules for "tidy data", which is data in a format that makes it easier to combine data from different tables, create summary tables, and visualise your data.</p>
<ul>
<li>Each observation must have its own row</li>
<li>Each variable must have its own column</li>
<li>Each value must have its own cell</li>
</ul>
<div id="untidy-data" class="section level3" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Untidy data</h3>
<p>The table below has three observations per row (one customer's orders from 2018, 2019, and 2020) and the <code>itemsprice_{year}</code> columns contain two values (number of items and price per item).</p>
<table>
<caption>
<span id="tab:unnamed-chunk-1">Table 7.1: </span>Untidy table
</caption>
<thead>
<tr>
<th style="text-align:right;">
customer_id
</th>
<th style="text-align:left;">
itemsprice_2018
</th>
<th style="text-align:left;">
itemsprice_2019
</th>
<th style="text-align:left;">
itemsprice_2020
</th>
<th style="text-align:right;">
totalprice_2018
</th>
<th style="text-align:right;">
totalprice_2019
</th>
<th style="text-align:right;">
totalprice_2020
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2 (3.91)
</td>
<td style="text-align:left;">
8 (4.72)
</td>
<td style="text-align:left;">
10 (5.59)
</td>
<td style="text-align:right;">
7.82
</td>
<td style="text-align:right;">
37.76
</td>
<td style="text-align:right;">
55.90
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
1 (3.91)
</td>
<td style="text-align:left;">
6 (4.72)
</td>
<td style="text-align:left;">
1 (5.59)
</td>
<td style="text-align:right;">
3.91
</td>
<td style="text-align:right;">
28.32
</td>
<td style="text-align:right;">
5.59
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
4 (3.91)
</td>
<td style="text-align:left;">
5 (4.72)
</td>
<td style="text-align:left;">
5 (5.59)
</td>
<td style="text-align:right;">
15.64
</td>
<td style="text-align:right;">
23.60
</td>
<td style="text-align:right;">
27.95
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
10 (3.91)
</td>
<td style="text-align:left;">
1 (4.72)
</td>
<td style="text-align:left;">
3 (5.59)
</td>
<td style="text-align:right;">
39.10
</td>
<td style="text-align:right;">
4.72
</td>
<td style="text-align:right;">
16.77
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
3 (3.91)
</td>
<td style="text-align:left;">
9 (4.72)
</td>
<td style="text-align:left;">
8 (5.59)
</td>
<td style="text-align:right;">
11.73
</td>
<td style="text-align:right;">
42.48
</td>
<td style="text-align:right;">
44.72
</td>
</tr>
</tbody>
</table>
<p>Let's say you wanted to calculate the total price per customer over the three years and the total number of items bought per customer. You can't perform mathematical operations on the <code>itemsprice_{year}</code> columns because they are <a class='glossary' target='_blank' title='A data type representing strings of text.' href='https://psyteachr.github.io/glossary/c#character'>character</a> <a class='glossary' target='_blank' title='The kind of data represented by an object.' href='https://psyteachr.github.io/glossary/d#data-type'>data types</a>.</p>
<p>You would probably normally use Excel to</p>
<ol style="list-style-type: decimal">
<li>split <code>itemsprice_2018</code> column into <code>item_2018</code> and <code>price_2018</code> columns</li>
<li>split <code>itemsprice_2019</code> column into <code>item_2019</code> and <code>price_2019</code> columns</li>
<li>split <code>itemsprice_2020</code> column into <code>item_2018</code> and <code>price_2020</code> columns</li>
<li>add <code>item_2018 + item_2019 + item_2020</code> to get the total number of items bought per customer</li>
<li>add <code>totalprice_2018 + totalprice_2019 + totalprice_2020</code> to get the total price per customer</li>
</ol>
<div class="try">
<p>Think about how many steps in Excel this would be if there were 10 years in the table, or a different number of years each time you encountered data like this.</p>
</div>
</div>
<div id="tidy-data" class="section level3" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> Tidy data</h3>
<p>This is the tidy version, where each row is a customer's orders in a particular year. The number of items (<code>items</code>) and price per item (<code>price_per_item</code>) are in separate columns, so now you can perform mathematical operations on them.</p>
<table>
<caption>
<span id="tab:unnamed-chunk-1">Table 7.1: </span>Tidy table
</caption>
<thead>
<tr>
<th style="text-align:right;">
customer_id
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
items
</th>
<th style="text-align:right;">
price_per_item
</th>
<th style="text-align:right;">
totalprice
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3.91
</td>
<td style="text-align:right;">
7.82
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
4.72
</td>
<td style="text-align:right;">
37.76
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
5.59
</td>
<td style="text-align:right;">
55.90
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3.91
</td>
<td style="text-align:right;">
3.91
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
4.72
</td>
<td style="text-align:right;">
28.32
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5.59
</td>
<td style="text-align:right;">
5.59
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3.91
</td>
<td style="text-align:right;">
15.64
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
4.72
</td>
<td style="text-align:right;">
23.60
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
5.59
</td>
<td style="text-align:right;">
27.95
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
3.91
</td>
<td style="text-align:right;">
39.10
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4.72
</td>
<td style="text-align:right;">
4.72
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5.59
</td>
<td style="text-align:right;">
16.77
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3.91
</td>
<td style="text-align:right;">
11.73
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
4.72
</td>
<td style="text-align:right;">
42.48
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
5.59
</td>
<td style="text-align:right;">
44.72
</td>
</tr>
</tbody>
</table>
<p>To calculate the total price per customer over the three years and the total number of items bought per customer in R, you would need to:</p>
<ol style="list-style-type: decimal">
<li>group the table by customer_id</li>
<li>sum the <code>items</code> column to get the total number of items bought per customer</li>
<li>sum the <code>totalprice</code> column to get the total price per customer</li>
</ol>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="tidy.html#cb243-1" aria-hidden="true" tabindex="-1"></a>tidy_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/tidy_data.csv&quot;</span>)</span>
<span id="cb243-2"><a href="tidy.html#cb243-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-3"><a href="tidy.html#cb243-3" aria-hidden="true" tabindex="-1"></a><span class="co"># we&#39;ll learn about these functions later</span></span>
<span id="cb243-4"><a href="tidy.html#cb243-4" aria-hidden="true" tabindex="-1"></a>tidy_data <span class="sc">%&gt;%</span></span>
<span id="cb243-5"><a href="tidy.html#cb243-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(customer_id) <span class="sc">%&gt;%</span></span>
<span id="cb243-6"><a href="tidy.html#cb243-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb243-7"><a href="tidy.html#cb243-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_items =</span> <span class="fu">sum</span>(items),</span>
<span id="cb243-8"><a href="tidy.html#cb243-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_price =</span> <span class="fu">sum</span>(totalprice)</span>
<span id="cb243-9"><a href="tidy.html#cb243-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr>
<th style="text-align:right;">
customer_id
</th>
<th style="text-align:right;">
total_items
</th>
<th style="text-align:right;">
total_price
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
101.48
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
37.82
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
67.19
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
60.59
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
98.93
</td>
</tr>
</tbody>
</table>
</div>
<div class="info">
<p>If there were 10 years in the table, or a different number of years each time you encountered data like this, the code for producing the table above never changes.</p>
</div>
<p>If you have control over how the data are recorded, it will make your life easier to record it in a tidy format from the start. However, we don't always have control, so this class will also teach you how to convert untidy tables into tidy tables.</p>
</div>
</div>
<div id="reshaping-data" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Reshaping Data</h2>
<p>Data tables can be in <a class='glossary' target='_blank' title='Data where all of the observations about one subject are in the same row' href='https://psyteachr.github.io/glossary/w#wide'>wide</a> format or <a class='glossary' target='_blank' title='Data where each observation is on a separate row' href='https://psyteachr.github.io/glossary/l#long'>long</a> format (or a mix of the two). Wide data are where all of the observations about one thing are in the same row, while long data are where each observation is on a separate row. You often need to convert between these formats to do different types of summaries or visualisation. You may have done something similar using pivot tables in Excel.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:img-pivot-table"></span>
<img src="images/tidy/excel_pivot_table.png" alt="Converting between wide and long formats using pivot tables in Excel." width="100%" />
<p class="caption">
Figure 7.1: Converting between wide and long formats using pivot tables in Excel.
</p>
</div>
<p>Let's look again at just the <code>totalprice</code> data from the untidy table above. We can select just the columns we want using the <code>dplyr::select()</code> function. This function's first argument is the data table you want to select from, then each argument after that is either the name of a column in that table, or <code>new_name = old_name</code>. This is a useful function for changing the column names and order of columns, as well as selecting a subset of columns.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="tidy.html#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select just the customer ID and 3 total price columns</span></span>
<span id="cb244-2"><a href="tidy.html#cb244-2" aria-hidden="true" tabindex="-1"></a>untidy_price <span class="ot">&lt;-</span> <span class="fu">select</span>(</span>
<span id="cb244-3"><a href="tidy.html#cb244-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.data =</span> untidy_data,</span>
<span id="cb244-4"><a href="tidy.html#cb244-4" aria-hidden="true" tabindex="-1"></a>  customer_id, </span>
<span id="cb244-5"><a href="tidy.html#cb244-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">2018</span><span class="st">`</span> <span class="ot">=</span> totalprice_2018,</span>
<span id="cb244-6"><a href="tidy.html#cb244-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">2019</span><span class="st">`</span> <span class="ot">=</span> totalprice_2019,</span>
<span id="cb244-7"><a href="tidy.html#cb244-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">2020</span><span class="st">`</span> <span class="ot">=</span> totalprice_2020</span>
<span id="cb244-8"><a href="tidy.html#cb244-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<table>
<caption>
<span id="tab:wide-data">Table 7.2: </span>Wide data
</caption>
<thead>
<tr>
<th style="text-align:right;">
customer_id
</th>
<th style="text-align:right;">
2018
</th>
<th style="text-align:right;">
2019
</th>
<th style="text-align:right;">
2020
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
7.82
</td>
<td style="text-align:right;">
37.76
</td>
<td style="text-align:right;">
55.90
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3.91
</td>
<td style="text-align:right;">
28.32
</td>
<td style="text-align:right;">
5.59
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
15.64
</td>
<td style="text-align:right;">
23.60
</td>
<td style="text-align:right;">
27.95
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
39.10
</td>
<td style="text-align:right;">
4.72
</td>
<td style="text-align:right;">
16.77
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
11.73
</td>
<td style="text-align:right;">
42.48
</td>
<td style="text-align:right;">
44.72
</td>
</tr>
</tbody>
</table>
<p>This is in wide format, where each row is a customer, and represents the data from several years. This is a really intuitive way for humans to read a table, but it's not as easy for a computer to process it.</p>
<p>The same data can be represented in a long format by creating a new column that specifies what <code>year</code> the observation is from and a new column that specifies the <code>totalprice</code> of that observation. This is easier to use to make summaries and plots.</p>
<table>
<caption>
<span id="tab:long-data">Table 7.3: </span>Long data
</caption>
<thead>
<tr>
<th style="text-align:right;">
customer_id
</th>
<th style="text-align:left;">
year
</th>
<th style="text-align:right;">
totalprice
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2018
</td>
<td style="text-align:right;">
7.82
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
2018
</td>
<td style="text-align:right;">
3.91
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2018
</td>
<td style="text-align:right;">
15.64
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
2018
</td>
<td style="text-align:right;">
39.10
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
2018
</td>
<td style="text-align:right;">
11.73
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2019
</td>
<td style="text-align:right;">
37.76
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
2019
</td>
<td style="text-align:right;">
28.32
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2019
</td>
<td style="text-align:right;">
23.60
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
2019
</td>
<td style="text-align:right;">
4.72
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
2019
</td>
<td style="text-align:right;">
42.48
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:right;">
55.90
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:right;">
5.59
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:right;">
27.95
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:right;">
16.77
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:right;">
44.72
</td>
</tr>
</tbody>
</table>
<div class="try">
<p>Create a long version of the following table of how many million followers each band has on different social media platforms. You don't need to use code, just sketch it in a notebook or make a table in a spreadsheet.</p>
<table>
<thead>
<tr class="header">
<th align="left">band</th>
<th align="left">twitter</th>
<th align="left">instagram</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">The Beatles</td>
<td align="left">3.8</td>
<td align="left">3.8</td>
</tr>
<tr class="even">
<td align="left">The Rolling Stones</td>
<td align="left">3.4</td>
<td align="left">3.1</td>
</tr>
<tr class="odd">
<td align="left">One Direction</td>
<td align="left">31.3</td>
<td align="left">22.8</td>
</tr>
</tbody>
</table>
<div class="webex-solution">
<button>
Answer
</button>
<p>Your answer doesn't need to have the same column headers or be in the same order.</p>
<table>
<thead>
<tr class="header">
<th align="left">account</th>
<th align="left">social_media</th>
<th align="left">followers</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">The Beatles</td>
<td align="left">twitter</td>
<td align="left">3.8</td>
</tr>
<tr class="even">
<td align="left">The Beatles</td>
<td align="left">instagram</td>
<td align="left">3.8</td>
</tr>
<tr class="odd">
<td align="left">The Rolling Stones</td>
<td align="left">twitter</td>
<td align="left">3.4</td>
</tr>
<tr class="even">
<td align="left">The Rolling Stones</td>
<td align="left">instagram</td>
<td align="left">3.1</td>
</tr>
<tr class="odd">
<td align="left">One Direction</td>
<td align="left">twitter</td>
<td align="left">31.3</td>
</tr>
<tr class="even">
<td align="left">One Direction</td>
<td align="left">instagram</td>
<td align="left">322.8</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The pivot functions allow you to transform a data table from wide to long or long to wide.</p>
<div id="wide-to-long" class="section level4" number="7.3.0.1">
<h4><span class="header-section-number">7.3.0.1</span> Wide to long</h4>
<p>The function <code>pivot_longer()</code> converts a wide data table to a longer format by converting the headers from specified columns into the values of new columns, and combining the values of those columns into a new condensed column.</p>
<p>This function has several arguments:</p>
<ul>
<li><code>cols</code>: the columns you want to make long; you can refer to them by their names, like <code>c(`2018`, `2019`, `2020`)</code> or <code>`2018`:`2020`</code> or by their numbers, like <code>c(2, 3, 4)</code> or <code>2:4</code></li>
<li><code>names_to</code>: what you want to call the new columns that the <code>cols</code> column header names will go into</li>
<li><code>values_to</code>: what you want to call the new column that contains the values in the <code>cols</code></li>
</ul>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="tidy.html#cb245-1" aria-hidden="true" tabindex="-1"></a>untidy_price_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(</span>
<span id="cb245-2"><a href="tidy.html#cb245-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> untidy_price, </span>
<span id="cb245-3"><a href="tidy.html#cb245-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cols =</span> <span class="st">`</span><span class="at">2018</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">2020</span><span class="st">`</span>, <span class="co"># columns to make long </span></span>
<span id="cb245-4"><a href="tidy.html#cb245-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_to =</span> <span class="st">&quot;year&quot;</span>, <span class="co"># new column name for headers</span></span>
<span id="cb245-5"><a href="tidy.html#cb245-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_to =</span> <span class="st">&quot;totalprice&quot;</span> <span class="co"># new column name for values</span></span>
<span id="cb245-6"><a href="tidy.html#cb245-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<table>
<caption>
<span id="tab:pivot-longer">Table 7.4: </span>Data made longer with pivot_longer()
</caption>
<thead>
<tr>
<th style="text-align:right;">
customer_id
</th>
<th style="text-align:left;">
year
</th>
<th style="text-align:right;">
totalprice
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2018
</td>
<td style="text-align:right;">
7.82
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2019
</td>
<td style="text-align:right;">
37.76
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:right;">
55.90
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
2018
</td>
<td style="text-align:right;">
3.91
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
2019
</td>
<td style="text-align:right;">
28.32
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:right;">
5.59
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2018
</td>
<td style="text-align:right;">
15.64
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2019
</td>
<td style="text-align:right;">
23.60
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:right;">
27.95
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
2018
</td>
<td style="text-align:right;">
39.10
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
2019
</td>
<td style="text-align:right;">
4.72
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:right;">
16.77
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
2018
</td>
<td style="text-align:right;">
11.73
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
2019
</td>
<td style="text-align:right;">
42.48
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:right;">
44.72
</td>
</tr>
</tbody>
</table>
</div>
<div id="long-to-wide" class="section level4" number="7.3.0.2">
<h4><span class="header-section-number">7.3.0.2</span> Long to wide</h4>
<p>We can also go from long to wide format using the <code>pivot_wider()</code> function.</p>
<ul>
<li><code>names_from</code>: the columns that contain your new column headers.</li>
<li><code>values_from</code>: the column that contains the values for the new columns.</li>
<li><code>names_sep</code>:the character string used to join names if <code>names_from</code> is more than one column.</li>
</ul>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="tidy.html#cb246-1" aria-hidden="true" tabindex="-1"></a>untidy_price_wide <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(</span>
<span id="cb246-2"><a href="tidy.html#cb246-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> untidy_price_long,</span>
<span id="cb246-3"><a href="tidy.html#cb246-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_from =</span> year,</span>
<span id="cb246-4"><a href="tidy.html#cb246-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_from =</span> totalprice</span>
<span id="cb246-5"><a href="tidy.html#cb246-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<table>
<caption>
<span id="tab:pivot-wider">Table 7.5: </span>Data made wider with pivot_wider()
</caption>
<thead>
<tr>
<th style="text-align:right;">
customer_id
</th>
<th style="text-align:right;">
2018
</th>
<th style="text-align:right;">
2019
</th>
<th style="text-align:right;">
2020
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
7.82
</td>
<td style="text-align:right;">
37.76
</td>
<td style="text-align:right;">
55.90
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3.91
</td>
<td style="text-align:right;">
28.32
</td>
<td style="text-align:right;">
5.59
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
15.64
</td>
<td style="text-align:right;">
23.60
</td>
<td style="text-align:right;">
27.95
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
39.10
</td>
<td style="text-align:right;">
4.72
</td>
<td style="text-align:right;">
16.77
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
11.73
</td>
<td style="text-align:right;">
42.48
</td>
<td style="text-align:right;">
44.72
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="multistep" class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> Multi-step tidying</h2>
<p>You often need to go from wide, to long, to an intermediate shape in order to get your data into a format that is useful for plotting, where there is a column for each variable that you want to represent with an aesthetic.</p>
<p>Our full <code>untidy_data</code> table has seven columns: a customer ID, three columns for <code>itemsprice</code> and 3 columns for <code>totalprice</code>.</p>
<div class="kable-table">
<table>
<thead>
<tr>
<th style="text-align:right;">
customer_id
</th>
<th style="text-align:left;">
itemsprice_2018
</th>
<th style="text-align:left;">
itemsprice_2019
</th>
<th style="text-align:left;">
itemsprice_2020
</th>
<th style="text-align:right;">
totalprice_2018
</th>
<th style="text-align:right;">
totalprice_2019
</th>
<th style="text-align:right;">
totalprice_2020
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2 (3.91)
</td>
<td style="text-align:left;">
8 (4.72)
</td>
<td style="text-align:left;">
10 (5.59)
</td>
<td style="text-align:right;">
7.82
</td>
<td style="text-align:right;">
37.76
</td>
<td style="text-align:right;">
55.90
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
1 (3.91)
</td>
<td style="text-align:left;">
6 (4.72)
</td>
<td style="text-align:left;">
1 (5.59)
</td>
<td style="text-align:right;">
3.91
</td>
<td style="text-align:right;">
28.32
</td>
<td style="text-align:right;">
5.59
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
4 (3.91)
</td>
<td style="text-align:left;">
5 (4.72)
</td>
<td style="text-align:left;">
5 (5.59)
</td>
<td style="text-align:right;">
15.64
</td>
<td style="text-align:right;">
23.60
</td>
<td style="text-align:right;">
27.95
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
10 (3.91)
</td>
<td style="text-align:left;">
1 (4.72)
</td>
<td style="text-align:left;">
3 (5.59)
</td>
<td style="text-align:right;">
39.10
</td>
<td style="text-align:right;">
4.72
</td>
<td style="text-align:right;">
16.77
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
3 (3.91)
</td>
<td style="text-align:left;">
9 (4.72)
</td>
<td style="text-align:left;">
8 (5.59)
</td>
<td style="text-align:right;">
11.73
</td>
<td style="text-align:right;">
42.48
</td>
<td style="text-align:right;">
44.72
</td>
</tr>
</tbody>
</table>
</div>
<p>We want to get it into the tidy format where each row is an observation of one customer per year, with the columns of <code>customer_id</code>, <code>year</code>, <code>item</code>, <code>price_per_item</code> and <code>totalprice</code>.</p>
<div class="kable-table">
<table>
<thead>
<tr>
<th style="text-align:right;">
customer_id
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
items
</th>
<th style="text-align:right;">
price_per_item
</th>
<th style="text-align:right;">
totalprice
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3.91
</td>
<td style="text-align:right;">
7.82
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
4.72
</td>
<td style="text-align:right;">
37.76
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
5.59
</td>
<td style="text-align:right;">
55.90
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3.91
</td>
<td style="text-align:right;">
3.91
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
4.72
</td>
<td style="text-align:right;">
28.32
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5.59
</td>
<td style="text-align:right;">
5.59
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3.91
</td>
<td style="text-align:right;">
15.64
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
4.72
</td>
<td style="text-align:right;">
23.60
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
5.59
</td>
<td style="text-align:right;">
27.95
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
3.91
</td>
<td style="text-align:right;">
39.10
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4.72
</td>
<td style="text-align:right;">
4.72
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5.59
</td>
<td style="text-align:right;">
16.77
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3.91
</td>
<td style="text-align:right;">
11.73
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
4.72
</td>
<td style="text-align:right;">
42.48
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
5.59
</td>
<td style="text-align:right;">
44.72
</td>
</tr>
</tbody>
</table>
</div>
<div id="one-observation-per-row" class="section level3" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> One observation per row</h3>
<p>The original table has observations from each customer over three years. This is too many observations per row, so first we'll start by making the table long. We need to make 6 rows for each customer, one for each variable-year combo, with columns for the customer ID, year, variable, and value.</p>
<p>Because we'll be combining columns with numeric and character data type, we need to make the new <code>value</code> column a character data type using <code>values_transform</code>, since numbers can be represented as characters (like <code><span class="st">"3.5"</span></code>), but character strings can't be represented as numbers.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="tidy.html#cb247-1" aria-hidden="true" tabindex="-1"></a>longer_data <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(</span>
<span id="cb247-2"><a href="tidy.html#cb247-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> untidy_data, </span>
<span id="cb247-3"><a href="tidy.html#cb247-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cols =</span> itemsprice_2018<span class="sc">:</span>totalprice_2020, <span class="co"># columns to make long </span></span>
<span id="cb247-4"><a href="tidy.html#cb247-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;category&quot;</span>, <span class="st">&quot;year&quot;</span>),       <span class="co"># new column names for cols</span></span>
<span id="cb247-5"><a href="tidy.html#cb247-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>,                        <span class="co"># how to split cols into new columns</span></span>
<span id="cb247-6"><a href="tidy.html#cb247-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># names_pattern = &quot;(.*)_(.*)&quot;, # alternative to names_sep</span></span>
<span id="cb247-7"><a href="tidy.html#cb247-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>, <span class="co"># new column name for values</span></span>
<span id="cb247-8"><a href="tidy.html#cb247-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb247-9"><a href="tidy.html#cb247-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make sure new columns are the right data type</span></span>
<span id="cb247-10"><a href="tidy.html#cb247-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_transform =</span> <span class="fu">list</span>(<span class="at">year =</span> as.integer),</span>
<span id="cb247-11"><a href="tidy.html#cb247-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_transform =</span> <span class="fu">list</span>(<span class="at">value =</span> as.character) </span>
<span id="cb247-12"><a href="tidy.html#cb247-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-4">Table 7.6: </span>Untidy data converted from wide to long.
</caption>
<thead>
<tr>
<th style="text-align:right;">
customer_id
</th>
<th style="text-align:left;">
category
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:left;">
value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
itemsprice
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:left;">
2 (3.91)
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
itemsprice
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:left;">
8 (4.72)
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
itemsprice
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:left;">
10 (5.59)
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
totalprice
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:left;">
7.82
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
totalprice
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:left;">
37.76
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
totalprice
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:left;">
55.9
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
itemsprice
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:left;">
1 (3.91)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
itemsprice
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:left;">
6 (4.72)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
itemsprice
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:left;">
1 (5.59)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
totalprice
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:left;">
3.91
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
totalprice
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:left;">
28.32
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
totalprice
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:left;">
5.59
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
itemsprice
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:left;">
4 (3.91)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
itemsprice
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:left;">
5 (4.72)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
itemsprice
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:left;">
5 (5.59)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
totalprice
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:left;">
15.64
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
totalprice
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:left;">
23.6
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
totalprice
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:left;">
27.95
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
itemsprice
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:left;">
10 (3.91)
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
itemsprice
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:left;">
1 (4.72)
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
itemsprice
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:left;">
3 (5.59)
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
totalprice
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:left;">
39.1
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
totalprice
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:left;">
4.72
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
totalprice
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:left;">
16.77
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
itemsprice
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:left;">
3 (3.91)
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
itemsprice
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:left;">
9 (4.72)
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
itemsprice
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:left;">
8 (5.59)
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
totalprice
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:left;">
11.73
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
totalprice
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:left;">
42.48
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
totalprice
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:left;">
44.72
</td>
</tr>
</tbody>
</table>
</div>
<div id="one-variable-per-column" class="section level3" number="7.4.2">
<h3><span class="header-section-number">7.4.2</span> One variable per column</h3>
<p>Now the <code>value</code> column contains data from two different variables. We need to make the table wider, but not as wide as before. We want to keep the <code>year</code> column and make new columns called <code>itemsprice</code> and <code>totalprice</code> with the relevant customer's <code>value</code> for that variable and year.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="tidy.html#cb248-1" aria-hidden="true" tabindex="-1"></a>wider_data <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(</span>
<span id="cb248-2"><a href="tidy.html#cb248-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> longer_data,</span>
<span id="cb248-3"><a href="tidy.html#cb248-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">id_cols =</span> <span class="fu">c</span>(customer_id, year),</span>
<span id="cb248-4"><a href="tidy.html#cb248-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_from =</span> category,</span>
<span id="cb248-5"><a href="tidy.html#cb248-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_from =</span> value</span>
<span id="cb248-6"><a href="tidy.html#cb248-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-5">Table 7.7: </span>Data converted from long to an intermediate shape.
</caption>
<thead>
<tr>
<th style="text-align:right;">
customer_id
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:left;">
itemsprice
</th>
<th style="text-align:left;">
totalprice
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:left;">
2 (3.91)
</td>
<td style="text-align:left;">
7.82
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:left;">
8 (4.72)
</td>
<td style="text-align:left;">
37.76
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:left;">
10 (5.59)
</td>
<td style="text-align:left;">
55.9
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:left;">
1 (3.91)
</td>
<td style="text-align:left;">
3.91
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:left;">
6 (4.72)
</td>
<td style="text-align:left;">
28.32
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:left;">
1 (5.59)
</td>
<td style="text-align:left;">
5.59
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:left;">
4 (3.91)
</td>
<td style="text-align:left;">
15.64
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:left;">
5 (4.72)
</td>
<td style="text-align:left;">
23.6
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:left;">
5 (5.59)
</td>
<td style="text-align:left;">
27.95
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:left;">
10 (3.91)
</td>
<td style="text-align:left;">
39.1
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:left;">
1 (4.72)
</td>
<td style="text-align:left;">
4.72
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:left;">
3 (5.59)
</td>
<td style="text-align:left;">
16.77
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:left;">
3 (3.91)
</td>
<td style="text-align:left;">
11.73
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:left;">
9 (4.72)
</td>
<td style="text-align:left;">
42.48
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:left;">
8 (5.59)
</td>
<td style="text-align:left;">
44.72
</td>
</tr>
</tbody>
</table>
</div>
<div id="one-value-per-cell" class="section level3" number="7.4.3">
<h3><span class="header-section-number">7.4.3</span> One value per cell</h3>
<p>The cells in the <code>itemsprice</code> column actually contain two different values. We need to split it into two columns for the variables <code>items</code>, and <code>price_per_item</code>. You can split a column into parts with the function <code>tidyr::separate()</code>.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="tidy.html#cb249-1" aria-hidden="true" tabindex="-1"></a>split_data <span class="ot">&lt;-</span> <span class="fu">separate</span>(</span>
<span id="cb249-2"><a href="tidy.html#cb249-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> wider_data, </span>
<span id="cb249-3"><a href="tidy.html#cb249-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> itemsprice, <span class="co"># the column to split</span></span>
<span id="cb249-4"><a href="tidy.html#cb249-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;items&quot;</span>, <span class="st">&quot;price_per_item&quot;</span>), <span class="co"># the new columns to create</span></span>
<span id="cb249-5"><a href="tidy.html#cb249-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">&quot; &quot;</span>, <span class="co"># how to split col</span></span>
<span id="cb249-6"><a href="tidy.html#cb249-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">remove =</span> <span class="cn">TRUE</span>, <span class="co"># whether to remove to old col</span></span>
<span id="cb249-7"><a href="tidy.html#cb249-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">convert =</span> <span class="cn">TRUE</span> <span class="co"># whether to fix the data type of the new columns</span></span>
<span id="cb249-8"><a href="tidy.html#cb249-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-6">Table 7.8: </span>The itemsprice column split into items and price_per_item using separate()
</caption>
<thead>
<tr>
<th style="text-align:right;">
customer_id
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
items
</th>
<th style="text-align:left;">
price_per_item
</th>
<th style="text-align:left;">
totalprice
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
(3.91)
</td>
<td style="text-align:left;">
7.82
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
(4.72)
</td>
<td style="text-align:left;">
37.76
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
(5.59)
</td>
<td style="text-align:left;">
55.9
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
(3.91)
</td>
<td style="text-align:left;">
3.91
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
(4.72)
</td>
<td style="text-align:left;">
28.32
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
(5.59)
</td>
<td style="text-align:left;">
5.59
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
(3.91)
</td>
<td style="text-align:left;">
15.64
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
(4.72)
</td>
<td style="text-align:left;">
23.6
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
(5.59)
</td>
<td style="text-align:left;">
27.95
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
(3.91)
</td>
<td style="text-align:left;">
39.1
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
(4.72)
</td>
<td style="text-align:left;">
4.72
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
(5.59)
</td>
<td style="text-align:left;">
16.77
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
(3.91)
</td>
<td style="text-align:left;">
11.73
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
(4.72)
</td>
<td style="text-align:left;">
42.48
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
(5.59)
</td>
<td style="text-align:left;">
44.72
</td>
</tr>
</tbody>
</table>
<div class="warning">
<p>If the new columns should have a different <a class='glossary' target='_blank' title='The kind of data represented by an object.' href='https://psyteachr.github.io/glossary/d#data-type'>data type</a> from the old column, set <code>convert = TRUE</code> to automatically fix them. This is common when you have columns that contain multiple numbers, separated by commas or semicolons. These are character types before they are separated, but should be numeric types after so that you can do mathematical operations like sum them.</p>
</div>
</div>
<div id="altering-data" class="section level3" number="7.4.4">
<h3><span class="header-section-number">7.4.4</span> Altering data</h3>
<p>The column <code>price_per_item</code> is still a character column because it has parentheses. There are a few ways to fix this. You can use the <code>dplyr::mutate()</code> function to change a column or add a new one.</p>
<p>Here, we'll use <code>stringr::str_replace_all()</code> to replace all of the "(" and ")" with "".</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="tidy.html#cb250-1" aria-hidden="true" tabindex="-1"></a>mutated_data <span class="ot">&lt;-</span> <span class="fu">mutate</span>(</span>
<span id="cb250-2"><a href="tidy.html#cb250-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">.data =</span> split_data,</span>
<span id="cb250-3"><a href="tidy.html#cb250-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">price_per_item =</span> stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(</span>
<span id="cb250-4"><a href="tidy.html#cb250-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">string =</span> price_per_item, </span>
<span id="cb250-5"><a href="tidy.html#cb250-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">pattern =</span> <span class="st">&quot;[()]&quot;</span>, </span>
<span id="cb250-6"><a href="tidy.html#cb250-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">replacement =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb250-7"><a href="tidy.html#cb250-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb250-8"><a href="tidy.html#cb250-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-7">Table 7.9: </span>Mutating data to remove the parentheses from price_per_item.
</caption>
<thead>
<tr>
<th style="text-align:right;">
customer_id
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
items
</th>
<th style="text-align:left;">
price_per_item
</th>
<th style="text-align:left;">
totalprice
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
3.91
</td>
<td style="text-align:left;">
7.82
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
4.72
</td>
<td style="text-align:left;">
37.76
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
5.59
</td>
<td style="text-align:left;">
55.9
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
3.91
</td>
<td style="text-align:left;">
3.91
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
4.72
</td>
<td style="text-align:left;">
28.32
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
5.59
</td>
<td style="text-align:left;">
5.59
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
3.91
</td>
<td style="text-align:left;">
15.64
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
4.72
</td>
<td style="text-align:left;">
23.6
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
5.59
</td>
<td style="text-align:left;">
27.95
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
3.91
</td>
<td style="text-align:left;">
39.1
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
4.72
</td>
<td style="text-align:left;">
4.72
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
5.59
</td>
<td style="text-align:left;">
16.77
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
3.91
</td>
<td style="text-align:left;">
11.73
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
4.72
</td>
<td style="text-align:left;">
42.48
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
5.59
</td>
<td style="text-align:left;">
44.72
</td>
</tr>
</tbody>
</table>
</div>
<div id="fixing-data-types" class="section level3" number="7.4.5">
<h3><span class="header-section-number">7.4.5</span> Fixing data types</h3>
<p>The <code>price_per_item</code> and <code>totalprice</code> columns are still characters, so you can't do things like calculate the sum of <code>totalprice</code>.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="tidy.html#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check the data types</span></span>
<span id="cb251-2"><a href="tidy.html#cb251-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(mutated_data)</span></code></pre></div>
<pre><code>## Rows: 15
## Columns: 5
## $ customer_id    &lt;int&gt; 1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 5
## $ year           &lt;int&gt; 2018, 2019, 2020, 2018, 2019, 2020, 2018, 2019, 2020, 2…
## $ items          &lt;int&gt; 2, 8, 10, 1, 6, 1, 4, 5, 5, 10, 1, 3, 3, 9, 8
## $ price_per_item &lt;chr&gt; &quot;3.91&quot;, &quot;4.72&quot;, &quot;5.59&quot;, &quot;3.91&quot;, &quot;4.72&quot;, &quot;5.59&quot;, &quot;3.91&quot;,…
## $ totalprice     &lt;chr&gt; &quot;7.82&quot;, &quot;37.76&quot;, &quot;55.9&quot;, &quot;3.91&quot;, &quot;28.32&quot;, &quot;5.59&quot;, &quot;15.6…</code></pre>
<p>Once the data are clean and tidy, you can fix all of your column data types in one step using <code>readr::type_convert()</code>. This is good practice when you've finished cleaning a data set. If the automatic type detection doesn't work as expected, this usually means that you still have non-numeric characters in a column where there were only supposed to be numbers. You can also manually set the column types in the same way as for <code>readr::read_csv()</code> (see Chapter <a href="data.html#data">4</a>).</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="tidy.html#cb253-1" aria-hidden="true" tabindex="-1"></a>tidy_data <span class="ot">&lt;-</span> <span class="fu">type_convert</span>(</span>
<span id="cb253-2"><a href="tidy.html#cb253-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> mutated_data,</span>
<span id="cb253-3"><a href="tidy.html#cb253-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">trim_ws =</span> <span class="cn">TRUE</span> <span class="co"># removes spaces before and after values</span></span>
<span id="cb253-4"><a href="tidy.html#cb253-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb253-5"><a href="tidy.html#cb253-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-6"><a href="tidy.html#cb253-6" aria-hidden="true" tabindex="-1"></a><span class="co"># check the data types</span></span>
<span id="cb253-7"><a href="tidy.html#cb253-7" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(tidy_data)</span></code></pre></div>
<pre><code>## Rows: 15
## Columns: 5
## $ customer_id    &lt;int&gt; 1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 5
## $ year           &lt;int&gt; 2018, 2019, 2020, 2018, 2019, 2020, 2018, 2019, 2020, 2…
## $ items          &lt;int&gt; 2, 8, 10, 1, 6, 1, 4, 5, 5, 10, 1, 3, 3, 9, 8
## $ price_per_item &lt;dbl&gt; 3.91, 4.72, 5.59, 3.91, 4.72, 5.59, 3.91, 4.72, 5.59, 3…
## $ totalprice     &lt;dbl&gt; 7.82, 37.76, 55.90, 3.91, 28.32, 5.59, 15.64, 23.60, 27…</code></pre>
</div>
</div>
<div id="pipes" class="section level2" number="7.5">
<h2><span class="header-section-number">7.5</span> Pipes</h2>
<div style="width: 200px; float: right;">
<img src="images/tidy/pipe_sticker.png" style="width: 100%" />
</div>
<p>Pipes are a way to order your code in a more readable format.</p>
<p>A pipe takes the result of the previous function and sends it to the next function as its first argument. For example, instead of first calculating the sum and then using that in the <code>paste()</code> function...</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="tidy.html#cb255-1" aria-hidden="true" tabindex="-1"></a>my_sum <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb255-2"><a href="tidy.html#cb255-2" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(my_sum, <span class="st">&quot;is the sum of 1:5.&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;15 is the sum of 1:5.&quot;</code></pre>
<p>...instead you can pipe the result of <code>sum(1:5)</code> to the next function. Remember to remove <code>my_sum</code> from the <code>paste()</code> function, since it is being piped in.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="tidy.html#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb257-2"><a href="tidy.html#cb257-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="st">&quot;is the sum of 1:5.&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;15 is the sum of 1:5.&quot;</code></pre>
<p>If the result of the previous function isn't the first argument of the next function, you can use the <code>.</code> "pronoun" to represent it.</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="tidy.html#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb259-2"><a href="tidy.html#cb259-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="st">&quot;The sum of 1:5 is&quot;</span>, .)</span></code></pre></div>
<pre><code>## [1] &quot;The sum of 1:5 is 15&quot;</code></pre>
<p>This doesn't seem very useful for the simple example above, but this method is very useful when you are cleaning and reshaping data tables</p>
<div id="multi-step-pipes" class="section level3" number="7.5.1">
<h3><span class="header-section-number">7.5.1</span> Multi-step pipes</h3>
<p>You can always create a new object at every step and use that object in the next step, like we did in Section <a href="tidy.html#multistep">7.4</a>. This is pretty clear, but you've created several unnecessary data objects in your environment. This can get confusing in longer scripts.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="tidy.html#cb261-1" aria-hidden="true" tabindex="-1"></a>untidy_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">&quot;data/untidy_data.csv&quot;</span>)</span>
<span id="cb261-2"><a href="tidy.html#cb261-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-3"><a href="tidy.html#cb261-3" aria-hidden="true" tabindex="-1"></a>longer_data <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(</span>
<span id="cb261-4"><a href="tidy.html#cb261-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> untidy_data,</span>
<span id="cb261-5"><a href="tidy.html#cb261-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">cols =</span> itemsprice_2018<span class="sc">:</span>totalprice_2020,</span>
<span id="cb261-6"><a href="tidy.html#cb261-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;category&quot;</span>, <span class="st">&quot;year&quot;</span>),</span>
<span id="cb261-7"><a href="tidy.html#cb261-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>, </span>
<span id="cb261-8"><a href="tidy.html#cb261-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>, </span>
<span id="cb261-9"><a href="tidy.html#cb261-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_transform =</span> <span class="fu">list</span>(<span class="at">year =</span> as.integer),</span>
<span id="cb261-10"><a href="tidy.html#cb261-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_transform =</span> <span class="fu">list</span>(<span class="at">value =</span> as.character) </span>
<span id="cb261-11"><a href="tidy.html#cb261-11" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb261-12"><a href="tidy.html#cb261-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-13"><a href="tidy.html#cb261-13" aria-hidden="true" tabindex="-1"></a>wider_data <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(</span>
<span id="cb261-14"><a href="tidy.html#cb261-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> longer_data,</span>
<span id="cb261-15"><a href="tidy.html#cb261-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">id_cols =</span> <span class="fu">c</span>(customer_id, year),</span>
<span id="cb261-16"><a href="tidy.html#cb261-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_from =</span> category,</span>
<span id="cb261-17"><a href="tidy.html#cb261-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_from =</span> value</span>
<span id="cb261-18"><a href="tidy.html#cb261-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb261-19"><a href="tidy.html#cb261-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-20"><a href="tidy.html#cb261-20" aria-hidden="true" tabindex="-1"></a>split_data <span class="ot">&lt;-</span> <span class="fu">separate</span>(</span>
<span id="cb261-21"><a href="tidy.html#cb261-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> wider_data,</span>
<span id="cb261-22"><a href="tidy.html#cb261-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> itemsprice,</span>
<span id="cb261-23"><a href="tidy.html#cb261-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;items&quot;</span>, <span class="st">&quot;price_per_item&quot;</span>),</span>
<span id="cb261-24"><a href="tidy.html#cb261-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">&quot; &quot;</span>, </span>
<span id="cb261-25"><a href="tidy.html#cb261-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">remove =</span> <span class="cn">TRUE</span>, </span>
<span id="cb261-26"><a href="tidy.html#cb261-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">convert =</span> <span class="cn">TRUE</span></span>
<span id="cb261-27"><a href="tidy.html#cb261-27" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb261-28"><a href="tidy.html#cb261-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-29"><a href="tidy.html#cb261-29" aria-hidden="true" tabindex="-1"></a>mutated_data <span class="ot">&lt;-</span> <span class="fu">mutate</span>(</span>
<span id="cb261-30"><a href="tidy.html#cb261-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">.data =</span> split_data,</span>
<span id="cb261-31"><a href="tidy.html#cb261-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">price_per_item =</span> stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(</span>
<span id="cb261-32"><a href="tidy.html#cb261-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">string =</span> price_per_item, </span>
<span id="cb261-33"><a href="tidy.html#cb261-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">pattern =</span> <span class="st">&quot;[()]&quot;</span>, </span>
<span id="cb261-34"><a href="tidy.html#cb261-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">replacement =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb261-35"><a href="tidy.html#cb261-35" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb261-36"><a href="tidy.html#cb261-36" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb261-37"><a href="tidy.html#cb261-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-38"><a href="tidy.html#cb261-38" aria-hidden="true" tabindex="-1"></a>tidy_data <span class="ot">&lt;-</span> <span class="fu">type_convert</span>(</span>
<span id="cb261-39"><a href="tidy.html#cb261-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> mutated_data,</span>
<span id="cb261-40"><a href="tidy.html#cb261-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">trim_ws =</span> <span class="cn">TRUE</span></span>
<span id="cb261-41"><a href="tidy.html#cb261-41" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="warning">
<p>You <em>can</em> give each object the same name and keep replacing the old data object with the new one at each step. This will keep your environment clean, but it makes debugging code much harder.</p>
</div>
<p>One way to avoid extra objects is to nest your functions, literally replacing each data object with the code that generated it in the previous step. This can be fine for very short chains.</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="tidy.html#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;The sum of 1:5 is&quot;</span>, <span class="fu">sum</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>))</span></code></pre></div>
<pre><code>## [1] &quot;The sum of 1:5 is 15&quot;</code></pre>
<p>But it gets extremely confusing for long chains:</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="tidy.html#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="co"># do not ever do this!!!!!!</span></span>
<span id="cb264-2"><a href="tidy.html#cb264-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-3"><a href="tidy.html#cb264-3" aria-hidden="true" tabindex="-1"></a>tidy_data <span class="ot">&lt;-</span> <span class="fu">type_convert</span>(</span>
<span id="cb264-4"><a href="tidy.html#cb264-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> <span class="fu">mutate</span>(</span>
<span id="cb264-5"><a href="tidy.html#cb264-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.data =</span> <span class="fu">separate</span>(</span>
<span id="cb264-6"><a href="tidy.html#cb264-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> <span class="fu">pivot_wider</span>(</span>
<span id="cb264-7"><a href="tidy.html#cb264-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> <span class="fu">pivot_longer</span>(</span>
<span id="cb264-8"><a href="tidy.html#cb264-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">&quot;data/untidy_data.csv&quot;</span>),</span>
<span id="cb264-9"><a href="tidy.html#cb264-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">cols =</span> itemsprice_2018<span class="sc">:</span>totalprice_2020,</span>
<span id="cb264-10"><a href="tidy.html#cb264-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;category&quot;</span>, <span class="st">&quot;year&quot;</span>),</span>
<span id="cb264-11"><a href="tidy.html#cb264-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb264-12"><a href="tidy.html#cb264-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>,</span>
<span id="cb264-13"><a href="tidy.html#cb264-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">names_transform =</span> <span class="fu">list</span>(<span class="at">year =</span> as.integer),</span>
<span id="cb264-14"><a href="tidy.html#cb264-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">values_transform =</span> <span class="fu">list</span>(<span class="at">value =</span> as.character)</span>
<span id="cb264-15"><a href="tidy.html#cb264-15" aria-hidden="true" tabindex="-1"></a>        ) ,</span>
<span id="cb264-16"><a href="tidy.html#cb264-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">id_cols =</span> <span class="fu">c</span>(customer_id, year),</span>
<span id="cb264-17"><a href="tidy.html#cb264-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_from =</span> category,</span>
<span id="cb264-18"><a href="tidy.html#cb264-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_from =</span> value</span>
<span id="cb264-19"><a href="tidy.html#cb264-19" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb264-20"><a href="tidy.html#cb264-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> itemsprice,</span>
<span id="cb264-21"><a href="tidy.html#cb264-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;items&quot;</span>, <span class="st">&quot;price_per_item&quot;</span>),</span>
<span id="cb264-22"><a href="tidy.html#cb264-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">sep =</span> <span class="st">&quot; &quot;</span>,</span>
<span id="cb264-23"><a href="tidy.html#cb264-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">remove =</span> <span class="cn">TRUE</span>,</span>
<span id="cb264-24"><a href="tidy.html#cb264-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">convert =</span> <span class="cn">TRUE</span></span>
<span id="cb264-25"><a href="tidy.html#cb264-25" aria-hidden="true" tabindex="-1"></a>    ) ,</span>
<span id="cb264-26"><a href="tidy.html#cb264-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">price_per_item =</span> stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(</span>
<span id="cb264-27"><a href="tidy.html#cb264-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">string =</span> price_per_item,</span>
<span id="cb264-28"><a href="tidy.html#cb264-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">pattern =</span> <span class="st">&quot;[()]&quot;</span>,</span>
<span id="cb264-29"><a href="tidy.html#cb264-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">replacement =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb264-30"><a href="tidy.html#cb264-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb264-31"><a href="tidy.html#cb264-31" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb264-32"><a href="tidy.html#cb264-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">trim_ws =</span> <span class="cn">TRUE</span></span>
<span id="cb264-33"><a href="tidy.html#cb264-33" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>The pipe lets you "pipe" the result of each function into the next function, allowing you to put your code in a logical order without creating too many extra objects. By default, the result of the previous function becomes the first <a class='glossary' target='_blank' title='A variable that provides input to a function.' href='https://psyteachr.github.io/glossary/a#argument'>argument</a> to the next function. Most tidyverse functions take a data table as their first argument, so they pipe together easily.</p>
<p>For example, instead of making a table called <code>untidy_data</code> by reading a csv file, and then making a new table called <code>totalprice_data</code> by selecting the <code>customer_id</code> and <code>totalprice_{year}</code> columns from <code>untidy_data</code>...</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="tidy.html#cb265-1" aria-hidden="true" tabindex="-1"></a>untidy_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">&quot;data/untidy_data.csv&quot;</span>)</span>
<span id="cb265-2"><a href="tidy.html#cb265-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-3"><a href="tidy.html#cb265-3" aria-hidden="true" tabindex="-1"></a>totalprice_data <span class="ot">&lt;-</span> <span class="fu">select</span>(</span>
<span id="cb265-4"><a href="tidy.html#cb265-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">.data =</span> untidy_data,</span>
<span id="cb265-5"><a href="tidy.html#cb265-5" aria-hidden="true" tabindex="-1"></a>  customer_id, </span>
<span id="cb265-6"><a href="tidy.html#cb265-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">starts_with</span>(<span class="st">&quot;totalprice&quot;</span>) <span class="co"># selects all columns that start with a string</span></span>
<span id="cb265-7"><a href="tidy.html#cb265-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>... you can just make one table called <code>totalprice_data</code> by reading the csv file and <strong>piping</strong> the resulting table into the <code>select()</code> function.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="tidy.html#cb266-1" aria-hidden="true" tabindex="-1"></a>totalprice_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">&quot;data/untidy_data.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb266-2"><a href="tidy.html#cb266-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb266-3"><a href="tidy.html#cb266-3" aria-hidden="true" tabindex="-1"></a>    customer_id, </span>
<span id="cb266-4"><a href="tidy.html#cb266-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">starts_with</span>(<span class="st">&quot;totalprice&quot;</span>) </span>
<span id="cb266-5"><a href="tidy.html#cb266-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="info">
<p>Notice how we no longer need to specify the <code>.data</code> argument. Add it back in and see what happens. This is a common error when you're converting code from using separate variables to using a pipeline, but you'll learn to identify it quickly.</p>
</div>
<p>For longer series of steps like the one above, using pipes can eliminate many intermediate objects. This also makes it easier to add an intermediate step to your process without having to think of a new table name and edit the table input to the next step.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="tidy.html#cb267-1" aria-hidden="true" tabindex="-1"></a>tidy_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">&quot;data/untidy_data.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb267-2"><a href="tidy.html#cb267-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb267-3"><a href="tidy.html#cb267-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> itemsprice_2018<span class="sc">:</span>totalprice_2020,</span>
<span id="cb267-4"><a href="tidy.html#cb267-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;category&quot;</span>, <span class="st">&quot;year&quot;</span>),</span>
<span id="cb267-5"><a href="tidy.html#cb267-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>, </span>
<span id="cb267-6"><a href="tidy.html#cb267-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>, </span>
<span id="cb267-7"><a href="tidy.html#cb267-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_transform =</span> <span class="fu">list</span>(<span class="at">year =</span> as.integer),</span>
<span id="cb267-8"><a href="tidy.html#cb267-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_transform =</span> <span class="fu">list</span>(<span class="at">value =</span> as.character) </span>
<span id="cb267-9"><a href="tidy.html#cb267-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb267-10"><a href="tidy.html#cb267-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb267-11"><a href="tidy.html#cb267-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(customer_id, year),</span>
<span id="cb267-12"><a href="tidy.html#cb267-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> category,</span>
<span id="cb267-13"><a href="tidy.html#cb267-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> value</span>
<span id="cb267-14"><a href="tidy.html#cb267-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb267-15"><a href="tidy.html#cb267-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(</span>
<span id="cb267-16"><a href="tidy.html#cb267-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> itemsprice,</span>
<span id="cb267-17"><a href="tidy.html#cb267-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;items&quot;</span>, <span class="st">&quot;price_per_item&quot;</span>),</span>
<span id="cb267-18"><a href="tidy.html#cb267-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">&quot; &quot;</span>, </span>
<span id="cb267-19"><a href="tidy.html#cb267-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">remove =</span> <span class="cn">TRUE</span>, </span>
<span id="cb267-20"><a href="tidy.html#cb267-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">convert =</span> <span class="cn">TRUE</span></span>
<span id="cb267-21"><a href="tidy.html#cb267-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb267-22"><a href="tidy.html#cb267-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb267-23"><a href="tidy.html#cb267-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">price_per_item =</span> stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(</span>
<span id="cb267-24"><a href="tidy.html#cb267-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">string =</span> price_per_item, </span>
<span id="cb267-25"><a href="tidy.html#cb267-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">pattern =</span> <span class="st">&quot;[()]&quot;</span>, </span>
<span id="cb267-26"><a href="tidy.html#cb267-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">replacement =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb267-27"><a href="tidy.html#cb267-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb267-28"><a href="tidy.html#cb267-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb267-29"><a href="tidy.html#cb267-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">type_convert</span>(</span>
<span id="cb267-30"><a href="tidy.html#cb267-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">trim_ws =</span> <span class="cn">TRUE</span></span>
<span id="cb267-31"><a href="tidy.html#cb267-31" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>You can read the code above like this:</p>
<ol style="list-style-type: decimal">
<li>Read the data (<code>read_csv()</code>)
<ul>
<li><code>file</code>: from the file at r path("data/untidy_data.csv")`; <strong>and then</strong></li>
</ul></li>
<li>Reshape the data longer (<code>pivot_longer()</code>)
<ul>
<li><code>cols</code>: take the columns from <code>itemsprice_2018</code> to <code>totalprice_2020</code>,</li>
<li><code>names_to</code>: create new columns called "category" and "year" from the <code>cols</code> header names,</li>
<li><code>names_sep</code>: separate the column names using "_"</li>
<li><code>values_to</code>: create a new column called "value" from the <code>cols</code> values,</li>
<li><code>names_transform</code> = transform the <code>year</code> column to integers,</li>
<li><code>values_transform</code> = transform the <code>value</code> column to characters; <strong>and then</strong></li>
</ul></li>
<li>Reshape the data wider (<code>pivot_wider()</code>)
<ul>
<li><code>id_cols</code>: each row should be an observation of a unique <code>customer_id</code> and <code>year</code>,</li>
<li><code>names_from</code>: get the new column names from the values in the <code>category</code> column,</li>
<li><code>values_from</code>: get the new column values from the values in the <code>value</code> column; <strong>and then</strong></li>
</ul></li>
<li>Split multiple values in the same column (<code>separate()</code>)
<ul>
<li><code>col</code>: separate the column <code>itemsprice</code>,</li>
<li><code>into</code>: into new columns called "items" and "price_per_item",</li>
<li><code>sep</code>: separate the values at each " ",</li>
<li><code>remove</code>: do remove the old column,</li>
<li><code>convert</code>: do convert the new columns into the right data types; <strong>and then</strong></li>
</ul></li>
<li>Change a column (<code>mutate()</code>)
<ul>
<li><code>price_per_item</code>: replace the existing column <code>price_per_item</code> with the result of a search and replace:
<ul>
<li><code>string</code>: the strings to modify come from the <code>price_per_item</code> columns,</li>
<li><code>pattern</code>: search for left or right parentheses,</li>
<li><code>replacement</code>: replace them with ""; <strong>and then</strong>,</li>
</ul></li>
</ul></li>
<li>Fix data types (<code>type_convert()</code>)
<ul>
<li><code>trim_ws</code>: remove spaces, tabs, and line breaks from the start and end of each value</li>
</ul></li>
</ol>
<p>Don't feel like you always need to get all of your data wrangling code into a single pipeline. You should make intermediate objects whenever you need to break up your code because it's getting too complicated or if you need to debug something.</p>
<div class="info">
<p>You can debug a pipe by highlighting from the beginning to just before the pipe you want to stop at. Try this by highlighting from <code>data &lt;-</code> to the end of the <code>separate</code> function and typing cmd-return. What does <code>data</code> look like now?</p>
</div>
</div>
</div>
<div id="glossary-tidy" class="section level2" number="7.6">
<h2><span class="header-section-number">7.6</span> Glossary</h2>
<table>
<thead>
<tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:left;">
definition
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/a.html#argument" class="glossary" target="_blank">argument</a>
</td>
<td style="text-align:left;">
A variable that provides input to a function.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/c.html#character" class="glossary" target="_blank">character</a>
</td>
<td style="text-align:left;">
A data type representing strings of text.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/d.html#data-type" class="glossary" target="_blank">data type</a>
</td>
<td style="text-align:left;">
The kind of data represented by an object.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/l.html#long" class="glossary" target="_blank">long</a>
</td>
<td style="text-align:left;">
Data where each observation is on a separate row
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/o.html#observation" class="glossary" target="_blank">observation</a>
</td>
<td style="text-align:left;">
All of the data about a single trial or question.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/v.html#value" class="glossary" target="_blank">value</a>
</td>
<td style="text-align:left;">
A single number or piece of data.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/v.html#variable" class="glossary" target="_blank">variable</a>
</td>
<td style="text-align:left;">
A word that identifies and stores the value of some data for later use.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/w.html#wide" class="glossary" target="_blank">wide</a>
</td>
<td style="text-align:left;">
Data where all of the observations about one subject are in the same row
</td>
</tr>
</tbody>
</table>
</div>
<div id="resources-tidy" class="section level2" number="7.7">
<h2><span class="header-section-number">7.7</span> Further resources</h2>
<ul>
<li><a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/tidyr.pdf">Data tidying cheat sheet</a></li>
<li><a href="http://vita.had.co.nz/papers/tidy-data.html">Tidy Data</a></li>
<li><a href="http://r4ds.had.co.nz/tidy-data.html">Chapter 12: Tidy Data</a> in <em>R for Data Science</em></li>
<li><a href="http://r4ds.had.co.nz/pipes.html">Chapter 18: Pipes</a> in <em>R for Data Science</em></li>
</ul>

</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;

    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    $(solveme[i]).after(" <span class='webex-icon'></span>");
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    $(selects[i]).after(" <span class='webex-icon'></span>");
  }

  update_total_correct();
}

</script>
<script>
$( document ).ready(function() {
  var cite = ' ';
  var psyteachr = ' <a href="https://psyteachr.github.io/"><img src="images/logos/psyteachr_logo.png" style="height: 31px; color: white;" alt="psyTeachR: Reproducible Research" /></a>';
  var license = ' <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>';

  $("footer div.row div:eq(1) p").html(
    psyteachr + license + cite
  );

  function move_sidebar() {
    var w = window.innerWidth;
    if (w < 992) {
      $("#toc").appendTo($("#main-nav"));
    } else {
      $("#toc").appendTo($("div.sidebar-chapter"));
    }
  }
  move_sidebar();
  window.onresize = move_sidebar;
});
</script>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Applied Data Skills</strong>: Processing &amp; Presenting Data" was written by Emily Nordmann and Lisa DeBruine. It was last built on 2022-01-24.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


</body>

</html>
