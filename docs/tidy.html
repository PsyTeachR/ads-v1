<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 5 Data Tidying | Applied Data Skills</title>
<meta name="author" content="Emily Nordmann and Lisa DeBruine">
<meta name="description" content="5.1 Intended Learning Outcomes Be able to change data between long and wide formats Separate, mutate, rename column headers and category labels  5.2 Pipes  Pipes are a way to order your code in a...">
<meta name="generator" content="bookdown 0.23 with bs4_book()">
<meta property="og:title" content="Chapter 5 Data Tidying | Applied Data Skills">
<meta property="og:type" content="book">
<meta property="og:url" content="https://psyteachr.github.io/ads-v1/tidy.html">
<meta property="og:image" content="https://psyteachr.github.io/ads-v1/images/logos/twitter_card.png">
<meta property="og:description" content="5.1 Intended Learning Outcomes Be able to change data between long and wide formats Separate, mutate, rename column headers and category labels  5.2 Pipes  Pipes are a way to order your code in a...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 5 Data Tidying | Applied Data Skills">
<meta name="twitter:description" content="5.1 Intended Learning Outcomes Be able to change data between long and wide formats Separate, mutate, rename column headers and category labels  5.2 Pipes  Pipes are a way to order your code in a...">
<meta name="twitter:image" content="https://psyteachr.github.io/ads-v1/images/logos/twitter_card.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.9.4/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-6NP3MF25W3"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-6NP3MF25W3');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="include/psyteachr.css">
<link rel="stylesheet" href="include/webex.css">
<link rel="stylesheet" href="include/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="Processing &amp; Presenting Data">Applied Data Skills</a>:
        <small class="text-muted">Processing &amp; Presenting Data</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Overview</a></li>
<li><a class="" href="intro.html"><span class="header-section-number">1</span> Intro to R, RStudio and R Markdown</a></li>
<li><a class="" href="reports.html"><span class="header-section-number">2</span> Reports with R Markdown</a></li>
<li><a class="" href="viz.html"><span class="header-section-number">3</span> Basic Data Visualisation</a></li>
<li><a class="" href="data.html"><span class="header-section-number">4</span> Data Import and Relations</a></li>
<li><a class="active" href="tidy.html"><span class="header-section-number">5</span> Data Tidying</a></li>
<li><a class="" href="wrangle.html"><span class="header-section-number">6</span> Data Wrangling</a></li>
<li><a class="" href="summary.html"><span class="header-section-number">7</span> Data Summaries</a></li>
<li><a class="" href="custom.html"><span class="header-section-number">8</span> Customising Visualisations</a></li>
<li><a class="" href="present.html"><span class="header-section-number">9</span> Dashboards, Reports, and Presentations</a></li>
<li><a class="" href="next.html"><span class="header-section-number">10</span> What's Next</a></li>
<li class="book-part">Appendices</li>
<li><a class="" href="installing-r.html"><span class="header-section-number">A</span> Installing R</a></li>
<li><a class="" href="symbols.html"><span class="header-section-number">B</span> Symbols</a></li>
<li><a class="" href="conventions.html"><span class="header-section-number">C</span> Conventions</a></li>
<li><a class="" href="data-types.html"><span class="header-section-number">D</span> Data Types</a></li>
<li><a class="" href="license.html">License</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/psyteachr/ads-v1">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="tidy" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> Data Tidying<a class="anchor" aria-label="anchor" href="#tidy"><i class="fas fa-link"></i></a>
</h1>
<div id="ilo-tidy" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Intended Learning Outcomes<a class="anchor" aria-label="anchor" href="#ilo-tidy"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>Be able to change data between long and wide formats</li>
<li>Separate, mutate, rename column headers and category labels</li>
</ul>
</div>
<div id="pipes" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> Pipes<a class="anchor" aria-label="anchor" href="#pipes"><i class="fas fa-link"></i></a>
</h2>
<div style="width: 200px; float: right;">
<img src="images/pipe_sticker.png" style="width: 100%">
</div>
<p>Pipes are a way to order your code in a more readable format.</p>
<p>Let's say you have a <a href="data/widgets_gadgets.xlsx">small Excel table</a> with 10 customer IDs, and how many widgets and gadgets each purchased in 2020 and 2021. You want to calculate the total number of items purchased per year make a table sorted by the total number of items purchased.</p>
<div class="inline-table"><table class="table table-sm">
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Widgets
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Gadgets
</div>
</th>
</tr>
<tr>
<th style="text-align:right;">
Customer ID
</th>
<th style="text-align:right;">
2020
</th>
<th style="text-align:right;">
2021
</th>
<th style="text-align:right;">
2020
</th>
<th style="text-align:right;">
2021
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table></div>
<p>One way you could do this is by creating a new object at every step and using that object in the next step. This is pretty clear, but you've created several unnecessary data objects in your environment. This can get confusing in very long scripts.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get the data with better column names</span>
<span class="va">data_original</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span>
  path <span class="op">=</span> <span class="st">"data/widgets_gadgets.xlsx"</span>, 
  skip <span class="op">=</span> <span class="fl">2</span>,
  col_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"customer_id"</span>, 
                <span class="st">"widgets_2020"</span>, 
                <span class="st">"widgets_2021"</span>, 
                <span class="st">"gadgets_2020"</span>, 
                <span class="st">"gadgets_2021"</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># gather columns 2 to 5 into "item_year" and "number" columns</span>
<span class="va">data_gathered</span> <span class="op">&lt;-</span> <span class="fu">gather</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_original</span>, 
                        key <span class="op">=</span> <span class="va">item_year</span>, 
                        value <span class="op">=</span> <span class="va">number</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>

<span class="co"># separate the item_year column at the _ into "item" and "year" columns</span>
<span class="va">data_separated</span> <span class="op">&lt;-</span> <span class="fu">separate</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_gathered</span>, 
                           col <span class="op">=</span> <span class="va">item_year</span>, 
                           into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"item"</span>, <span class="st">"year"</span><span class="op">)</span>, 
                           sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span>

<span class="co"># group the data by item and year</span>
<span class="va">data_grouped</span> <span class="op">&lt;-</span> <span class="fu">group_by</span><span class="op">(</span>.data <span class="op">=</span> <span class="va">data_separated</span>, <span class="va">item</span>, <span class="va">year</span><span class="op">)</span>

<span class="co"># calculate the total number for each item/year </span>
<span class="va">data_summarised</span> <span class="op">&lt;-</span> <span class="fu">summarise</span><span class="op">(</span>.data <span class="op">=</span> <span class="va">data_grouped</span>, 
                             year_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">number</span><span class="op">)</span>, 
                             .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span>

<span class="co"># spread the year_total column into columns by year</span>
<span class="va">data_spread</span> <span class="op">&lt;-</span> <span class="fu">spread</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_summarised</span>, 
                      key <span class="op">=</span> <span class="va">year</span>, 
                      value <span class="op">=</span> <span class="va">year_total</span><span class="op">)</span></code></pre></div>
<div class="warning">
<p>You <em>can</em> name each object <code>data</code> and keep replacing the old data object with the new one at each step. This will keep your environment clean, but I don't recommend it because it makes it too easy to accidentally run your code out of order when you are running line-by-line for development or debugging.</p>
</div>
<p>One way to avoid extra objects is to nest your functions, literally replacing each data object with the code that generated it in the previous step. This can be fine for very short chains.</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mean_petal_width</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Petal.Width</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>But it gets extremely confusing for long chains:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># do not ever do this!!</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">spread</span><span class="op">(</span>
  data <span class="op">=</span> <span class="fu">summarise</span><span class="op">(</span>
    .data <span class="op">=</span> <span class="fu">group_by</span><span class="op">(</span>
      .data <span class="op">=</span> <span class="fu">separate</span><span class="op">(</span>
        data <span class="op">=</span> <span class="fu">gather</span><span class="op">(</span>
          data <span class="op">=</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span>
            path <span class="op">=</span> <span class="st">"data/widgets_gadgets.xlsx"</span>, 
            skip <span class="op">=</span> <span class="fl">2</span>,
            col_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"customer_id"</span>, 
                          <span class="st">"widgets_2020"</span>, 
                          <span class="st">"widgets_2021"</span>, 
                          <span class="st">"gadgets_2020"</span>, 
                          <span class="st">"gadgets_2021"</span><span class="op">)</span><span class="op">)</span>, 
          key <span class="op">=</span> <span class="va">item_year</span>, value <span class="op">=</span> <span class="va">number</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>, 
        <span class="va">item_year</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"item"</span>, <span class="st">"year"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span>, 
      <span class="va">item</span>, <span class="va">year</span><span class="op">)</span>, 
    year_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">number</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span>,
  key <span class="op">=</span> <span class="va">year</span>, value <span class="op">=</span> <span class="va">year_total</span><span class="op">)</span></code></pre></div>
<p>The pipe lets you "pipe" the result of each function into the next function, allowing you to put your code in a logical order without creating too many extra objects.</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span>
  path <span class="op">=</span> <span class="st">"data/widgets_gadgets.xlsx"</span>, 
  skip <span class="op">=</span> <span class="fl">2</span>,
  col_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"customer_id"</span>, 
                <span class="st">"widgets_2020"</span>, 
                <span class="st">"widgets_2021"</span>, 
                <span class="st">"gadgets_2020"</span>, 
                <span class="st">"gadgets_2021"</span><span class="op">)</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">gather</span><span class="op">(</span>key <span class="op">=</span> <span class="va">item_year</span>, value <span class="op">=</span> <span class="va">number</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">separate</span><span class="op">(</span>col <span class="op">=</span> <span class="va">item_year</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"item"</span>, <span class="st">"year"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">item</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>year_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">number</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">spread</span><span class="op">(</span>key <span class="op">=</span> <span class="va">year</span>, value <span class="op">=</span> <span class="va">year_total</span><span class="op">)</span></code></pre></div>
<p>You can read this code from top to bottom as follows:</p>
<ol style="list-style-type: decimal">
<li>Read in an excel file
<ul>
<li>at the <em>path</em> <code class="path">data/widgets_gadgets.xlsx</code>
</li>
<li>
<em>skip</em>ping the first two rows,</li>
<li>with new <em>col</em>umn <em>names</em>; <strong>and then</strong>
</li>
</ul>
</li>
<li>Gather to create a <em>key</em> column <code>item_year</code> and <em>value</em> column <code>number</code> from columns 2 to 5; <strong>and then</strong>
</li>
<li>Separate the <em>col</em>umn <code>item_year</code> <em>into</em> 2 new columns called <code>item</code> and <code>year</code>, <em>sep</em>arate at the "_"; <strong>and then</strong>
</li>
<li>Group by columns <code>item</code> and <code>year</code>; <strong>and then</strong>
</li>
<li>Summarise and new column called <code>year_total</code> as the sum of the <code>number</code> column for each group and drop <em>groups</em>; <strong>and then</strong>
</li>
<li>Mutate the table to add a new column called <code>total</code> that is the sum of the <code>year_total</code> column for each group; <strong>and then</strong>
</li>
<li>Spread to make new columns with the <em>key</em> names in <code>year</code> and <em>value</em>s in <code>year_total</code>
</li>
</ol>
<p>You can make intermediate objects whenever you need to break up your code because it's getting too complicated or if you need to debug something.</p>
<div class="info">
<p>You can debug a pipe by highlighting from the beginning to just before the pipe you want to stop at. Try this by highlighting from <code>data &lt;-</code> to the end of the <code>separate</code> function and typing cmd-return. What does <code>data</code> look like now?</p>
</div>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># https://www.kaggle.com/sid321axn/amazon-alexa-reviews</span>
<span class="co"># extracted from Amazon by Manu Siddhartha &amp; Anurag Bhatt</span>

<span class="va">data_csv</span>  <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"data/amazon_alexa.csv"</span><span class="op">)</span></code></pre></div>

</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  if (t = document.getElementById("webex-total_correct")) {
    t.innerHTML =
      document.getElementsByClassName("webex-correct").length + " of " +
      document.getElementsByClassName("webex-solveme").length + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

window.onload = function() {
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }

  update_total_correct();
}

</script><script>
$( document ).ready(function() {
  var cite = ' ';
  var psyteachr = ' <a href="https://psyteachr.github.io/"><img src="images/logos/psyteachr_logo.png" style="height: 31px; color: white;" alt="psyTeachR: Reproducible Research" /></a>';
  var license = ' <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>';

  $("footer div.row div:eq(1) p").html(
    psyteachr + license + cite
  );
});
</script><div class="chapter-nav">
<div class="prev"><a href="data.html"><span class="header-section-number">4</span> Data Import and Relations</a></div>
<div class="next"><a href="wrangle.html"><span class="header-section-number">6</span> Data Wrangling</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#tidy"><span class="header-section-number">5</span> Data Tidying</a></li>
<li><a class="nav-link" href="#ilo-tidy"><span class="header-section-number">5.1</span> Intended Learning Outcomes</a></li>
<li><a class="nav-link" href="#pipes"><span class="header-section-number">5.2</span> Pipes</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/psyteachr/ads-v1/blob/master/book/05-tidy.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/psyteachr/ads-v1/edit/master/book/05-tidy.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Applied Data Skills</strong>: Processing &amp; Presenting Data" was written by Emily Nordmann and Lisa DeBruine. It was last built on 2021-09-02.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
